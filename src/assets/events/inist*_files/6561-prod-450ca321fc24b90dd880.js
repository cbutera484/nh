"use strict";(globalThis.webpackChunk_multimediallc_cb_ts=globalThis.webpackChunk_multimediallc_cb_ts||[]).push([[6561],{2846:(e,t,s)=>{s.d(t,{T:()=>U});var i=s(9275),n=s(20),a=s(478),o=s(1728),r=s(4364),l=s(9510),h=s(5728),d=s(1885),c=s(9461),m=s(1224),u=s(2331),p=s(2939),g=s(106),b=s(8423),C=s(7407),v=s(6270),y=s(1452),T=s(1535),f=s(8785),S=s(4947),w=s(4110),x=s(7250),M=s(2091),R=s(1448),P=s(74);class U extends u.YI{constructor(e,t){var s;super(),this.leavePmTab=e,this.inBroadcast=t,this.numUnread=0,this.otherUserInitiatedPm=new b.c_("otherUserInitiatedPm"),this.pmSessions=new Map,this.orderedPMSessionKeys=new g.J,this.sendPrivateMessageFailCallback=e=>{const t=this.orderedPMSessionKeys.currentElem,s=this.pmSessions.get(t);(0,n.SU)()&&e.showDmLink?s.chatTabContents.appendMessageDiv((0,R.dD)(e.errorMessage,e.username)):s.chatTabContents.appendMessageDiv((0,R.CM)(e.errorMessage))},this.room=null!==(s=(0,f.P8)())&&void 0!==s?s:"",this.element.classList.add("data-hj-suppress"),this.pmList=new o.U({isFullVideoMode:!1,clearSearchOnSelect:!0,openConversationEvent:d.BM,inBroadcast:this.inBroadcast}),this.addChild(this.pmList),w.E3.listen(e=>{this.hideCurrentPMSession(),this.hidePMList(),void 0===this.pmSessions.get(e.username)&&this.initializePmSession(e.username,!1,e.showSupporterAlert),this.orderedPMSessionKeys.makeCurrent(e.username),this.refreshTabs(),e.focus&&this.changeToThisTab(),this.showCurrentPMSession()}),p.X0.listen(e=>{this.chatConnection=e.chatConnection,this.room=e.dossier.room,e.chatConnection.event.roomTipMenuNotice.listen(e=>{this.newTipMenuNotice(e)})}),p.Gr.listen(()=>{this.emptyQueue();for(const e of this.pmSessions.keys())this.closePMSession(e,!0)}),d.wl.listen(e=>{this.closePMSession(e)}),d.BM.listen(e=>{this.hideCurrentPMSession(),this.orderedPMSessionKeys.makeCurrent(e),this.showCurrentPMSession()}),h.yA.listen(e=>{this.showPMList(e,!0)}),w.ME.listen(()=>{const e=this.pmSessions.get(this.orderedPMSessionKeys.currentElem);!1===e.isAllHistoryLoaded&&this.loadHistoryMessages(e)}),n.lX.listen(e=>{this.orderedPMSessionKeys.addToTop(e),this.initializePmSession(e,!1,!1)}),d.J9.listen(e=>{this.newPrivateMessage(e);const t=this.currentPmSession();this.inActiveVideoMode()&&this.tabHasFocus()&&void 0!==t&&t.isActive()&&(this.addPageActions(t,e),e.otherUsername!==t.username||t.chatTabContents.isScrolledUp()||d.Si.fire(t.username))}),r.yT.unreadConversationsCountUpdate.listen(e=>{let{pmsCount:t}=e;this.setNumUnread(t)})}addPageActions(e,t){var s;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=(null===(s=c.Bm.current.loggedInUser)||void 0===s?void 0:s.username)===t.fromUser.username,a=e.username===t.fromUser.username;e.isActive()&&!i&&!n&&a&&(0,C.bT)("PMReceivedOpen",{message_id:t.messageID})}showPMList(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e){this.hideCurrentPMSession();const e=this.inBroadcast&&0===this.pmSessions.size,s=(0,f.b5)();t||this.pmSessions.size>1||e||s?(this.pmList.element.style.display="block",this.pmList.repositionChildrenRecursive()):(this.inBroadcast||this.orderedPMSessionKeys.makeCurrent(this.room),this.showCurrentPMSession())}}hidePMList(){this.pmList.element.style.display="none"}scrollToBottom(){const e=this.currentPmSession();void 0!==e&&e.chatTabContents.scrollToBottom()}getNumUnread(){return this.numUnread}setNumUnread(e){e!==this.numUnread&&(this.numUnread=e,this.refreshTabs())}getTabHandleContent(){const e=S.R.PmCAPS;let t;return t=this.numUnread>99?`${e} (99+)`:this.numUnread>0?`${e} (${this.numUnread})`:e,[document.createTextNode(t)]}tabHandleClicked(e){(0,C.bT)("FocusTab",{location:"PM",unread:this.getNumUnread()}),this.hideCurrentPMSession(),this.changeToThisTab(),this.showPMList(!1)}getTabId(){return"pm-tab-default"}tabHasFocus(){return"block"===this.element.style.display}focusCurrentChatInput(){const e=this.currentPmSession();void 0!==e&&e.chatTabContents.focusCurrentChatInput()}blurCurrentChatInput(){const e=this.currentPmSession();void 0!==e&&e.chatTabContents.blurCurrentChatInput()}isInputFocused(){const e=this.currentPmSession();return void 0!==e&&e.chatTabContents.isInputFocused()}initializePmSession(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.pmSessions.get(e);if(void 0===o){(0,b.jU)();const i=new M.__({onTipRequest:e=>{P.i5.fire(e)},onToggleDebugMode:()=>{this.chatConnection.toggleAppDebugging()},onChatMessage:t=>{this.orderedPMSessionKeys.addToTop(e);const s={message:t,username:e,media:[],source:n.O7.RoomViewPM,roomName:this.chatConnection.room()},i=o.mediaDock.sibling;i.isEmpty()?(0,n.F_)(s).catch(e=>{this.sendPrivateMessageFailCallback(e)}):i.mediaList().then(e=>{s.media=e,(0,n.F_)(s).catch(e=>{this.sendPrivateMessageFailCallback(e)}),i.clear()})}},()=>!1,()=>this.isConversationShowing(e),e);if(o={chatTabContents:i,hasUnread:!1,username:e,loadHistoryMessagesDOM:new h.b3,isInitialHistoryLoaded:!1,isAllHistoryLoaded:!1,mediaDock:new l.$w(i,e,["split"]),isActive:()=>"none"!==i.element.style.display},i.scrolledToBottom.listen(()=>{void 0!==o&&this.isPmSessionShowing(o)&&d.Si.fire(e)}),this.pmSessions.set(e,o),(0,l.c6)(o.chatTabContents.element,e),o.chatTabContents.initMediaDocks(o.mediaDock),o.chatTabContents.appendNoticeDiv((0,R.CM)(S.R.privateConversationWithText(e))),o.chatTabContents.appendNoticeDiv((0,R.CM)(S.R.conversationCautionMessage(m.mG.siteName))),!t&&s){var r,u;const t=null!==(r=null===(u=c.Bm.current.loggedInUser)||void 0===u?void 0:u.isAgeVerified)&&void 0!==r&&r;o.chatTabContents.appendNoticeDiv((0,R.YC)(e,t))}else o.chatTabContents.appendNoticeDiv(o.loadHistoryMessagesDOM.getElement());o.chatTabContents.element.style.display="none",this.addChild(o.chatTabContents)}return!i&&t&&this.otherUserInitiatedPm.fire({username:e,PMChatLink:new a.Qc({onClick:()=>{w.E3.fire({username:e,focus:!0,showSupporterAlert:!1})}})}),void 0===this.orderedPMSessionKeys.currentElem&&this.orderedPMSessionKeys.makeCurrent(e),o}loadHistoryMessages(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.loadHistoryMessagesDOM.isShowing())return Promise.reject();e.loadHistoryMessagesDOM.showLoading();const s=e.chatTabContents.messageList.clientHeight,i=t?"0":e.chatTabContents.getEarliestMessageId();return(0,n.O2)(e.username,this.chatConnection.room(),i).then(i=>{var a,o;e.loadHistoryMessagesDOM.hideLoading();const l=i.messages;l.length<n.j&&(e.isAllHistoryLoaded=!0);const h=null!==(a=null===(o=r.yT.getInstance().getConversation(e.username))||void 0===o?void 0:o.numUnread)&&void 0!==a?a:-1;l.forEach((e,t)=>{e.isFirstHistoryUnread=t===l.length-h,this.newPrivateMessage(e,!0)}),l.length>0&&e.chatTabContents.setEarliestMessageId(l[0].messageID),t&&this.maybeUpdateConversationListItem(l);const d=e.chatTabContents.messageList.clientHeight;e.chatTabContents.messageListWrapper.scrollTop=d-s}).catch(()=>{})}maybeUpdateConversationListItem(e){if(0===e.length)return;const t=e[e.length-1];(0,n.ug)(t.otherUsername,this.room).then(e=>{var s,i;r.yT.conversationLoaded.fire({message:t.message,numUnread:null!==(s=this.numUnread)&&void 0!==s?s:0,time:null===(i=t.createdAt)||void 0===i?void 0:i.getTime(),fromUsername:t.fromUser.username,otherUser:e.user,hasMedia:t.mediaList.length>0,room:this.room})}).catch(y.yZ)}newPrivateMessage(e){var t,s;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=null!==(t=null===(s=c.Bm.current.loggedInUser)||void 0===s?void 0:s.username)&&void 0!==t?t:"",a=this.orderedPMSessionKeys.currentElem,o=this.pmSessions.get(a);if((0,v.MR)(e)&&void 0!==o)return void(0,v.cH)({message:e,currentUsername:n,appendMessageDiv:e=>o.chatTabContents.appendMessageDiv(e),isScrolledUp:()=>o.chatTabContents.isScrolledUp(),scrollToBottom:()=>o.chatTabContents.scrollToBottom(),removeMessage:e=>{const t=o.chatTabContents.messageList.querySelector(`[data-chtrsf-flagged-id="${e}"]`);t&&o.chatTabContents.messageList.removeChild(t)},isMobile:!1,isPureChat:!1,enableDarkMode:!0});this.appendMessageDiv((0,R.j7)(e),e,i,!1);const r=(0,R.bB)(e);void 0!==r&&this.appendMessageDiv(r,e,i,!0)}appendMessageDiv(e,t,s,n){(0,i.at)(e,(0,i.Ec)()),this.orderedPMSessionKeys.addToTop(t.otherUsername);const a=this.initializePmSession(t.otherUsername,t.fromUser.username!==this.chatConnection.username(),!1,s);s&&!1===a.isInitialHistoryLoaded&&(a.isInitialHistoryLoaded=!0),this.sessionHasUnread(t,a)&&(a.hasUnread=!0,this.refreshTabs());const o=this.chatConnection.username()===t.fromUser.username;a.isInitialHistoryLoaded&&a.chatTabContents.appendMessageDiv(e,!s&&!n&&!o,t.isFirstHistoryUnread)}sessionHasUnread(e,t){var s,i;const n=null!==(s=null===(i=r.yT.getInstance().getConversation(t.username))||void 0===i?void 0:i.numUnread)&&void 0!==s?s:0;return this.chatConnection.username()!==e.fromUser.username&&(!this.isCurrentTab()||this.orderedPMSessionKeys.currentElem!==e.otherUsername||n>0)}possiblyAppendMessageDiv(e){if(this.isCurrentTab()){const t=this.currentPmSession();void 0!==t&&t.chatTabContents.appendMessageDiv(e)}}possiblyAppendMessageDivForUser(e,t){const s=this.getPmSession(e);void 0!==s&&s.chatTabContents.appendMessageDiv(t)}getPmSession(e){return this.pmSessions.get(e)}currentPmSession(){if(void 0!==this.orderedPMSessionKeys.currentElem)return this.pmSessions.get(this.orderedPMSessionKeys.currentElem)}newTipMenuNotice(e){const t=(0,T.Ru)(e,P.i5);if(t){const e=this.currentPmSession();if(void 0!==e){const s=!e.chatTabContents.isScrolledUp();e.chatTabContents.appendMessageDiv(t),s&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.chatTabContents.scrollToBottom()})})}}}showNextPMSession(){return this.showNextOrPrevPMSession("next")}showPrevPMSession(){return this.showNextOrPrevPMSession("prev")}showNextOrPrevPMSession(e){return this.hideCurrentPMSession(),void 0!==("next"===e?this.orderedPMSessionKeys.nextElem():this.orderedPMSessionKeys.prevElem())&&(this.showCurrentPMSession(),!0)}closePMSession(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e===this.room&&!t)return;const s=this.pmSessions.get(e);void 0!==s&&(this.orderedPMSessionKeys.remove(e),s.chatTabContents.dispose(),this.removeChild(s.chatTabContents),this.pmSessions.delete(e),this.isCurrentTab()&&(this.pmSessions.size>0?this.showPMList(!1,!0):this.leavePmTab()),this.refreshTabs(),(0,b.Rj)(),(0,o.i)(s.username,!1))}closeCurrentPMSession(){const e=this.currentPmSession();void 0!==e&&this.closePMSession(e.username)}resetNextQueue(){this.hideCurrentPMSession(),this.orderedPMSessionKeys.refillFromDiscard()}resetPrevQueue(){this.hideCurrentPMSession(),this.orderedPMSessionKeys.emptyDrawIntoDiscard()}emptyQueue(){this.hideCurrentPMSession(),this.orderedPMSessionKeys=new g.J}showCurrentPMSession(){let e=this.orderedPMSessionKeys.currentElem;void 0===e&&(e=this.chatConnection.room(),this.orderedPMSessionKeys.makeCurrent(e));let t=this.pmSessions.get(e);void 0===t&&this.initializePmSession(e,!1,!1),t=this.pmSessions.get(e);const s=t.isInitialHistoryLoaded;s||void 0===c.Bm.current.loggedInUser||(t.isInitialHistoryLoaded=!0,this.loadHistoryMessages(t,!0).then(()=>{void 0!==t&&this.maybeMarkSessionRead(t)}).catch(y.yZ)),this.hidePMList(),t.chatTabContents.showElement(),t.chatTabContents.repositionChildrenRecursive(),t.chatTabContents.scrollToBottom(),s&&this.maybeMarkSessionRead(t),w.PV.fire()}maybeMarkSessionRead(e){this.tabHasFocus()&&this.inActiveVideoMode()&&(e.hasUnread&&(e.hasUnread=!1,this.refreshTabs()),d.Si.fire(e.username),p.Zm.fire(e.username))}getSession(e){return this.pmSessions.get(e)}hideCurrentPMSession(){const e=this.currentPmSession();void 0!==e&&(e.chatTabContents.element.style.display="none")}getChatInputField(){const e=this.currentPmSession();if(void 0!==e)return e.chatTabContents.customInputField}inActiveVideoMode(){return"split"===x.L.getVideoMode()}isPmSessionShowing(e){return this.inActiveVideoMode()&&this.tabHasFocus()&&this.currentPmSession()===e&&"none"===this.pmList.element.style.display}isConversationShowing(e){var t;const s=this.getSession(e);if(void 0===s)return!1;const i=null===(t=this.parent)||void 0===t?void 0:t.getCurrentTab().getTabId(),n="chat-tab-default"===i||"pm-tab-default"===i,a=this.chatConnection&&this.chatConnection.inPrivateRoom()&&n;return this.isPmSessionShowing(s)||a&&this.inActiveVideoMode()}}},3448:(e,t,s)=>{s.d(t,{LH:()=>T,LQ:()=>y,XA:()=>f,ZO:()=>v});var i=s(6624),n=s(7623),a=s(9447),o=s(9461),r=s(6784),l=s(4941),h=s(2939),d=s(2709),c=s(8423),m=s(9060),u=s(8936),p=s(7407),g=s(1282),b=s(7250),C=s(2087);const v=8,y=l.bt?548:502,T=300;class f extends d.u{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.roomContents=e,this.useEvolveStyles=t,this.state={videoWidth:y,videoHeight:T},this.isDragging=!1,this.resizeHistory=[],this.lastChosenVideoWidth=y,this.lastChosenChatWidth=332,this.element.style.position="",this.element.style.display="inline-block",this.element.style.width=`${v}px`,this.element.style.boxSizing="border-box",(0,r.wu)("mousedown",this.element,t=>{t.preventDefault(),this.roomContents.element.onmousemove=t=>{const s=t.pageX-e.videoPanel.element.getBoundingClientRect().left-this.element.offsetWidth/2;this.handleResize(s),this.lastChosenVideoWidth=s;const i=this.getChatWidthFromVideoWidth(this.lastChosenVideoWidth);this.lastChosenChatWidth=Math.max(i,this.minChatWidth()),this.roomContents.repositionChildrenRecursive()},this.roomContents.element.onmouseup=()=>{this.handleResizeFinished()},this.roomContents.element.onmouseleave=()=>{this.handleResizeFinished()},this.isDragging=!0}),(0,r.wu)("touchmove",this.element,t=>{t.preventDefault(),1===t.targetTouches.length&&(this.roomContents.element.ontouchmove=()=>{const s=t.targetTouches.item(0);if(null!==s){const t=s.pageX-e.videoPanel.element.getBoundingClientRect().left-this.element.offsetWidth/2;this.handleResize(t),this.lastChosenVideoWidth=t;const i=this.getChatWidthFromVideoWidth(this.lastChosenVideoWidth);this.lastChosenChatWidth=Math.max(i,this.minChatWidth()),this.roomContents.repositionChildrenRecursive()}},this.roomContents.element.ontouchend=()=>{this.handleResizeFinished()},this.isDragging=!0)}),this.maybeApplyEvolveStyles(),window.setTimeout(()=>{this.element.style.cursor=this.getCursor(),(0,a.fZ)(this.element,"resizeHandle"),this.loadSettings(),this.handleResize(),this.handleResizeFinished()},0),b.L.changeVideoMode.listen(()=>{"split"===b.L.getVideoMode()&&(this.loadSettings(),this.handleResize())}),C.LQ.visibilityChanged.listen(()=>{"split"===b.L.getVideoMode()&&this.handleResize()}),(0,m.hL)()&&h.X0.listen(()=>{this.loadSettings(),this.handleResize()})}getChatWidthFromVideoWidth(e){return this.roomContents.getAvailableWidth()-e-v}getVideoWidthFromChatWidth(e){return this.roomContents.getAvailableWidth()-e-v}handleResizeSplitMode(e){const t=this.calculateSplitModeVideoPanelWidth(e);this.roomContents.videoPanel.element.style.width=`${t}px`;const s=this.getChatWidthFromVideoWidth(t);s>this.minChatWidth()&&(this.roomContents.videoPanel.element.style.minWidth=`${y}px`),s<e&&(this.roomContents.videoPanel.element.style.maxWidth=`${y}px`),l.bt||this.roomContents.videoPanel.updateAppPanel(),f.splitModeDragResize.fire()}handleResize(e){if((0,i.isRoomRoomlistSpaActive)()&&o.Db.getState().pageLocation!==o.Hb.RoomPage)return;let t=Math.max(null!=e?e:this.lastChosenVideoWidth,y+2);t=Math.min(this.getMaxVideoWidth(),t);const s=b.L.getVideoMode();switch(this.roomContents.videoPanel.element.style.minWidth="",this.roomContents.videoPanel.element.style.maxWidth="",s){case"split":void 0===e?(this.handleResizeSplitMode(this.lastChosenChatWidth),t=this.roomContents.videoPanel.element.offsetWidth):this.handleResizeSplitMode(this.getChatWidthFromVideoWidth(t));break;case"theater":this.roomContents.videoPanel.element.style.width=`${this.roomContents.getAvailableWidth()}px`;break;case"fullscreen":this.roomContents.videoPanel.element.style.width=`${window.innerWidth}px`;break;case"videoonly":case"noninteractive-fullscreen":break;default:error(`Unexpected VideoMode: ${s}`)}if(this.state.videoWidth=t,this.state.videoHeight=this.getHeightFromWidth(t),"split"===s){const e=this.getCursor();this.element.style.cursor=e,this.roomContents.element.style.cursor=e}}recordResizeHistory(){const e=parseInt(this.roomContents.chatTabContainer.element.style.width),t=parseInt(this.roomContents.chatTabContainer.element.style.height),s=this.resizeHistory[this.resizeHistory.length-1],i={videoMode:b.L.getVideoMode(),videoWidth:this.state.videoWidth,videoHeight:this.state.videoHeight,chatWidth:e,chatHeight:t};(void 0===s||s.videoWidth!==i.videoWidth||s.videoHeight!==i.videoHeight||s.videoMode!==i.videoMode)&&this.resizeHistory.push(i)}handleResizeFinished(){if(this.recordResizeHistory(),2===this.resizeHistory.length){const[e,t]=this.resizeHistory,s={video_width_old:e.videoWidth,video_height_old:e.videoHeight,video_width_new:t.videoWidth,video_height_new:t.videoHeight,chat_width_old:e.chatWidth,chat_height_old:e.chatHeight,chat_width_new:t.chatWidth,chat_height_new:t.chatHeight};(0,p.bT)("VideoResized",s),this.resizeHistory=this.resizeHistory.slice(1)}"split"===b.L.getVideoMode()&&(this.saveSettings(),this.roomContents.element.onmousemove=()=>{},this.roomContents.element.onmouseup=()=>{},this.roomContents.element.onmouseleave=()=>{},this.roomContents.element.ontouchend=()=>{},this.roomContents.element.ontouchmove=()=>{},this.roomContents.element.style.cursor="",this.isDragging=!1)}getMaxVideoWidth(){const e=this.roomContents.getAvailableWidth();return"split"===b.L.getVideoMode()?e-this.minChatWidth():e}getMaxVideoHeight(){return window.innerHeight-166}getCursor(){const e=this.roomContents.videoPanel.element.offsetWidth;return e<=y?"e-resize":e>=this.getMaxVideoWidth()?"w-resize":"ew-resize"}loadSettings(){if((0,n.Pf)()){const s=window.localStorage.getItem(this.getStorageKey());if(null!==s){var e,t;const i=JSON.parse(s);return this.state={videoWidth:i.videoWidth,videoHeight:i.videoHeight},this.lastChosenVideoWidth=null!==(e=i.lastChosenVideoWidth)&&void 0!==e?e:this.state.videoWidth,void(this.lastChosenChatWidth=null!==(t=i.lastChosenChatWidth)&&void 0!==t?t:332)}}"split"===b.L.getVideoMode()&&(this.setResolutionToMax({maximizeWidth:!0}),this.lastChosenVideoWidth=this.state.videoWidth)}saveSettings(){(0,n.Pf)()&&window.localStorage.setItem(this.getStorageKey(),JSON.stringify({videoWidth:this.state.videoWidth,videoHeight:this.state.videoHeight,lastChosenVideoWidth:this.lastChosenVideoWidth,lastChosenChatWidth:this.lastChosenChatWidth}))}getStorageKey(){return(0,m.hL)()&&o.Aw.getState().isPortrait?"defaultPortraitVideoWidth":"defaultVideoWidth"}repositionChildren(){this.handleResize(),this.isDragging||this.handleResizeFinished()}setResolutionToMax(){let{maximizeWidth:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{maximizeWidth:!1};const t=(0,u.DK)();let s,i;if(this.getMaxVideoWidth()-95>t/2){if(e){const e=(0,u.mJ)();if(e/t>this.getVideoAspectRatio())i=this.getMaxVideoWidth()-95;else{const t=e-200;i=this.getWidthFromHeight(t)}}else i=t/2;s=this.getHeightFromWidth(i)}else s=this.getMaxVideoHeight(),i=this.getWidthFromHeight(s);e||s>this.getMaxVideoHeight()&&(s=this.getMaxVideoHeight(),i=this.getWidthFromHeight(s)),i<y&&(i=y),this.state.videoWidth=i,this.state.videoHeight=s}getVideoAspectRatio(){return this.roomContents.videoPanel.player.getIsWidescreen()?g.qL:g.Bu}getHeightFromWidth(e){return e*this.getVideoAspectRatio()}getWidthFromHeight(e){return e/this.getVideoAspectRatio()}minChatWidth(){return C.qy&&C.qy.isVisible()?C.LQ.minTipMenuWidth:155}calculateSplitModeVideoPanelWidth(e){let t=Math.min(null!=e?e:this.lastChosenChatWidth,this.getChatWidthFromVideoWidth(y));return t=Math.max(t,this.minChatWidth()),this.getVideoWidthFromChatWidth(t)}calculateHeightFromWidth(e){return this.getHeightFromWidth(e)}maybeApplyEvolveStyles(){if(this.useEvolveStyles){const e=()=>{const e=document.createElement("div");(0,a.fZ)(e,"resizeHandle__indicatorContainer");const t=document.createElement("div");return(0,a.fZ)(t,"resizeHandle__indicatorBar"),e.appendChild(t),e.appendChild(t.cloneNode()),e},t=e();this.element.style.width="auto",this.element.appendChild(t)}}}f.splitModeDragResize=new c.c_("splitModeDragResize")},6561:(e,t,s)=>{s.d(t,{n:()=>Ue});var i=s(8638),n=s(9512),a=s(9275),o=s(2543),r=s(5559),l=s(8598),h=s(20),d=s(9447),c=s(9938),m=s(1005),u=s(478),p=s(6207),g=s(1885),b=s(4801),C=s(9461),v=s(4873),y=s(2331),T=s(3333),f=s(3502),S=s(2939),w=s(7197),x=s(1243),M=s(3955),R=s(8423),P=s(9060),U=s(7407),L=s(1452),D=s(1535),H=s(9898),A=s(2434),E=s(8255),B=s(8785),W=s(4947),I=s(4110),F=s(7250),k=s(9757),N=s(9505),_=s(6784),z=s(1516),O=s(2789),$=s(8440),V=s(5276),Z=s(9937),K=s(9603),Q=s(213),G=s(5216),q=s(5020),j=s(8451),J=s(1372),X=s(2690);class Y extends X.zf{constructor(){super({onShow:()=>{this.element.style.display="block",this.repositionChildrenRecursive()},onHide:()=>{this.element.style.display="none"},easyExit:!0}),this.isLoading=!1,this.loadingDiv=document.createElement("div"),this.contents=document.createElement("div"),this.preventChatFocus=!0,(0,d.fZ)(this.element,"BaseSettingsModal"),this.element.style.display="none",this.element.style.height="auto",this.element.style.width="auto",this.element.style.position="absolute",this.element.style.borderRadius="6px",this.element.style.padding="10px",this.element.style.fontSize="12px",this.overlay.style.backgroundColor="#000000",this.overlay.style.opacity="0.4",this.element.appendChild(this.contents),this.element.appendChild(this.loadingDiv);const e=document.createElement("img");e.src=`${STATIC_URL}loading.gif`,e.style.width="50px",e.style.height="50px",e.style.padding="14px",e.style.position="absolute",e.style.left="50%",e.style.top="50%",e.style.transform="translate(-50%, -50%",this.loadingDiv.appendChild(e);const t=this.createCloseButton();this.element.appendChild(t)}createCloseButton(){const e=document.createElement("div");return(0,d.fZ)(e,"closeButton"),e.style.position="absolute",e.style.width="14px",e.style.height="14px",e.style.top="10px",e.style.right="10px",e.style.cursor="pointer",e.style.opacity=".5",e.onclick=()=>{this.hide()},e.onmouseenter=()=>{e.style.opacity="1"},e.onmouseleave=()=>{e.style.opacity="0.5"},e}setLoading(e){this.isLoading=e,this.isLoading?(this.contents.style.visibility="hidden",this.loadingDiv.style.display="block"):(this.contents.style.visibility="visible",this.loadingDiv.style.display="none"),this.repositionChildrenRecursive()}reload(){this.isLoading||(this.setLoading(!0),this.loadData().then(e=>{void 0!==e?(this.data=e,this.setLoading(!1),this.onDataLoaded(),this.repositionChildrenRecursive()):this.hide()}).catch(e=>{this.setLoading(!1),this.hide(),(0,Q.Q$)("An error has occurred"),error(`Error loading settings modal: ${e}`)}))}onDataLoaded(){}repositionChildren(){const e=(document.documentElement.clientWidth-this.element.offsetWidth)/2,t=(document.documentElement.clientHeight-this.element.offsetHeight)/2;this.element.style.left=`${Math.max(e+window.pageXOffset,0)}px`,this.element.style.top=`${Math.max(t+window.pageYOffset,0)}px`}}var ee,te=s(2709);!function(e){e[e.More=-100]="More",e[e.Left=-200]="Left",e[e.Right=-300]="Right"}(ee||(ee={}));class se extends te.u{constructor(e){super(),this.props=e,this.currentPage=1,this.pageCount=1;const t={height:"25px",listStyle:"none",padding:0,display:"inline-block",marginBottom:0,font:"1.166em/1.577em 'UbuntuMedium',Arial,Helvetica,sans-serif",...this.props.overideStyle};this.element=(0,J.tT)("div",{style:{textAlign:"center"},colorClass:"pagination"},(0,J.tT)("ul",{style:t,ref:e=>this.pagiList=e})),this.updatePageDOM()}gotoPage(e){if(e===ee.Left){if(1===this.currentPage)return;this.currentPage-=1}else if(e===ee.Right){if(this.currentPage===this.pageCount)return;this.currentPage+=1}else this.currentPage=e;this.props.requestNewPage(this.currentPage),this.updatePageDOM()}range(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=e;const n=[];for(;i<=t;)n.push(i),i+=s;return n}updatePageDOM(){const e=this.currentPage-3,t=this.currentPage+3,s=e>2?e:2,i=t<this.pageCount?t:this.pageCount-1,n=this.range(s,i);s>2&&n.unshift(ee.More),i<this.pageCount-1&&n.push(ee.More);const a=[ee.Left,1,...n,this.pageCount,ee.Right],o={cssFloat:"left",minWidth:"21px",height:"21px",margin:"0 4px",textAlign:"center",lineHeight:"21px"},r={display:"inline-block",minWidth:"21px",height:"21px",textDecoration:"none",cursor:"pointer",borderRadius:"5px",lineHeight:"20px"};for(;null!==this.pagiList.firstChild;)this.pagiList.removeChild(this.pagiList.firstChild);a.map(e=>{let t;if(e===ee.More)t=(0,J.tT)("li",{style:o},"...");else if(e===ee.Left||e===ee.Right){const s=e===ee.Left?"◀":"▶";t=(0,J.tT)("li",{style:o,onClick:()=>{this.gotoPage(e)}},(0,J.tT)("a",{style:r,colorClass:"sidePagiAnchorColor"},s))}else t=e===this.currentPage?(0,J.tT)("li",{style:o,colorClass:"pagiActiveAnchorColor","data-testid":"pagination-current-page"},e):(0,J.tT)("li",{style:o,onClick:()=>{this.gotoPage(e)}},(0,J.tT)("a",{style:r,colorClass:"pagiAnchorColor",className:"pagiAnchor","data-testid":"pagination-page"},e));this.pagiList.appendChild(t)})}updatePageInfo(e,t){this.pageCount=e,this.currentPage=t,this.updatePageDOM()}}class ie{constructor(e){this.props=e,this.table=this.createTable(),this.pagination=this.createPagination(),this.props.rowHeaders.length===this.props.rowGenerators.length?(this.table.appendChild(this.createTableHeader()),this.element=(0,J.tT)("div",{colorClass:d.aG.textColor,"data-testid":this.props.dataTestId},this.createTableTitle(),this.createTableInfo(),this.createTableContainer(),this.pagination.element)):error("Settings table row header count does not match row generator count")}reset(){for(;null!==this.table.firstChild;)this.table.removeChild(this.table.firstChild);this.table.appendChild(this.createTableHeader())}addRow(e){this.table.appendChild(this.createRow(e))}updatePagination(e,t){e<=1?this.pagination.element.style.display="none":isNaN(e)||(this.pagination.element.style.display="",this.pagination.updatePageInfo(e,t))}createTableTitle(){return(0,J.tT)("div",{colorClass:"bluetxt",style:{fontSize:"1.4em",fontFamily:"'UbuntuMedium', Arial, Helvetica, sans-serif",fontWeight:"normal",textAlign:"center",marginTop:"20px"},"data-testid":"title"},this.props.title)}createTableInfo(){return(0,J.tT)("p",{style:{textAlign:"center"},"data-testid":"info"},this.props.info)}createTableContainer(){const e={width:"100%",minHeight:this.props.minHeight,borderWidth:"1px",borderStyle:"solid",borderRadius:"4px",boxSizing:"border-box"};return(0,J.tT)("div",{colorClass:"table",style:e},this.table)}createTable(){return(0,J.tT)("table",{style:{width:"100%",borderCollapse:"collapse"}})}createTableHeader(){return(0,J.tT)("thead",{style:{borderBottomWidth:"2px",borderBottomStyle:"solid"}},(0,J.tT)("tr",null,this.props.rowHeaders.map(e=>this.createTableHeaderCell(e))))}createTableHeaderCell(e){return(0,J.tT)("th",{style:{textAlign:"center",fontSize:"1.2em",padding:"3px"},"data-testid":"header"},e)}createRow(e){return(0,J.tT)("tr",{colorClass:"row",style:{height:"22px",verticalAlign:"middle",borderBottomWidth:"1px",borderBottomStyle:"solid"}},this.props.rowGenerators.map(t=>t(e)))}createPagination(){return new se({requestNewPage:e=>{this.props.onPageRequest(e)}})}}class ne extends Y{constructor(){super(),this.paginationLimit=12,this.searchTerm="",this.apiUrl="api/ts/chat/banned-terms-list/",(0,d.fZ)(this.element,d.aG.textColor),this.element.style.overflow="visible",this.contents.style.width="720px",this.contents.style.padding="10px",this.table=new ie({title:W.R.bannedTerms,info:W.R.bannedTermsInfo,onPageRequest:e=>{this.page=e,this.reload()},rowHeaders:[this.createHeaderTerm(),this.createHeaderSearchSubstrings(),W.R.remove],rowGenerators:[e=>this.createRowTerm(e),e=>this.createRowSearchSubstrings(e),e=>this.createRowRemove(e)],minHeight:"360px"}),this.contents.appendChild(this.table.element),this.contents.appendChild(this.createAddTermForm())}loadData(){let e=this.apiUrl;return""!==this.searchTerm?(e=`${this.apiUrl}?limit=${this.paginationLimit}&search_term=${this.searchTerm}`,this.searchTerm=""):void 0!==this.page&&(e=`${this.apiUrl}?page=${this.page}&limit=${this.paginationLimit}`),(0,G.Aw)(e).then(e=>function(e){const t=new n.N6(e),s=t.getList("banned_terms");let i=[];return void 0!==s&&(i=s.map(e=>({term:e.getString("term"),banType:e.getString("ban_type")}))),{bannedTerms:i,pageCount:t.getNumber("page_count",!1),currentPage:t.getNumber("current_page",!1)}}(e.responseText))}onDataLoaded(){this.page=this.data.currentPage,this.table.updatePagination(this.data.pageCount,this.page),this.generateTable(),""!==this.termInput.value&&this.termInput.focus(),this.termInput.value=""}generateTable(){this.table.reset();for(const e of this.data.bannedTerms)this.table.addRow(e)}createHeaderTerm(){return(0,J.tT)("div",{style:{width:"308px"}},W.R.term)}createHeaderSearchSubstrings(){const e={width:"14px",height:"14px",background:`transparent url(${STATIC_URL}broadcastnotification/infoicon.svg) no-repeat right 50%`,backgroundSize:"contain",display:"inline-block",marginLeft:"4px",position:"relative",verticalAlign:"top"},t=(0,K.q)({content:W.R.banAsSubstringExplanation,hasHTML:!1,width:(0,M.jl)(W.R.banAsSubstringExplanation,"12px UbuntuLight")+8,divotPosition:q.Wi.Bottom,divotLeftOrTop:"28px"});return(0,M.ZM)(t,{bottom:"20px",left:"-32px",textAlign:"left",maxWidth:"280px",fontFamily:"UbuntuLight, Helvetica, Arial, sans-serif"}),(0,J.tT)("div",null,W.R.banAsSubstring,(0,J.tT)("span",{style:e,onMouseEnter:()=>t.style.display="",onMouseLeave:()=>t.style.display="none"},t))}createRowTerm(e){const t=(0,J.tT)("td",{style:{textAlign:"center",fontSize:"14px",overflowWrap:"break-word",hyphens:"auto",width:"300px",paddingLeft:"8px",display:"inline-block",lineHeight:"25px"}},e.term);return V.A.parse(t),t}createRowSearchSubstrings(e){const t=new Z.l("substring"===e.banType,()=>{},{width:28,height:16});return t.setOnChange(()=>{const s=t.isChecked()?"substring":"exact";(0,G.$e)(this.apiUrl,{term:e.term,ban_type:s}).catch(()=>{t.setCheckedDirectly(!t.isChecked()),(0,Q.Q$)(W.R.errorUpdatingTerm)})}),(0,J.tT)("td",{style:{textAlign:"center",padding:"4px 0"}},t.element)}createRowRemove(e){const t=(0,J.tT)("div",{colorClass:"removeButton",style:{margin:"auto",width:"14px",height:"14px",cursor:"pointer",opacity:".5"},onClick:()=>this.removeTerm(e),onMouseEnter:()=>{t.style.opacity="1"},onMouseLeave:()=>{t.style.opacity=".5"}});return(0,J.tT)("td",null,t)}createAddTermForm(){return this.termInput=(0,J.tT)("input",{style:{width:"160px",height:"16px",margin:"0 8px"},type:"text",name:"term",maxLength:30,placeholder:W.R.enterTermToBan}),(0,_.wu)("keydown",document,e=>{document.body.contains(this.element)&&document.activeElement!==this.termInput&&(0,j.T6)(e)&&this.termInput.focus()}),(0,J.tT)("form",{colorClass:"bluetxt",style:{fontSize:"1.12em",fontFamily:"'UbuntuMedium', Arial, Helvetica, sans-serif",fontWeight:"normal",margin:"20px 0 8px",textAlign:"center"},onSubmit:e=>{e.preventDefault();const t=this.termInput.value.trim();""!==t?(0,G.KF)(this.apiUrl,{term:t}).then(()=>{this.searchTerm=t,this.reload()}).catch(e=>{const t=JSON.parse(e.xhr.responseText);if("string"==typeof t.error){const e=JSON.parse(t.error);(0,Q.Q$)(e.term[0].message,()=>this.termInput.focus())}else(0,Q.Q$)(W.R.errorBanningTerm,()=>this.termInput.focus())}):(0,Q.Q$)(W.R.pleaseEnterTermToBan,()=>this.termInput.focus())}},(0,J.tT)("label",null,W.R.addTerm,":"),this.termInput,(0,J.tT)("button",{style:{cursor:"pointer",fontFamily:"'UbuntuMedium', Arial, Helvetica, sans-serif"},type:"submit",colorClass:"submitButton"},W.R.inlineBanText))}removeTerm(e){(0,G.ju)(this.apiUrl,{term:e.term}).then(()=>{this.reload()}).catch(()=>{(0,Q.Q$)(W.R.errorRemovingTerm)})}}function ae(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=[];for(const s of e)t.push({username:s.getString("username"),created_by:s.getString("created_by"),expires_at:s.getString("expires_at"),created_at:s.getString("created_at"),id:s.getNumber("id")});return t}let oe,re;S.X0.listen(e=>{oe=e.chatConnection.room()});class le extends Y{constructor(){super(),this.paginationLimit=12,this.clearHiddenSilences=document.createElement("p"),this.clearHiddenBans=document.createElement("p"),this.clearHiddenSilencesMessage=document.createTextNode(""),this.clearHiddenBansMessage=document.createTextNode(""),this.banType=["banned","silenced"],(0,d.fZ)(this.element,d.aG.textColor),this.contents.style.width="720px",this.contents.style.padding="10px",this.silenceTable=new ie({title:W.R.silencedTableTitle,info:W.R.silencedUsersInfo,onPageRequest:e=>{this.banType=["silenced"],this.page=e,this.reload()},rowHeaders:[W.R.usernameText,W.R.silenced,W.R.expires,W.R.actions],rowGenerators:[e=>this.createRowName(e),e=>this.createRowCreationInfo(e),e=>this.createRowExpires(e),e=>this.createRowActions(e,!1)],minHeight:"286px",dataTestId:"silenced-users-table"}),this.banTable=new ie({title:W.R.bannedTableTitle,info:W.R.bannedUsersInfo,onPageRequest:e=>{this.banType=["banned"],this.page=e,this.reload()},rowHeaders:[W.R.usernameText,W.R.banned,W.R.expires,W.R.actions],rowGenerators:[e=>this.createRowName(e),e=>this.createRowCreationInfo(e),e=>this.createRowExpires(e),e=>this.createRowActions(e,!0)],minHeight:"286px",dataTestId:"banned-users-table"});const e=document.createElement("hr");e.style.marginTop="12px",this.createClearHiddenSilencesAndBans(this.clearHiddenSilences,this.clearHiddenSilencesMessage),this.createClearHiddenSilencesAndBans(this.clearHiddenBans,this.clearHiddenBansMessage),this.contents.dataset.testid="silenced-and-banned-users-modal",this.contents.appendChild(this.silenceTable.element),this.contents.appendChild(this.clearHiddenSilences),this.contents.appendChild(e),this.contents.appendChild(this.banTable.element),this.contents.appendChild(this.clearHiddenBans),this.contents.appendChild(document.createElement("br")),this.contents.appendChild(this.createAddBansForm())}loadData(){let e="api/ts/chat/ban-list/";return void 0!==this.page&&(e=`api/ts/chat/ban-list/?ban_types=${this.banType.toString()}&page=${this.page}&limit=${this.paginationLimit}`),(0,G.Aw)(e).then(e=>function(e){const t=new n.N6(e),s=t.getMap("ban_dict",!1),i=t.getMap("silence_dict",!1);return{perm:t.getString("perm"),banDict:{bans:ae(s.getList("bans")),pageCount:s.getNumber("page_count",!1),currentPage:s.getNumber("current_page",!1),hiddenBans:s.getNumber("hidden_bans",!1)},silenceDict:{silences:ae(i.getList("silences")),pageCount:i.getNumber("page_count",!1),currentPage:i.getNumber("current_page",!1),hiddenSilences:i.getNumber("hidden_silences",!1)}}}(e.responseText))}onDataLoaded(){this.silenceTable.updatePagination(this.data.silenceDict.pageCount,this.data.silenceDict.currentPage),this.banTable.updatePagination(this.data.banDict.pageCount,this.data.banDict.currentPage),this.generateTables(),this.generateClearSilencesAndBansMessages(),this.resetLoadParams()}generateTables(){if(this.resetTables(),this.banType.includes("silenced"))for(const e of this.data.silenceDict.silences)this.isUserBanned(e.username)||this.silenceTable.addRow(e);if(this.banType.includes("banned"))for(const e of this.data.banDict.bans)this.banTable.addRow(e)}isUserBanned(e){for(const t of this.data.banDict.bans)if(e===t.username)return!0;return!1}resetTables(){this.banType.includes("silenced")&&this.silenceTable.reset(),this.banType.includes("banned")&&this.banTable.reset()}createRowName(e){const t=e.username,s=document.createElement("td"),i=document.createElement("a");return i.dataset.testid="username-link",(0,d.fZ)(i,d.aG.hrefColor),i.href=(0,G._Y)(`/${t}`),i.target="_blank",i.innerText=t,i.style.fontSize="15px",s.style.textAlign="center",i.style.textOverflow="ellipsis",i.style.overflow="hidden",i.style.marginTop="4px",s.appendChild(i),s}createRowCreationInfo(e){const t=e.created_at,s=e.created_by,i=document.createElement("td");i.title=W.R.createdAt(new Date(t)),i.style.fontSize="12px",i.style.textAlign="center",i.style.textOverflow="ellipsis",i.style.overflow="hidden",i.style.marginTop="4px";const a=document.createElement("span");a.dataset.testid="created-at",a.innerText=(0,n.jM)(new Date,new Date(t));const o=this.createByUsername(` ${W.R.createdByUsername(s)}`);return o.dataset.testid="created-by",i.appendChild(a),i.appendChild(o),i}createRowExpires(e){const t=e.expires_at,s=new Date(e.expires_at)>new Date(this.data.perm),i=document.createElement("td");return i.title=W.R.expiresOn(new Date(t)),i.dataset.testid="expires-at",i.innerText=s?W.R.never:(0,n.jM)(new Date,new Date(t)),i.style.textAlign="center",i.style.fontSize="12px",i.style.textOverflow="ellipsis",i.style.overflow="hidden",i}createRowActions(e,t){const s=e.id,i=new Date(e.expires_at)>new Date(this.data.perm),n=document.createElement("td"),a=document.createElement("a"),o=document.createElement("a"),r=document.createTextNode(" | ");return(0,d.fZ)(a,d.aG.hrefColor),(0,d.fZ)(o,d.aG.hrefColor),a.style.cursor="pointer",o.style.cursor="pointer",a.innerText=W.R.remove,o.innerText=t?W.R.makePermanent:W.R.convertToBan,n.style.textAlign="center",a.dataset.testid="remove-user",o.dataset.testid="convert-user",n.appendChild(a),i||(n.appendChild(r),n.appendChild(o)),a.onclick=()=>{this.editRoomBan(s,t?"remove_ban":"remove_silence")},o.onclick=()=>{this.editRoomBan(s,t?"ban_perm":"convert_to_ban")},n}createByUsername(e){const t=document.createElement("span");return(0,d.fZ)(t,"byUsername"),t.innerText=e,t.style.fontSize="0.8em",t}editRoomBan(e,t){(0,G.KF)("edit_room_ban/",{banid:String(e),action:t,room_username:oe}).then(e=>{const t=e.responseText;if(null===t)return(0,Q.Q$)(W.R.errorOccurred),void this.reload();let s;try{s=JSON.parse(t)}catch{return(0,Q.Q$)(W.R.errorOccurred),void this.reload()}void 0!==s.error?((0,Q.Q$)(s.error),void 0!==s.reload&&!0===s.reload&&this.reload()):this.reload()}).catch(()=>{(0,Q.Q$)(W.R.errorOccurred)})}getNumberOfHiddenSilences(){return this.data.silenceDict.hiddenSilences?this.data.silenceDict.hiddenSilences:0}getNumberOfHiddenBans(){return this.data.banDict.hiddenBans?this.data.banDict.hiddenBans:0}createClearHiddenSilencesAndBans(e,t){e.style.textAlign="center",e.appendChild(t);const s=document.createElement("a");(0,d.fZ)(s,d.aG.hrefColor),s.style.cursor="pointer",s.innerText=W.R.clickToClearHiddenBansAndSilences,s.onclick=()=>{(0,G.KF)(`clear_hidden_banned_users/${oe}/`,{}).then(e=>{!0===new n.N6(e.responseText).getBooleanOrUndefined("is_async")&&(0,Q.Q$)(W.R.hiddenBansRequestProcessing),this.reload()}).catch(()=>{(0,Q.Q$)(W.R.hiddenBansRequestError)})},e.appendChild(document.createElement("br")),e.appendChild(s)}generateClearSilencesAndBansMessages(){const e=this.getNumberOfHiddenSilences(),t=this.getNumberOfHiddenBans();this.clearHiddenSilences.style.display=0===e?"none":"",this.clearHiddenBans.style.display=0===t?"none":"",this.clearHiddenSilencesMessage.textContent=W.R.automaticallySilencedUsersMessage(e),this.clearHiddenBansMessage.textContent=W.R.automaticallyBannedUsersMessage(t)}createAddBansForm(){const e=document.createElement("form"),t=document.createElement("label"),s=document.createElement("input"),i=document.createElement("button");return(0,d.fZ)(i,"submitButton"),i.style.borderWidth="1px",i.style.borderStyle="solid",i.style.borderRadius="4px",i.style.cursor="pointer",i.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",t.innerText=`${W.R.addBan}:`,s.type="text",s.placeholder=W.R.enterUsernameToBan,i.type="submit",i.innerText=W.R.inlineBanText,e.appendChild(t),e.appendChild(s),e.appendChild(i),(0,d.fZ)(e,"bluetxt"),e.style.fontSize="1.12em",e.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",e.style.fontWeight="normal",e.style.marginBottom="20px",e.style.textAlign="center",s.style.width="160px",s.style.height="16px",s.style.margin="0 3px",(0,_.wu)("keydown",document,e=>{document.body.contains(this.element)&&document.activeElement!==s&&(0,j.T6)(e)&&s.focus()}),e.onsubmit=e=>{e.preventDefault();const t=s.value.toLowerCase();""!==t?(0,l.X3)(t,oe).then(()=>{s.value="",(0,Q.Q$)(W.R.banUserSuccess(t),()=>s.focus()),this.reload()}).catch(e=>{(0,Q.Q$)(e.message,()=>s.focus())}):(0,Q.Q$)(W.R.usernameToBan,()=>s.focus())},e}resetLoadParams(){this.banType=["banned","silenced"],this.page=void 0}}function he(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=[];for(const s of e)t.push({username:s.getString("username"),created_at:s.getString("created_at"),total:s.getNumber("total")});return t}function de(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=[];for(const s of e)t.push({username:s.getString("username"),months:s.getNumber("months")});return t}class ce extends Y{constructor(){super(),this.contentContainer=document.createElement("div"),this.fanClubTable=this.createTable(),this.fanClubTitle=this.createStyledTitle(),this.fanClubTableBody=document.createElement("tbody"),this.membersTable=this.createTable(),this.membersTitle=this.createStyledTitle(),this.membersTableBody=document.createElement("tbody"),this.contents.style.width="550px",this.contents.style.padding="10px",this.contentContainer.dataset.testid="fan-club-modal",this.contents.appendChild(this.contentContainer);const e=this.createTableContainer(),t=this.createTableContainer();e.appendChild(this.fanClubTable),t.appendChild(this.membersTable),this.fanClubTableBody.dataset.testid="fan-club-table",this.setupTitles();const s=document.createElement("p");(0,d.fZ)(s,d.aG.textColor),s.innerText=W.R.currentFanClubMembersInfo,s.style.textAlign="center";const i=document.createElement("p");(0,d.fZ)(i,d.aG.textColor),i.style.textAlign="center",i.innerHTML=W.R.allFanClubMembersInfo,this.contentContainer.appendChild(this.fanClubTitle),this.contentContainer.appendChild(s),this.contentContainer.appendChild(e),this.fanClubTable.appendChild(this.createFanClubTableHeader()),this.fanClubTable.appendChild(this.fanClubTableBody),this.contentContainer.appendChild(document.createElement("br")),this.contentContainer.appendChild(document.createElement("hr")),this.contentContainer.appendChild(this.membersTitle),this.contentContainer.appendChild(i),this.contentContainer.appendChild(t),this.membersTable.appendChild(this.createMembersTableHeader()),this.membersTable.appendChild(this.membersTableBody),this.emptyMessageContainer=document.createElement("div"),this.hideEmptyMessage(),this.emptyMessageContainer.appendChild(this.createEmptyMessage()),this.contents.appendChild(this.emptyMessageContainer)}loadData(){return(0,G.Aw)("api/ts/chat/fan-list/").then(e=>function(e){const t=new n.N6(e);return{fans:he(t.getList("fans")),old_members:de(t.getList("old_members")),all_members:de(t.getList("all_members"))}}(e.responseText))}onDataLoaded(){0===this.data.all_members.length?this.displayEmptyMessage():(this.generateTables(),this.updateTitles())}createTable(){const e=document.createElement("table");return e.style.width="100%",e.style.borderCollapse="collapse",e}createStyledTitle(){const e=document.createElement("div");return(0,d.fZ)(e,"bluetxt"),e.style.fontSize="1.4em",e.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",e.style.fontWeight="normal",e.style.textAlign="center",e.style.marginTop="20px",e}createTableContainer(){const e=document.createElement("div");return(0,d.fZ)(e,"select"),e.style.width="100%",e.style.height=document.documentElement.clientHeight/3.5+"px",e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.borderRadius="4px",e.style.overflowY="scroll",e}setupTitles(){this.fanClubTitle.innerText=W.R.currentFanClubMembersTitle(this.getNumberOfMembers()),this.membersTitle.innerText="All Members"}updateTitles(){this.fanClubTitle.innerText=W.R.currentFanClubMembersTitle(this.getNumberOfMembers())}createEmptyMessage(){const e=document.createElement("span");return(0,d.fZ)(e,"bluetxt"),e.innerText="No Current or Previous Fan Club Members",e.innerText="No Current or Previous Fan Club Members",e.style.fontSize="1.4em",e.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",e.style.fontWeight="normal",e.style.textAlign="center",e.style.marginTop="20px",e}displayEmptyMessage(){this.contentContainer.style.display="none",this.emptyMessageContainer.style.display=""}hideEmptyMessage(){this.emptyMessageContainer.style.display="none",this.contentContainer.style.display=""}getNumberOfMembers(){return void 0===this.data?0:this.data.fans.length}generateTables(){this.clearTables();for(const e of this.data.fans)this.fanClubTableBody.appendChild(this.createFanClubRow(e));for(const e of this.data.all_members)this.membersTableBody.appendChild(this.createMembersRow(e,this.isCurrentMember(e.username)))}clearTables(){for(;null!==this.fanClubTableBody.firstChild;)this.fanClubTableBody.removeChild(this.fanClubTableBody.firstChild);for(;null!==this.membersTableBody.firstChild;)this.membersTableBody.removeChild(this.membersTableBody.firstChild)}createFanClubRow(e){const t=document.createElement("tr");return t.style.height="22px",t.style.verticalAlign="middle",t.style.borderBottom="1px solid darkgray",t.appendChild(this.createRowName(e.username)),t.appendChild(this.createRowSince(e.created_at)),t.appendChild(this.createRowMonths(e.total)),t}createMembersRow(e,t){const s=document.createElement("tr");return s.style.height="22px",s.style.verticalAlign="middle",s.style.borderBottom="1px solid darkgray",t&&(s.style.fontWeight="bold"),s.appendChild(this.createRowName(e.username)),s.appendChild(this.createRowMonths(e.months)),s}createRowName(e){const t=document.createElement("td"),s=document.createElement("a");return(0,d.fZ)(s,"bluetxt"),s.href=(0,G._Y)(`/${e}`),s.target="_blank",s.innerText=e,s.style.fontSize="15px",s.style.textAlign="left",s.style.textOverflow="ellipsis",s.style.overflow="hidden",s.style.paddingLeft="12px",s.style.marginTop="4px",t.appendChild(s),t}createRowSince(e){const t=document.createElement("td");return t.title=`Since ${new Date(e).toString()}`,t.style.fontSize="12px",t.style.textAlign="center",t.style.textOverflow="ellipsis",t.style.overflow="hidden",t.style.paddingLeft="6px",t.style.marginTop="4px",t.innerText=(0,n.jM)(new Date,new Date(e)),t}createRowMonths(e){const t=document.createElement("td");return t.style.fontSize="12px",t.style.textAlign="center",t.style.textOverflow="ellipsis",t.style.overflow="hidden",t.style.paddingLeft="6px",t.style.marginTop="4px",t.innerText=`${e} month${1===e?"":"s"}`,t}createFanClubTableHeader(){const e=document.createElement("thead");e.style.borderBottom="2px solid darkgray";const t=document.createElement("tr");return t.appendChild(this.createTableHeaderCell(W.R.usernameText)),t.appendChild(this.createTableHeaderCell(W.R.lastJoined)),t.appendChild(this.createTableHeaderCell(W.R.totalMonthsAMember)),e.appendChild(t),e}createMembersTableHeader(){const e=document.createElement("thead");e.style.borderBottom="2px solid darkgray";const t=document.createElement("tr");return t.appendChild(this.createTableHeaderCell(W.R.usernameText)),t.appendChild(this.createTableHeaderCell(W.R.totalMonthsAMember)),e.appendChild(t),e}createTableHeaderCell(e){const t=document.createElement("th");return t.innerText=e,t.style.textAlign="center",t.style.fontSize="1.2em",t.style.padding="3px",t}isCurrentMember(e){for(const t of this.data.old_members)if(t.username===e)return!1;return!0}}S.X0.listen(e=>{re=e.chatConnection.room()});class me extends Y{constructor(){super();const e=document.createElement("div");(0,d.fZ)(e,"bluetxt"),e.innerText=W.R.removeModerators,e.style.fontSize="15px",e.style.fontFamily="UbuntuMedium, Helvetica, Arial, sans-serif",e.style.textAlign="center",this.contents.appendChild(e);const t=document.createElement("div");(0,d.fZ)(t,d.aG.textColor),t.innerText=W.R.clickToUnmodText,t.style.margin="10px 0",t.style.textAlign="center",this.contents.appendChild(t);const s=document.createElement("div");s.style.display="inline-block",s.style.marginRight="10px";const i=document.createElement("div");(0,d.fZ)(i,"bluetxt"),i.innerText=W.R.moderators,i.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",i.style.fontWeight="bold",s.appendChild(i),this.modSelect=document.createElement("select"),(0,d.fZ)(this.modSelect,"select"),this.modSelect.multiple=!0,this.modSelect.style.borderWidth="1px",this.modSelect.style.borderStyle="solid",this.modSelect.style.borderRadius="4px",this.modSelect.style.marginTop="4px",this.modSelect.style.width="200px",this.modSelect.style.height="200px",this.modSelect.style.padding="2px",this.modSelect.onchange=()=>{const e=this.modSelect.selectedOptions.length,t=[...this.modSelect.selectedOptions];for(let s=0;s<e;s+=1){const e=t[s];e.selected=!1,this.unmodSelect.appendChild(e)}},s.appendChild(this.modSelect),this.contents.appendChild(s);const n=document.createElement("div");n.style.display="inline-block";const a=document.createElement("div");(0,d.fZ)(a,"bluetxt"),a.innerText=W.R.nonModerators,a.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",a.style.fontWeight="bold",n.appendChild(a),this.unmodSelect=document.createElement("select"),(0,d.fZ)(this.unmodSelect,"select"),this.unmodSelect.multiple=!0,this.unmodSelect.style.borderWidth="1px",this.unmodSelect.style.borderStyle="solid",this.unmodSelect.style.borderRadius="4px",this.unmodSelect.style.marginTop="4px",this.unmodSelect.style.width="200px",this.unmodSelect.style.height="200px",this.unmodSelect.style.padding="2px",this.unmodSelect.onchange=()=>{const e=this.unmodSelect.selectedOptions.length,t=[...this.unmodSelect.selectedOptions];for(let s=0;s<e;s+=1){const e=t[s];e.selected=!1,this.modSelect.appendChild(e)}},n.appendChild(this.unmodSelect),this.contents.appendChild(n);const o=document.createElement("div");o.style.textAlign="right";const r=document.createElement("span");(0,d.fZ)(r,"saveButton"),(0,d.fZ)(r,"gradient"),r.innerText=W.R.saveCAPS,r.style.display="inline-block",r.style.fontFamily="UbuntuMedium, Helvetica, Arial, sans-serif",r.style.fontSize="14px",r.style.padding="5px 15px 5px 15px",r.style.marginTop="10px",r.style.borderRadius="4px",r.style.cursor="pointer",o.appendChild(r),r.onclick=()=>{for(const e of this.unmodSelect.options)(0,G.KF)(`removemoderator/${e.value}/${re}/`,{}).then().catch(()=>{(0,Q.Q$)(`An error occurred removing moderator status from ${e.value}`)});this.hide()},this.contents.appendChild(o)}loadData(){return(0,G.Aw)("api/ts/chat/mod-list/").then(e=>{return t=e.responseText,{mods:new n.N6(t).getStringList("mods")};var t})}onDataLoaded(){for(;null!==this.modSelect.firstChild;)this.modSelect.removeChild(this.modSelect.firstChild);for(;null!==this.unmodSelect.firstChild;)this.unmodSelect.removeChild(this.unmodSelect.firstChild);for(const e of this.data.mods){const t=document.createElement("option");t.innerText=e,t.value=e,this.modSelect.appendChild(t)}}}class ue extends Y{constructor(){super(),this.page=1,this.paginationLimit=12,this.searchTerm="",this.apiUrl="api/ts/chat/geo-list/",this.inputResponseMsg=document.createElement("div"),this.handleAPIError=e=>{const t=JSON.parse(e.xhr.responseText);"string"==typeof t.error?this.setInputResponseMessage(t.error,!0):this.setInputResponseMessage(W.R.anErrorOccurred,!0)},this.table=new ie({title:W.R.regionBlockExemptions,info:W.R.regionBlockExemptionsInfo,onPageRequest:e=>{this.page=e,this.reload()},rowHeaders:[this.createUsernameHeader(),W.R.remove],rowGenerators:[e=>this.createUsernameCell(e),e=>this.createRemoveCell(e)],minHeight:"350px"}),this.table.element.style.marginBottom="10px",this.contents.appendChild(this.table.element),this.buildAddUsernameForm(),this.contents.appendChild(this.addUsernameForm)}createUsernameHeader(){const e=document.createElement("span");return e.style.display="inline-block",e.style.width="100%",e.style.textAlign="left",e.style.paddingLeft="29px",e.textContent=W.R.usernameText,e}createUsernameCell(e){const t=document.createElement("td");return t.style.height="20px",t.style.width="200px",t.style.fontSize="14px",t.style.textAlign="left",t.style.textOverflow="ellipsis",t.style.overflow="hidden",t.style.display="block",t.style.paddingLeft="32px",t.style.marginTop="4px",t.textContent=e,t.dataset.testid="username",t}createRemoveCell(e){const t=document.createElement("td");t.style.width="140px";const s=document.createElement("div");return(0,d.fZ)(s,"removeButton"),s.style.margin="auto",s.style.width="14px",s.style.height="14px",s.style.cursor="pointer",s.style.opacity=".5",s.onclick=()=>this.delete(e),s.onmouseenter=()=>{s.style.opacity="1"},s.onmouseleave=()=>{s.style.opacity=".5"},t.appendChild(s),t}buildAddUsernameForm(){const e=document.createElement("form");e.style.fontSize="1.12em",e.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",e.style.fontWeight="normal",e.style.textAlign="center",e.style.paddingLeft="4px";const t="regionBlockInput",s=document.createElement("label");(0,d.fZ)(s,"bluetxt"),s.innerText=`${W.R.addUsername}:`,s.htmlFor=t,s.dataset.testid="input-label",e.appendChild(s);const i=document.createElement("input");(0,d.fZ)(i,"select"),i.id=t,i.style.width="134px",i.style.height="16px",i.style.margin="0 8px",i.type="text",i.placeholder=W.R.enterUsernameToExemptRegionBlock,i.dataset.testid="add-username-input",e.appendChild(i);const n=document.createElement("button");(0,d.fZ)(n,"submitButton"),n.style.cursor="pointer",n.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",n.type="submit",n.innerText=W.R.add,n.dataset.testid="add-username-button",e.appendChild(n);const a=document.createElement("div");a.style.marginTop="4px",e.appendChild(a),e.onsubmit=e=>{e.preventDefault(),this.submit()},this.usernameInput=i,this.inputResponseMsg=a,this.addUsernameForm=e}setInputResponseMessage(e,t){t?((0,d.SA)(this.inputResponseMsg,"bluetxt"),(0,d.fZ)(this.inputResponseMsg,"inputError"),this.inputResponseMsg.style.fontSize="0.8em",this.inputResponseMsg.dataset.testid="exemption-error"):((0,d.SA)(this.inputResponseMsg,"inputError"),(0,d.fZ)(this.inputResponseMsg,"bluetxt"),this.inputResponseMsg.style.fontSize="0.8em",this.inputResponseMsg.dataset.testid="exemption-success"),this.inputResponseMsg.innerText=e,this.inputResponseMsg.style.transition="opacity 0ms",this.inputResponseMsg.style.opacity="1",clearTimeout(this.responseTimer),this.responseTimer=window.setTimeout(()=>{this.inputResponseMsg.style.transition="opacity 1000ms",this.inputResponseMsg.style.opacity="0"},2500)}loadData(){let e;return""!==this.searchTerm?(e=`${this.apiUrl}?limit=${this.paginationLimit}&search_term=${this.searchTerm}`,this.searchTerm=""):e=`${this.apiUrl}?page=${this.page}&limit=${this.paginationLimit}`,(0,G.Aw)(e).then(e=>function(e){const t=new n.N6(e);return{geos:t.getStringList("geos"),pageCount:t.getNumber("page_count",!1),currentPage:t.getNumber("current_page",!1)}}(e.responseText))}onDataLoaded(){this.page=this.data.currentPage,this.table.updatePagination(this.data.pageCount,this.page),this.table.reset(),this.usernameInput.focus();for(const e of this.data.geos.sort())this.table.addRow(e)}submit(){const e=this.usernameInput.value;this.usernameInput.value="",(0,G.KF)(this.apiUrl,{username:e}).then(()=>{this.searchTerm=e,this.reload(),this.setInputResponseMessage(W.R.userAddedToExemptList,!1)}).catch(this.handleAPIError).finally(()=>this.usernameInput.focus())}delete(e){(0,G.ju)(this.apiUrl,{username:e}).then(()=>{this.reload()}).catch(this.handleAPIError)}}class pe extends z.m{constructor(){super()}initData(){super.initData(),this.regionBlockModal=new ue,this.bansAndSilencesModal=new le,this.moderatorsModal=new me,this.fanClubModal=new ce,this.bannedTermsModal=new ne}initUI(){super.initUI(),this.createChatursafeFilterSettings()}createChatursafeFilterSettings(){if(!(0,P.DG)())return;const e=document.createElement("div"),t=k.c.get("ChatursafeFilterSetting"),s=C.Aw.getState().chatursafeFilterSettings,n=k.c.get("SharedToastContainer");if(void 0!==n){const e=document.createElement("div");e.id="chatursafe-filter-toast-container",new n({containerId:"chat-settings-toast-container",style:{position:"absolute"}},e),this.element.appendChild(e)}s||error("Chatursafe filter settings not found in dossier."),new t({filterSettings:s,saveCallback:(e,t)=>{(!0===t||void 0===e&&void 0===t)&&(0,$.P)({message:i.i._({id:"A8mzVE",message:"Filter preference updated"}),type:"chatursafe-filter-updated"})}},e),(0,$.P)({message:i.i._({id:"A8mzVE",message:"Filter preference updated"}),type:"chatursafe-filter-updated"}),this.form.prepend(e),this.getStyles().styleHeader(this.fontSettingsHeader,i.i._({id:"yaw+7x",message:"Font Settings"}))}createUserSettings(){this.usersSettings.appendChild(this.createSortUsers()),this.usersSettings.appendChild(this.createHighestTokenColorPicker()),this.usersSettings.appendChild(this.createChatAllowedBy()),this.usersSettings.appendChild(this.createModeratorsExpireAfter()),this.usersSettings.appendChild(this.createSilenceOtherBroadcasters())}createNotificationSettings(){super.createNotificationSettings(),this.notificationsSettings.appendChild(this.createC2CNotificationLimit())}createOtherSettings(){this.otherSettings.appendChild(this.createTipVolumePicker()),this.otherSettings.appendChild(this.createCollapseNoticesPicker()),this.otherSettings.appendChild(this.createModalLink(W.R.viewEditBansAndSilences,this.bansAndSilencesModal,"view-edit-bans-and-silences")),this.otherSettings.appendChild(this.createModalLink(W.R.viewEditModerators,this.moderatorsModal,"view-edit-moderators")),this.otherSettings.appendChild(this.createModalLink(W.R.viewFanClubMembers,this.fanClubModal,"view-fan-club-members")),this.otherSettings.appendChild(this.createModalLink(W.R.viewEditRegionBlockExemptions,this.regionBlockModal,"view-edit-region-block-exemptions")),this.otherSettings.appendChild(this.createManageIgnoredUsersPicker()),this.otherSettings.appendChild(this.createModalLink(W.R.viewEditBannedTerms,this.bannedTermsModal,"view-edit-banned-terms"))}createSortUsers(){const e=document.createElement("label");return this.sortUsersSelect=document.createElement("select"),this.sortUsersSelect.dataset.testid="sort-users-select",this.createRow(e,W.R.sortUsers,this.sortUsersSelect,this.getSortUsersOptions())}createChatAllowedBy(){return this.chatAllowedByLabel=document.createElement("label"),this.chatAllowedBySelect=document.createElement("select"),this.chatAllowedBySelect.dataset.testid="chat-allowed-by-select",this.createRow(this.chatAllowedByLabel,W.R.chatAllowedBy,this.chatAllowedBySelect,this.getChatAllowedByOptions())}createModeratorsExpireAfter(){const e=document.createElement("label");return this.moderatorsExpireAfterSelect=document.createElement("select"),this.moderatorsExpireAfterSelect.dataset.testid="moderators-expire-after-select",this.createRow(e,W.R.moderatorsExpireAfter,this.moderatorsExpireAfterSelect,this.getModeratorsExpireAfterOptions())}createSilenceOtherBroadcasters(){const e=document.createElement("label");return this.silenceOtherBroadcastersSelect=document.createElement("select"),this.silenceOtherBroadcastersSelect.dataset.testid="silence-other-broadcasters-select",this.createRow(e,W.R.silenceOtherBroadcasters,this.silenceOtherBroadcastersSelect,this.getSilenceOtherBroadcastersOptions())}createC2CNotificationLimit(){const e=document.createElement("label");return this.c2cNotificationLimitSelect=document.createElement("select"),this.c2cNotificationLimitSelect.dataset.testid="notify-rate-limit-select",this.createRow(e,W.R.preventC2CRedisplay,this.c2cNotificationLimitSelect,this.getC2CNotificationLimitOptions())}getSortUsersOptions(){return[{label:W.R.alphabetically,value:"a"},{label:W.R.tokensCC,value:"t"}]}getChatAllowedByOptions(){return[{label:W.R.allUsers,value:"all"},{label:W.R.usersWhoTippedToday,value:"tip_recent"},{label:W.R.usersWhoHaveTipped,value:"tip_anytime"},{label:W.R.usersWhoHaveTokens,value:"tokens"}]}getModeratorsExpireAfterOptions(){return[{label:W.R.oneDay,value:"1"},{label:W.R.twoDays,value:"2"},{label:W.R.oneWeek,value:"7"},{label:W.R.twoWeeks,value:"14"},{label:W.R.oneMonth,value:"30"},{label:W.R.twoMonths,value:"60"},{label:W.R.sixMonths,value:"180"}]}getSilenceOtherBroadcastersOptions(){return[{label:W.R.no,value:"false"},{label:W.R.yesIfBroadcasting,value:"live"},{label:W.R.yesAlways,value:"true"}]}getC2CNotificationLimitOptions(){return[{label:W.R.noLimit,value:0},{label:W.R.fiveMinutes,value:300},{label:W.R.forever,value:-1}]}getSaveEndpoint(){return"api/broadcasterchatsettings/"}getSaveColorEndpoint(){return"choose_broadcaster_chat_color/"}hasModeratorPrivileges(){return!0}isBroadcaster(){return!0}getFormData(){const e=super.getFormData();return e.sort_users=this.sortUsersSelect.value,e.allowed_chat=this.chatAllowedBySelect.value,e.mod_expire=this.moderatorsExpireAfterSelect.value,e.silence_broadcasters=this.silenceOtherBroadcastersSelect.value,e.c2c_notify=this.c2cNotificationLimitSelect.value,e}updateChatSettings(e){super.updateChatSettings(e),this.sortUsersSelect.value=e.sortUsersKey,this.chatAllowedBySelect.value=e.allowedChat,this.moderatorsExpireAfterSelect.value=e.modExpiration.toString(10),this.silenceOtherBroadcastersSelect.value=e.silenceBroadcasters,this.c2cNotificationLimitSelect.value=e.c2cNotificationLimit.toString(10)}setUserChatSettings(){super.setUserChatSettings(),this.userChatSettings.sortUsersKey=this.sortUsersSelect.value,this.userChatSettings.allowedChat=this.chatAllowedBySelect.value,this.userChatSettings.modExpiration=parseInt(this.moderatorsExpireAfterSelect.value),this.userChatSettings.silenceBroadcasters=this.silenceOtherBroadcastersSelect.value,this.userChatSettings.c2cNotificationLimit=(0,O.sp)(parseInt(this.c2cNotificationLimitSelect.value))}handleRoomLoaded(e){super.handleRoomLoaded(e),!1===e.dossier.isAgeVerified&&(this.chatAllowedByLabel.innerText=`${W.R.chatAllowedBy} (${W.R.ageVerificationRequired})`,this.chatAllowedByLabel.style.color="#888",this.chatAllowedBySelect.title=`${W.R.onlyAgeVerifiedCanChangeSetting}.`,this.chatAllowedBySelect.disabled=!0,this.chatAllowedBySelect.onclick=e=>{e.preventDefault(),this.chatAllowedBySelect.blur()})}createModalLink(e,t,s){const i=document.createElement("label"),n=this.createSettingsLink(i,e);return n.appendChild(i),i.onclick=()=>{t.reload(),t.show()},void 0!==s&&(i.dataset.testid=s),n}}var ge=s(7176),be=s(2091);class Ce extends y.YI{constructor(){super(),this.chatSettings=this.createChatSettings(),this.settingInput=!1,this.element.id="SplitModeChatSettingsTab",this.element.dataset.testid="chat-settings-tab",(0,d.fZ)(this.element,d.aG.defaultColor),this.element.style.fontSize="12px",this.element.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",this.element.style.boxSizing="border-box";const e=document.createElement("div");(0,M.ZM)(e,{display:"flex",flexDirection:"column",height:"100%"}),this.element.appendChild(e),(0,M.ZM)(this.chatSettings,{flex:1,height:""}),this.inputDiv=(0,be.gI)();const t=(0,be.zh)();this.inputField=(0,be.Zw)(()=>!1,Math.max(be.hk,be.mU));const s=()=>{this.settingInput||(this.chatSettings.hideModals(),void 0!==this.parent&&this.parent.changeToFirstTab())};(0,_.wu)("click",this.inputField.element,s),(0,_.wu)("focus",this.inputField.element,s);const i=document.createElement("span");new(k.c.get("SendButton"))({onClick:s,isPm:!1,variant:"SplitMode"},i),this.buttonHolder=new N.J,this.buttonHolder.addButton(i,N.z.Text),t.appendChild(this.inputField.element),this.inputDiv.appendChild(t),this.inputDiv.appendChild(this.buttonHolder.element),e.appendChild(this.inputDiv),F.L.changeVideoMode.listen(()=>{"split"===F.L.getVideoMode()&&(e.insertBefore(this.chatSettings.element,this.inputDiv),this.chatSettings.element.style.margin="0")});const n=k.c.get("SharedToastContainer");if(void 0!==n){const e=document.createElement("div");e.id="chat-settings-toast-container",e.dataset.testid="save-notice",new n({containerId:"chat-settings-toast-container",style:{position:"absolute"}},e),this.element.appendChild(e)}this.chatSettings.chatSettingsSavedRequest.listen(()=>{(0,$.P)({message:W.R.chatSettingsSavedText,type:"chat-settings-updated"})})}getHandleStyle(){const e={...super.getHandleStyle(),backgroundRepeat:"no-repeat",backgroundPosition:"center",boxSizing:"border-box",minHeight:"20px",height:"unset"};return e.minWidth="34px",e}createChatSettings(){return C.Bm.current.isBroadcast?new pe:new z.m}getChatSettings(){return this.chatSettings}getTabHandleContent(){return this.collapsed?[document.createTextNode(W.R.chatSettingsTabHandleText)]:[(0,ge.Kj)(0)]}getTabId(){return"settings-tab-default"}focusCurrentChatInput(){this.inputField.focus()}blurCurrentChatInput(){this.inputField.blur()}isInputFocused(){return document.activeElement===this.inputField.element}scrollToBottom(){this.chatSettings.element.scrollTop=this.chatSettings.element.scrollHeight-this.chatSettings.element.offsetHeight}getChatInputField(){return this.inputField}tabHandleClicked(e){super.tabHandleClicked(e),(0,U.bT)("FocusTab",{location:"chatSettings"})}}var ve=s(8529),ye=s(1448),Te=s(2846),fe=s(3448),Se=s(2087),we=s(4589),xe=s(74),Me=s(8039),Re=s(9681);class Pe extends y.YI{constructor(){super(),this.userCount=0,this.settingInput=!1,this.activeReactUserList=(0,P.VY)(),this.element.id="UserListTab",this.element.style.overflow="visible",this.element.style.fontFamily="Tahoma, Helvetica, Arial, sans-serif",this.element.style.boxSizing="border-box",this.element.style.position="relative",this.element.dataset.pactionName="Users";const e=document.createElement("div");if((0,M.ZM)(e,{display:"flex",flexDirection:"column",width:"100%",height:"100%"}),this.element.appendChild(e),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.overflow="auto",this.wrapper.style.padding="6px",this.wrapper.style.boxSizing="border-box",this.wrapper.style.flex="1",e.appendChild(this.wrapper),this.activeReactUserList){const e=k.c.get("UserListContent");this.userListContentComponent=new e({roomUsers:[],createContextMenu:(e,t)=>{(0,U.bT)("OpenUserContextMenu",{username:e.username}),Re.L.createUserContextMenu(e,t)},refreshFunc:()=>{this.refresh()},anonCount:0},this.wrapper)}else this.createAnonUsersDiv(),this.createLoadingDiv();this.inputDiv=(0,be.gI)();const t=(0,be.zh)();this.inputField=(0,be.Zw)(()=>!1,Math.max(be.hk,be.mU));const s=()=>{void 0===this.parent||this.settingInput||this.parent.changeToFirstTab()};(0,_.wu)("click",this.inputField.element,s),(0,_.wu)("focus",this.inputField.element,s),this.buttonHolder=new N.J;const i=document.createElement("span");if(new(k.c.get("SendButton"))({onClick:s,isPm:!1,variant:"SplitMode"},i),this.buttonHolder.addButton(i,N.z.Text),t.appendChild(this.inputField.element),this.inputDiv.appendChild(t),this.inputDiv.appendChild(this.buttonHolder.element),(0,P.Dn)()){const t=(0,be.Pd)();t.appendChild(this.inputDiv),e.appendChild(t)}else e.appendChild(this.inputDiv);S.X0.listen(e=>{this.chatConn=e.chatConnection,this.chatConn.event.statusChange.listen(e=>{(e.previousStatus===n.Ad.PrivateWatching||e.currentStatus===n.Ad.PrivateWatching)&&window.setTimeout(()=>{this.refresh()},2e3)}),this.chatConn.event.roomCountUpdate.listen(e=>{this.userCount=e,o._g.fire("userCountUpdate",{count:this.userCount})}),this.clear(e.dossier.numViewers)}),(0,Me.It)()&&Me.tb.listen(e=>{this.isCurrentTab()||this.displayList(e),this.updateUserCount(e.anonCount,e.totalCount)})}removeUserListChildren(){for(;null!==this.wrapper.firstChild;)this.wrapper.removeChild(this.wrapper.firstChild)}createAnonUsersDiv(){this.anonUsersDiv=document.createElement("div"),(0,d.fZ)(this.anonUsersDiv,d.aG.defaultTooltipColor),(0,M.ZM)(this.anonUsersDiv,{width:"100%",margin:"2px 0",whiteSpace:"nowrap",cssFloat:"left",padding:"4px 0"})}createLoadingDiv(){this.loadingDiv=document.createElement("div"),(0,d.fZ)(this.loadingDiv,d.aG.defaultColor),this.loadingDiv.innerText=`${W.R.loadingUserListText}...`,this.loadingDiv.style.margin="8px 0",this.wrapper.style.fontSize="12px",this.wrapper.appendChild(this.loadingDiv)}createRefreshUsersLink(){this.refreshDiv=document.createElement("div"),this.refreshDiv.style.margin="6px",this.refreshDiv.style.cssFloat="right";const e=document.createElement("span");e.innerText=i.i._({id:"Pelh7b",message:"refresh userlist"}),e.style.cursor="pointer",(0,d.fZ)(e,"refreshUsersLink"),e.onmouseenter=()=>{e.style.textDecoration="underline"},e.onmouseleave=()=>{e.style.textDecoration="none"},(0,_.wu)("click",e,e=>{this.refreshUserList(),e.preventDefault()}),this.refreshDiv.appendChild(e),this.wrapper.appendChild(this.refreshDiv)}refreshUserList(){this.activeReactUserList||(this.removeUserListChildren(),this.createLoadingDiv(),this.refresh())}clear(e){this.userCount=e,o._g.fire("userCountUpdate",{count:this.userCount}),this.activeReactUserList?this.userListContentComponent.update({roomUsers:[],idShowLoading:Math.random()}):(this.removeUserListChildren(),this.createLoadingDiv()),this.repositionChildren()}refresh(){if(void 0===this.chatConn)return;const e=Me.SJ.getInstance();(0,Me.It)()?(e.refetch().catch(L.yZ),this.displayList(e.getRoomUsersInfo())):e.fetchRoomUsers().then(e=>{this.latestRoomUsersInfo=e,this.displayList(e)}).catch(e=>{error("Error retrieving user list",e),(0,Q.Q$)(W.R.errorRefreshingUserList),void 0!==this.latestRoomUsersInfo&&this.displayList(this.latestRoomUsersInfo)})}displayList(e){if(this.activeReactUserList)this.userListContentComponent.update({roomUsers:e.roomUsers,idShowUsers:Math.random()});else{this.removeUserListChildren(),this.createRefreshUsersLink();for(const t of e.roomUsers){const e=document.createElement("div");(0,M.ZM)(e,{width:"auto",maxWidth:"100%",margin:"2px 0"}),e.appendChild(this.createUsernameLabel(t).element),this.wrapper.appendChild(e)}this.wrapper.appendChild(this.anonUsersDiv)}this.updateUserCount(e.anonCount,e.totalCount),this.repositionChildren()}updateUserCount(e,t){this.userCount=t,o._g.fire("userCountUpdate",{count:this.userCount}),this.activeReactUserList?this.userListContentComponent.update({anonCount:e}):this.anonUsersDiv.innerText=W.R.anonUsersCount(e)}createUsernameLabel(e){return new Re.L(e,void 0,!0)}getTabHandleContent(){void 0===this.tabHandleIcon&&(this.tabHandleIcon=(0,ge.DU)(),this.tabHandleIcon.style.height="1em",this.tabHandleIcon.style.paddingTop="1px");const e=document.createTextNode(W.R.userListCountCAPS(this.userCount)),t=document.createElement("span");return t.dataset.pactionName="USERS",t.style.verticalAlign="top",t.appendChild(e),[t]}getTabId(){return"users-tab-default"}focusCurrentChatInput(){this.inputField.focus()}blurCurrentChatInput(){this.inputField.blur()}isInputFocused(){return document.activeElement===this.inputField.element}scrollToBottom(){this.wrapper.scrollTop=this.wrapper.scrollHeight-this.wrapper.offsetHeight}getChatInputField(){}tabHandleClicked(e){super.tabHandleClicked(e),(0,U.bT)("FocusTab",{location:"userlist"}),this.refresh()}}class Ue extends y.Zz{constructor(){let e,t,s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(super(),this.inBroadcast=s,this.useEvolveStyles=a,this.chatTab=this.createChatTab(),this.userListTab=new Pe,this.settingsTab=new Ce,this.inPrivateRoom=!1,this.privateShowUser="",this.room="",this.tabHeight=22,this.perRoomListeners=new R.gt,this.cbListenerGroup=new o.J9,this.tabHandlesRow.element.style.boxSizing="border-box",this.tabHandlesRow.element.style.borderBottom="",this.tabHandlesRow.element.style.height=`${this.tabHeight}px`,this.window.style.width="",this.window.style.position="",this.window.style.height=`calc(100% - ${this.tabHeight}px)`,this.element.id="ChatTabContainer",this.element.style.display="inline-block",this.element.style.position="",this.element.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",this.element.style.margin="0",this.element.style.boxSizing="border-box",this.element.style.overflow="hidden",this.element.style.height="0",this.element.style.minHeight="100%",this.maybeApplyEvolveStyles(),this.tabHandleStyle={...this.tabHandleStyle,position:"static",fontSize:"12px",marginRight:"2px",padding:"3px 8px"},this.chatTab=this.addTab(this.chatTab),(()=>{(0,P.W6)()?this.messagingTab=this.addTab(new c.K(this.inBroadcast)):(this.pmTab=this.addTab(new Te.T(()=>{this.changeToTab(this.chatTab)},this.inBroadcast)),this.pmTab.showElement())})(),this.userListTab=this.addTab(this.userListTab),this.settingsTab=this.addTab(this.settingsTab),this.tabHandlesRow.element.style.padding="1px 3px 0 3px",this.settingsTab.handle.element.dataset.pactionName="Settings",this.userListTab.handle.element.dataset.pactionName="USERS",this.expandableDropDownMenu=this.constructExpandableDropDownMenu(),this.tabHandlesRow.addChild(this.expandableDropDownMenu),this.tabHandlesRow.element.dataset.paction="Chat",this.changeToTab(this.chatTab),this.initNoticeDeclutterer(),(0,Se.Pq)(this.element),S.X0.listen(e=>{var t;this.room=e.chatConnection.room(),this.inBroadcast||this.changeToTab(this.chatTab),(0,B.b5)()||I.E3.fire({username:e.dossier.room,focus:!1,showSupporterAlert:e.dossier.needsSupporterToPm}),e.chatConnection.event.roomShortcode.listen(e=>{const t=(0,ye.j8)(e);this.chatTab.chatTabContents.appendMessageDiv(t)}),e.chatConnection.event.roomMessage.listen(e=>{this.newChatMessage(e)}),e.chatConnection.event.roomNotice.listen(e=>{this.newRoomNotice(e)}),e.chatConnection.event.roomTipMenuNotice.listen(e=>{this.newTipMenuNotice(e)}),e.chatConnection.event.removeMessages.listen(e=>{var t;this.chatTab.handleRemoveMessages(e.username),this.chatTab.chatTabContents.removeMessagesForUser(e.username),null===(t=this.pmTab)||void 0===t||t.closePMSession(e.username)}),e.chatConnection.event.statusChange.listen(t=>{this.inPrivateRoom=e.chatConnection.inPrivateRoom(),this.privateShowUser=e.chatConnection.getPrivateShowUser(),this.loadUnreadPmsForPrivateShow(),t.previousStatus===n.Ad.NotConnected&&this.currentTab===this.userListTab&&this.userListTab.refresh()}),e.chatConnection.event.appDebugLog.listen(t=>{e.chatConnection.isAppDebuggingEnabled()&&this.chatTab.chatTabContents.appendMessageDiv((0,ye.CM)(`DEBUG: ${t}`)),C.Bm.current.isTestbed&&void 0!==window.console&&info(t)}),e.chatConnection.event.onBanSilence.listen(t=>{this.handleBanSilence(t,e)}),this.conversationNotifier=new w.e(e.chatConnection),C.Bm.current.mergePmDm&&g.H4.listen(e=>{var t;if(!0===(null===(t=this.conversationNotifier)||void 0===t?void 0:t.shouldNotify(e.fromUser.username))){const t=this.conversationNotifier.createChatLinkMessage(e.fromUser.username);this.chatTab.chatTabContents.appendMessageDiv(t),this.conversationNotifier.preventNotifications(e.otherUsername)}}).addTo(this.perRoomListeners),(0,P.MW)()&&(this.translationSettingsModal=null!==(t=this.maybeCreateTranslationSettingsModal())&&void 0!==t?t:void 0),this.settingsTab.getChatSettings().hideModals()}),(0,P.W6)())o._g.listen("messagingOtherUserInitiatedPm",e=>{if("mobile"===e.chatLinkType)return;const t=new u.aZ({onClick:()=>{const t=(0,m.w)(e.username);(0,U.bT)("MsgInitiateConv",{source:"chat_link_notice",sourceUI:C.Bm.current.isMobile?"mobile":"desktop",mode:(0,E.TE)(C.Aw.getState().roomStatus)?"offline":"online",destination:t}),e.onClick()}}),s={username:e.username,PMChatLink:t};this.newPmChatLink(s)}),o._g.listen("messagingTotalNumUnreadChanged",e=>{this.inPrivateRoom&&this.chatTab.setUnreadCount(e)},{syncHistory:!0}).addTo(this.cbListenerGroup);else if(!C.Bm.current.mergePmDm){var l;const e=new x.k;(0,h.SU)()&&g.H4.listen(t=>{if(e.shouldNotify(t.fromUser.username)){const s=t.otherUsername,n=i.i._({id:"5yslMF",message:"New direct message from {otherUsername}",values:{otherUsername:s}}),a=new u.aZ({onClick:()=>{const e=(0,E.TE)(C.Aw.getState().roomStatus)?"offline":"online";(0,U.bT)("MsgInitiateConv",{source:"chat_link_notice",sourceUI:C.Bm.current.isMobile?"mobile":"desktop",mode:e,destination:r.cF.DM}),p.$o.fire(t.otherUsername)}}),o=(0,ye.r_)(n,a.openConversationElement);this.chatTab.chatTabContents.appendMessageDiv(o),e.preventNotifications(t.otherUsername)}}),null===(l=this.pmTab)||void 0===l||l.otherUserInitiatedPm.listen(e=>{var t;!0===(null===(t=this.conversationNotifier)||void 0===t?void 0:t.shouldNotify(e.username))&&(this.newPmChatLink(e),this.conversationNotifier.preventNotifications(e.username))})}I.W1.listen(e=>{const t=this.chatTab.chatTabContents.messageList.querySelector(`[data-chtrsf-flagged-id="${e}"]`);t&&this.chatTab.chatTabContents.messageList.removeChild(t)}),S.Gr.listen(()=>{var e;this.perRoomListeners.removeAll(),this.cbListenerGroup.removeAll(),null===(e=this.conversationNotifier)||void 0===e||e.dispose(),this.roomNoticeDeclutterer.onRoomCleanup()}),I.q_.listen(e=>{e?this.chatTab.chatTabContents.appendMessageDiv((0,ye.CM)("Debug mode enabled. Type /debug again to disable.")):this.chatTab.chatTabContents.appendMessageDiv((0,ye.CM)("Debug mode disabled."))}),o._g.listen("userCountUpdate",()=>{this.refreshTabs()}),I.Ch.listen(e=>{"split"===F.L.getVideoMode()&&(this.changeToTab(this.chatTab),this.chatTab.appendInputText(`@${e} `),this.chatTab.focusCurrentChatInput())});const d=()=>{void 0===e&&(e=this.chatTab.chatTabContents.isScrolledUp()),window.clearTimeout(t),t=window.setTimeout(()=>{!1===e&&this.chatTab.chatTabContents.scrollToBottom(),e=void 0},50)};fe.XA.splitModeDragResize.listen(()=>{this.expandableDropDownMenu.dropDown.isShown()&&this.expandableDropDownMenu.dropDown.hideElement(),d()}),I.E3.listen(()=>{window.setTimeout(()=>{this.repositionChildrenRecursive()},0)}),g.Si.listen(e=>{!this.inPrivateRoom||e!==this.privateShowUser&&e!==this.room||this.chatTab.resetNumUnread()}),g.J9.listen(e=>{!0===e.isPrivateShowMessage&&this.newPrivateShowMessage(e)}),I.PV.listen(()=>{this.repositionChildren()}),T.eF.listen(()=>{this.changeToTab(this.settingsTab)})}initNoticeDeclutterer(){this.roomNoticeDeclutterer=new A.z({appendNotice:(e,t)=>this.chatTab.chatTabContents.appendMessageDiv(e.element,t),appendSentinelDiv:e=>this.chatTab.chatTabContents.element.appendChild(e)})}shouldIncrementUnread(e){var t;const s=!0===e.isPrivateShowMessage,i=e.fromUser.username===(null===(t=C.Bm.current.loggedInUser)||void 0===t?void 0:t.username);return!s||!i&&!this.isPmSessionActive(e.fromUser.username)}newChatMessage(e){this.shouldIncrementUnread(e)&&this.chatTab.possiblyIncrementUnread();const t=(0,ye.j7)(e);(0,a.at)(t,(0,a.Ec)()),this.chatTab.chatTabContents.appendMessageDiv(t,this.shouldIncrementUnread(e))}newPrivateShowMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=void 0!==e.album&&(0,P.W6)()&&(0,P.Wg)(),i=void 0!==e.tipAmount&&(0,P.W6)();if(s)this.chatTab.chatTabContents.appendMessageDiv((0,ye.Y8)(e));else if(!i){this.newChatMessage(e);const t=(0,ye.bB)(e);void 0!==t&&this.chatTab.chatTabContents.appendMessageDiv(t,!1)}t&&this.maybeMarkPrivateShowPmsRead()}newChatursafeRoomNotice(e){var t;const s=e.message;if(s.fromUser.username===(null===(t=C.Bm.current.loggedInUser)||void 0===t?void 0:t.username)){const t=(0,ye.j7)(s);t.style.paddingLeft="0",t.dataset.msgId=s.messageID,(0,a.at)(t,(0,a.Ec)());const i=this.chatTab.chatTabContents.isScrolledUp(),n=new b.T({component:"DesktopFlaggedChat",componentProps:{chatDiv:t,reasons:e.categories,scrollCallback:()=>{i||this.chatTab.chatTabContents.scrollToBottom()},removeCallback:()=>{I.W1.fire(s.messageID)}}});n.element.dataset.chtrsfFlaggedId=s.messageID,this.chatTab.chatTabContents.appendMessageDiv(n.element)}}newRoomNotice(e){if(void 0!==e.chatursafeFlagged)return void this.newChatursafeRoomNotice(e.chatursafeFlagged);const t=new H.Q5({roomNoticeData:e,isChatScrolledToBottom:()=>!this.chatTab.chatTabContents.isScrolledUp(),scrollChatToBottom:()=>this.chatTab.chatTabContents.debouncedScrollToBottom(),getChatScrollTop:()=>this.chatTab.chatTabContents.getScrollTop(),setChatScrollTop:e=>this.chatTab.chatTabContents.setScrollTop(e)});var s,i;this.roomNoticeDeclutterer.addRoomNotice(t),e.showInPrivateMessage&&((0,P.BP)()&&void 0!==e.toUser&&""!==e.toUser?null===(s=this.pmTab)||void 0===s||s.possiblyAppendMessageDivForUser(e.toUser,new H.Q5({roomNoticeData:e,neverCollapse:!0}).element):null===(i=this.pmTab)||void 0===i||i.possiblyAppendMessageDiv(new H.Q5({roomNoticeData:e,neverCollapse:!0}).element))}newTipMenuNotice(e){const t=(0,D.Ru)(e,xe.i5);if(t){const e=!this.chatTab.chatTabContents.isScrolledUp();this.chatTab.chatTabContents.appendMessageDiv(t),e&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.chatTab.chatTabContents.scrollToBottom()})})}}newPmChatLink(e){const t=W.R.newPrivateMessageNotice(e.username),s=(0,ye.r_)(t,e.PMChatLink.openConversationElement);this.chatTab.chatTabContents.appendMessageDiv(s)}loadUnreadPmsForPrivateShow(){if(!this.inPrivateRoom)return;const e=(0,B.b5)()?this.privateShowUser:this.room;(0,h._9)(e,this.room,"0").then(e=>{const t=(0,P.W6)();e.forEach(e=>this.newPrivateShowMessage(e,!t)),t&&this.maybeMarkPrivateShowPmsRead()}).catch(L.yZ)}isPmSessionActive(e){var t;return this.currentTab===this.pmTab&&!0===(null===(t=this.pmTab)||void 0===t||null===(t=t.getSession(e))||void 0===t?void 0:t.isActive())}maybeMarkPrivateShowPmsRead(){if(this.chatTab.active&&this.inPrivateRoom&&"split"===F.L.getVideoMode()){const e=(0,B.b5)()?this.privateShowUser:this.room;(0,P.W6)()?window.setTimeout(()=>{o._g.fire("markMessagesRead",{username:e})},0):g.Si.fire(e)}}changeToTab(e){var t;super.changeToTab(e),this.maybeMarkPrivateShowPmsRead(),null===(t=this.translationSettingsModal)||void 0===t||t.close()}constructExpandableDropDownMenu(){const e=new v.Dw(void 0,!0);return(0,d.fZ)(e,"tab"),(0,d.fZ)(e.dropDown,"chat-tabs-dropdown-border"),(0,M.ZM)(e.dropDown,{width:"105px",padding:"8px 0",borderWidth:"1px",borderStyle:"solid"}),(0,M.ZM)(e,{...this.tabHandleStyle,position:"absolute",height:"19px",width:"32px"}),e}createChatTab(){return new ve.s}attachTabToDOM(e){const t=super.attachTabToDOM(e);return t.element.classList.add("chat-tab-handle"),t}maybeCreateTranslationSettingsModal(){if(void 0===C.Aw.getState().userChatSettings.enableTranslate)return new we.a}async handleBanSilence(e,t){if((0,B.b5)()||e.silencer===t.dossier.userName){const s=await(0,l.t4)({bannedUser:e.silenced,createdBy:e.silencer,isSilence:!e.isBan,roomUser:t.dossier.room}),i=e=>{this.showLogMsg(e)},n=(0,f.d)(this.chatTab.chatTabContents,e,s,t,i);this.chatTab.chatTabContents.appendMessageDiv(n)}}showLogMsg(e){this.chatTab.chatTabContents.appendMessageDiv((0,ye.CM)(e))}repositionChildren(){this.tabHandlesRow.repositionChildrenRecursive()}messageListWrapperHeight(){return this.element.clientHeight-be.$h-this.tabHandlesRow.element.offsetHeight-6}getCurrentTab(){return super.getCurrentTab()}children(){return super.children()}cycleToNextWindow(){this.cycleToWindow("next")}cycleToPrevWindow(){this.cycleToWindow("prev")}cycleToWindow(e){if(void 0!==this.messagingTab)return void(super.getCurrentTab()===this.chatTab?this.changeToTab(this.messagingTab):this.changeToTab(this.chatTab));const t=this.pmTab,s="next"===e?()=>t.showNextPMSession():()=>t.showPrevPMSession(),i="next"===e?()=>t.resetNextQueue():()=>t.resetPrevQueue();this.settingsTab.getChatSettings().hideModals(),super.getCurrentTab()===this.chatTab?(this.changeToTab(t),i(),s()||t.showPMList(!1)):s()||this.changeToTab(this.chatTab),this.repositionChildrenRecursive()}closeCurrentPMSession(){super.getCurrentTab()===this.pmTab&&this.pmTab.closeCurrentPMSession()}maybeApplyEvolveStyles(){this.useEvolveStyles&&(0,d.fZ)(this.element,a.F$.EvolveMode)}}},8529:(e,t,s)=>{s.d(t,{s:()=>y});var i=s(2543),n=s(20),a=s(9461),o=s(7477),r=s(2331),l=s(2939),h=s(8423),d=s(9060),c=s(1284),m=s(7407),u=s(1452),p=s(4947),g=s(7250),b=s(2091),C=s(1448),v=s(74);class y extends r.ZZ{constructor(){super(),this.numUnread=0,this.listenerGroup=new h.gt,this.element.style.overflow="";const e={onToggleDebugMode:()=>{this.chatConnection.toggleAppDebugging()},onTipRequest:e=>{v.i5.fire(e)},onChatMessage:e=>{if(this.chatConnection.inPrivateRoom()){const t={message:e,username:a.Bm.current.isBroadcast||this.chatConnection.isBroadcasting?this.chatConnection.getPrivateShowUser():this.chatConnection.room(),media:void 0,source:n.O7.RoomViewPM,roomName:this.chatConnection.room()};(0,n.F_)(t).catch(e=>{this.chatTabContents.appendMessageDiv((0,C.CM)(e.errorMessage))})}else this.chatConnection.sendRoomMessage(e),this.chatTabContents.blurCurrentChatInput()}};this.chatTabContents=new b.__({onShortcode:e=>{this.chatConnection.sendShortcode(e)},...e},()=>this.chatConnection.inPrivateRoom(),()=>this.isConversationShowing()),this.addChild(this.chatTabContents),l.X0.listen(e=>{this.chatConnection=e.chatConnection,this.chatTabContents.appendMessageDiv((0,C.CM)(this.welcomeWarning()),!1),this.chatTabContents.appendMessageDiv((0,C.CM)(this.welcomeMessage()),!1),(0,d.Dn)()&&this.setReloadShortcuts(e.dossier.roomUid),(0,c.LQ)(e.dossier.room,e.dossier.roomUid,e.dossier.appsRunning,e.dossier.aspAppDirectoryV3Enabled,"theater").then(e=>{this.chatTabContents.appendMessageDiv(e,!1)}).catch(u.yZ)}),l.Gr.listen(()=>{this.chatTabContents.clear(),this.listenerGroup.removeAll()})}setReloadShortcuts(e){new o.Q4(e).onMessage.listen(e=>{"refresh_shortcuts"===e.target&&i._g.fire("refreshShortcuts",void 0)}).addTo(this.listenerGroup)}scrollToBottom(){this.chatTabContents.scrollToBottom()}getTabHandleContent(){const e=p.R.chatCAPS;let t;return t=this.numUnread>99?`${e} (99+)`:this.numUnread>0?`${e} (${this.numUnread})`:e,[document.createTextNode(t)]}getTabId(){return"chat-tab-default"}focusCurrentChatInput(){this.chatTabContents.focusCurrentChatInput()}blurCurrentChatInput(){this.chatTabContents.blurCurrentChatInput()}isInputFocused(){return this.chatTabContents.isInputFocused()}setUnreadCount(e){this.numUnread=e,this.refreshTabs()}possiblyIncrementUnread(){var e;null!==(e=this.chatConnection)&&void 0!==e&&e.inPrivateRoom()&&(0,d.W6)()||(this.isCurrentTab()||(this.numUnread+=1),this.refreshTabs())}showElement(){super.showElement(),this.resetNumUnread(),this.chatTabContents.clearScrollButtonUnread(),this.chatTabContents.scrollToBottom()}isConversationShowing(){var e;const t="split"===g.L.getVideoMode(),s=null===(e=this.parent)||void 0===e?void 0:e.getCurrentTab().getTabId(),i="chat-tab-default"===s||"pm-tab-default"===s,n=this.chatConnection&&this.chatConnection.inPrivateRoom()&&i;return(this.isCurrentTab()||n)&&t}resetNumUnread(){var e;null!==(e=this.chatConnection)&&void 0!==e&&e.inPrivateRoom()&&(0,d.W6)()||(this.numUnread=0,this.refreshTabs())}handleRemoveMessages(e){const t=[];for(const s of this.chatTabContents.messageList.childNodes){const i=s;i.getAttribute("data-nick")===e&&t.push(i)}for(const e of t)this.chatTabContents.messageList.removeChild(e)}appendInputText(e){this.chatTabContents.appendInputText(e)}getChatInputField(){return this.chatTabContents.customInputField}welcomeWarning(){return p.R.viewerWelcomeWarning}welcomeMessage(){return p.R.welcomeMessage}tabHandleClicked(e){super.tabHandleClicked(e),(0,m.bT)("FocusTab",{location:"chat"})}}}}]);
//# sourceMappingURL=6561-prod-450ca321fc24b90dd880.js.map