"use strict";(globalThis.webpackChunk_multimediallc_cb_ts=globalThis.webpackChunk_multimediallc_cb_ts||[]).push([[8396],{1166:(e,t,i)=>{var s=i(4054),n=i(9945),o=i(7872),a=i(213),r=i(9512),l=i(2709),d=i(3955),h=i(8423),c=i(1372),p=i(7623),m=i(8861),u=i(9447),g=i(1224),y=i(3885),b=i(6784),f=i(5216),x=i(7407),v=i(1452),w=i(4947);const C=[{mime:"image/jpeg",pattern:[255,216,255],mask:[255,255,255],exts:["jpeg","jpg","jpe","jfif"]},{mime:"image/png",pattern:[137,80,78,71],mask:[255,255,255,255],exts:["png"]},{mime:"image/heic",pattern:[],mask:[],exts:["heic"]},{mime:"image/heif",pattern:[],mask:[],exts:["heif"]}],T={imageTooLarge:w.R.broadcastNotificationImageTooLarge,imageFormatNotAllowed:w.R.broadcastNotificationUseApprovedFormat,imageTooLowRes:w.R.broadcastNotificationTooSmallDimensions,imageTooWide:w.R.broadcastNotificationTooWide,imageTooTall:w.R.broadcastNotificationTooTall,invalidReaderResultType:w.R.broadcastNotificationErrorAfterSubmit},S={1:"",2:"rotateY(180deg)",3:"rotate(180deg)",4:"rotate(180deg) rotateY(180deg)",5:"rotate(270deg) rotateY(180deg)",6:"rotate(90deg)",7:"rotate(90deg) rotateY(180deg)",8:"rotate(270deg)"};class R{constructor(e,t){let i=T[e];void 0===i&&(i=e),void 0===t&&(t={}),t.error=e,this.errorId=e,this.message=i,this.attributes=t}hasDefinedMessage(){return this.errorId!==this.message}}class I{constructor(){this.fileReader=new FileReader}readImageFile(e){return this.exifOrientation=void 0,this.verifyImageFormat(e).then(t=>this.loadKnownImageFormat(e,t)).then(e=>this.loadFromDataURL(e))}verifyImageFormat(e){return this.loadFilePromise(()=>{this.fileReader.readAsArrayBuffer(e.slice(0,4))}).then(()=>new Promise((t,i)=>{const s=new Uint8Array(this.fileReader.result);let n=!1;for(let o=0,a=C.length;o<a;o+=1)if(this.matchesMime(e.name,s,C[o]))return n=!0,e.size>10485760?void i(this.reason("imageTooLarge",{size:e.size})):void t(C[o].mime);n||i(this.reason("imageFormatNotAllowed",{format:"unknown"}))}))}convertHeicToJpg(e){return i.e(9308).then(i.t.bind(i,9308,23)).then(t=>t.default({blob:e,toType:"image/jpeg"}))}loadKnownImageFormat(e,t){switch(t){case"image/jpeg":return this.resolveExifOrientation(e);case"image/heic":return this.convertHeicToJpg(e).then(t=>{if(!Array.isArray(t))return this.readAsDataURL(new File([t],e.name))});default:return this.readAsDataURL(e)}}resolveExifOrientation(e){return this.loadFilePromise(()=>{this.fileReader.readAsArrayBuffer(e)}).then(()=>{const t=new DataView(this.fileReader.result);let i=2;for(;i<t.byteLength;){const e=t.getUint16(i,!1);if(i+=2,65505===e){if(1165519206!==t.getUint32(i+=2,!1))break;const e=18761===t.getUint16(i+=6,!1);i+=t.getUint32(i+4,e);const s=t.getUint16(i,e);i+=2;for(let n=0;n<s;n+=1)if(274===t.getUint16(i+12*n,e)){this.exifOrientation=t.getUint16(i+12*n+8,e);break}}else{if(65280&~e)break;i+=t.getUint16(i,!1)}}return this.readAsDataURL(e)})}readAsDataURL(e){return this.loadFilePromise(()=>{this.fileReader.readAsDataURL(e)}).then(()=>new Promise((e,t)=>{"string"==typeof this.fileReader.result?e(this.fileReader.result):t(this.reason("invalidReaderResultType",{resultType:typeof this.fileReader.result}))}))}loadFromDataURL(e){return new Promise((t,i)=>{const s=new Image;s.onload=()=>{const e=s.width,n=s.height,o=t=>{i(this.reason(t,{width:e,height:n}))};if(s.width<200||n<200)return void o("imageTooLowRes");const a=e/n;a>=5?o("imageTooWide"):a<=.2?o("imageTooTall"):t(s)},void 0!==e&&(s.src=e)})}matchesMime(e,t,i){for(let e=0,s=i.mask.length;e<s;e+=1)if((t[e]&i.mask[e])-i.pattern[e]!==0)return!1;return this.matchesMimeExtensions(e,i.exts)}matchesMimeExtensions(e,t){const i=e.toLowerCase().split(/\./g),s=i[i.length-1];for(const e of t)if(e===s)return!0;return!1}loadFilePromise(e){return new Promise((t,i)=>{this.fileReader.onloadend=e=>{null!==this.fileReader.error?i(this.fileReader.error):this.fileReader.readyState===FileReader.DONE&&t(e)},e()})}reason(e,t){return new R(e,t)}}class E extends l.u{constructor(){super(),this.state={isSubmitting:!1,isAnonymous:!1,secondsRemaining:-1,nextRefreshSeconds:-1,numFollowers:-1,maxWaitSeconds:-1,newestApprovedNotificationImageUrl:"",newestApprovedNotificationImageId:-1},this.TRANSITION_DELAY=500,(0,u.fZ)(this.element,"FollowerNotificationPanel"),this.element.style.overflow="visible",this.element.style.position="static",this.element.style.borderWidth="1px",this.element.style.borderStyle="solid",this.element.style.borderRadius="4px",this.element.style.padding="0 10px",this.element.style.margin="0 0 10px 0",this.openBodyLink=this.createOpenBodyLink(),this.toolbarStatusElement=this.createToolbarStatusElement(),this.toolbarStatusElement.dataset.testid="cool-down-status",this.toolbarElement=this.createToolbarElement(),this.populateToolbar(),this.submitButton=this.createSubmitButton(),this.cancelLink=this.createCancelLink(),this.headlineElement=this.createHeadlineElement(w.R.broadcastNotificationImageContainerHeadline);const e=document.createElement("div");e.style.display="table",this.imageContainer=this.createImageContainer();const t=this.createImageContainerDeleteCross(this.imageContainer);t.style.right="4px",t.style.top="4px",(0,b.wu)("click",t,()=>{(0,a.mf)(w.R.broadcastNotificationRemoveApprovedPhoto,()=>{this.addPageAction("clickedDeleteAll"),this.onDeleteImage()})}),this.newImageContainer=this.createImageContainer();const i=this.createImageContainerDeleteCross(this.newImageContainer);i.style.left="225px",i.style.top="45px",(0,b.wu)("click",i,()=>{i.style.visibility="hidden",i.style.opacity="0",this.newImage=void 0,this.inputFile.value="",this.revertImageContainer(),this.addPageAction("cancelNewImage"),this.element.classList.remove("dragDropped")}),this.noImageContainer=this.createNoImageContainer();const s=document.createElement("div");s.style.display="table-cell",s.style.paddingLeft="40px",s.style.verticalAlign="middle",this.uploadImageLink=this.createUploadImageLink(s);const n=this.createBodyButtonsContainer();this.tintOverlay=this.createTintOverlay();const o=document.createElement("div");o.style.width="240px",o.style.height="135px",this.inputFile=document.createElement("input"),this.inputFile.style.display="none",this.inputFile.type="file",this.inputFile.name="image",this.inputFile.accept=["image/png","image/jpeg","image/heic"].join(","),(0,b.wu)("change",this.inputFile,e=>{if(null===e.target)return;const t=e.target.files;null===t||t.length<=0||(this.newImage=t[0],this.onFileInputChange(t[0]))}),this.loadingSpinner=this.createLoadingSpinner(),this.element.appendChild(this.headlineElement),this.element.appendChild(e),e.appendChild(o),o.appendChild(this.loadingSpinner),o.appendChild(this.imageContainer),this.imageContainer.appendChild(t),o.appendChild(this.newImageContainer),o.appendChild(i),o.appendChild(this.noImageContainer),e.appendChild(s),this.element.appendChild(n),this.element.appendChild(this.tintOverlay),this.element.appendChild(this.inputFile),this.element.style.position="relative",this.element.style.width="";const r=()=>{this.element.classList.toggle("dragEnter")};(0,b.wu)("dragenter",this.element,e=>{e.stopPropagation(),e.preventDefault(),r()}),(0,b.wu)("dragleave",this.element,e=>{e.stopPropagation(),e.preventDefault(),r()}),(0,b.wu)("dragover",this.element,e=>{e.stopPropagation(),e.preventDefault()}),(0,b.wu)("drop",this.element,e=>{if(e.stopPropagation(),e.preventDefault(),r(),this.badBrowserMode)(0,a.Q$)(w.R.broadcastNotificationBadBrowserNotice);else if(null!==e.dataTransfer){const t=e.dataTransfer.files;t.length>0&&(this.newImage=t[0],this.onFileInputChange(t[0])),this.element.classList.add("dragDropped")}}),this.addPageAction("insertedIntoDom"),this.badBrowserMode=(0,p.Cc)(),this.badBrowserMode||(this.imageReader=new I),this.hideElement(),this.initializeNotificationState()}getSubmitButtonText(){return w.R.broadcastNotificationButtonSendNotification}getToolbarFollowerText(){let e="";return 1===this.state.numFollowers?e=`${w.R.broadcastNotificationTopBarFollowerTextSingularOld}.`:this.state.numFollowers>-1&&(e=`${w.R.broadcastNotificationTopBarFollowerTextPluralOld(this.state.numFollowers)}.`),e}getOpenLink(){return this.toolbarElement}createToolbarElement(){const e=document.createElement("span");return e.style.position="relative",e.style.display="none",e.style.margin="0 0 8px 8px",this.toolbarFollowerText=this.createToolbarFollowerText(),e}createToolbarStatusElement(){const e=document.createElement("span");return(0,u.fZ)(e,u.aG.hrefColor),e.style.opacity=".75",e.style.display="inline-block",e.style.marginLeft="10px",e.style.transition="background-color 0.2s linear",e.style.position="relative",e.style.font="12px 'UbuntuMedium', Arial, Helvetica, sans-serif",e}createToolbarFollowerText(){const e=document.createElement("span");return e.textContent=this.getToolbarFollowerText(),e.style.paddingRight="4px",e.dataset.testid="follower-text",e}populateToolbar(){this.toolbarElement.appendChild(this.toolbarFollowerText),this.toolbarElement.appendChild(this.openBodyLink),this.toolbarElement.appendChild(this.toolbarStatusElement)}createOpenBodyLink(){const e=document.createElement("a");return(0,u.fZ)(e,u.aG.hrefColor),e.href=(0,f._Y)(""),e.textContent=w.R.broadcastNotificationTopBarOpenBodyButton,e.style.display="inline-block",e.style.cursor="pointer",e.style.transition="background-color 0.2s linear",e.style.position="relative",e.style.font="12px 'UbuntuMedium', Arial, Helvetica, sans-serif",e.dataset.testid="announce-youre-online-link",(0,b.wu)("click",e,e=>{e.stopPropagation(),e.preventDefault(),this.toggleShowHide()}),e}createHeadlineElement(e){const t=document.createElement("p");return(0,u.fZ)(t,"headlineElement"),t.style.font="12px 'UbuntuBold', Arial, Helvetica, sans-serif",t.textContent=e,t}createSubmitButton(){const e=document.createElement("button");return(0,u.fZ)(e,"button"),e.textContent=this.getSubmitButtonText(),e.style.display="inline-block",e.style.width="auto",e.style.height="auto",e.style.margin="10px 10px 10px 0",e.style.padding="8px 30px 8px 8px",e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.borderRadius="4px",e.style.font="14px 'UbuntuRegular',Arial,Helvetica,sans-serif",e.style.background=`${g.mG.signupBgColor} url(${STATIC_URL}arrow-white-v2.gif) no-repeat right 50%`,e.style.cursor="pointer",e.dataset.testid="send-notification-button",(0,b.wu)("click",e,e=>{e.stopPropagation(),e.preventDefault(),this.setIsSubmitting(!0),this.addPageAction("clickedSubmit"),this.onSubmit()}),(0,b.wu)("mouseover",e,()=>{this.submitButton.style.background=`${g.mG.signupBgColor} url(${STATIC_URL}arrow-white-v2.gif) no-repeat right 50%`,this.submitButton.style.textDecoration="underline"}),(0,b.wu)("mouseleave",e,()=>{this.submitButton.style.background=`${g.mG.signupBgColor} url(${STATIC_URL}arrow-white-v2.gif) no-repeat right 50%`,this.submitButton.style.textDecoration="none"}),e}createCancelLink(){const e=document.createElement("a");return(0,u.fZ)(e,u.aG.hrefColor),e.textContent=w.R.cancelText,e.href="#cancel",e.style.padding="10px 16px",e.style.display="inline-block",(0,b.wu)("click",e,e=>{e.stopPropagation(),e.preventDefault(),this.state.isSubmitting||(this.addPageAction("clickedCancel"),this.hideElement())}),e}createBodyButtonsContainer(){const e=document.createElement("div");return e.appendChild(this.submitButton),e.appendChild(this.cancelLink),e}createFormData(){const e=new FormData;return e.append("csrfmiddlewaretoken",(0,m.I7)("csrftoken")),e}createImageContainer(){const e=document.createElement("div");return e.style.objectFit="scale-down",e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",e.style.backgroundSize="contain",e.style.position="relative",e.style.display="none",e.style.width="240px",e.style.height="135px",e}createNoImageContainer(){const e=document.createElement("div");return e.style.backgroundColor="#cbcbcb",e.style.cursor="pointer",e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",g.mG.isWhiteLabel?(e.style.backgroundImage=`url(${g.mG.logoImageName})`,e.style.backgroundSize="contain"):(e.style.backgroundImage=`url('${STATIC_URL}broadcastnotification/cb-logo.svg')`,e.style.backgroundSize="auto"),e.style.margin="auto",e.style.display="none",e.style.width="240px",e.style.height="135px",(0,b.wu)("click",e,e=>{this.onUploadPrompt(e)}),e}createImageContainerDeleteCross(e){const t=document.createElement("div");t.style.width="20px",t.style.height="20px",t.style.background=`transparent url(${STATIC_URL}broadcastnotification/closeicon.svg) no-repeat right 50%`,t.style.backgroundSize="contain",t.style.position="absolute",t.style.opacity="0",t.style.visibility="hidden",t.style.transition="visibility 0.3s, opacity 0.3s",t.style.cursor="pointer";const i=()=>{t.style.visibility="visible",t.style.opacity="1"},s=()=>{t.style.visibility="hidden",t.style.opacity="0"};return(0,b.wu)("mouseover",e,i),(0,b.wu)("mouseover",t,i),(0,b.wu)("mouseleave",e,s),(0,b.wu)("mouseleave",t,s),t}createUploadImageLink(e){const t=document.createElement("a");t.dataset.testid="upload-image-link",(0,u.fZ)(t,u.aG.hrefColor),t.href=(0,f._Y)("/broadcasternotifications/upload/"),t.textContent=w.R.broadcastNotificationUploadLink,t.style.font="12px 'UbuntuBold', Arial, Helvetica, sans-serif";const i=document.createElement("div");i.style.width="12px",i.style.height="12px",i.style.background=`transparent url(${STATIC_URL}broadcastnotification/infoicon.svg) no-repeat right 50%`,i.style.backgroundSize="contain",i.style.display="inline-block",i.style.marginLeft="4px",i.style.position="relative";const s=document.createElement("div");(0,u.fZ)(s,"tooltip"),s.style.width="220px",s.style.top="-20px",s.style.left="20px",s.style.padding="10px",s.style.fontWeight="normal",s.style.fontSize="12px",s.style.borderRadius="4px",s.style.position="absolute",s.style.zIndex="9999999999",s.style.boxSizing="border-box",s.style.borderWidth="1px",s.style.borderStyle="solid",s.style.visibility="hidden",s.style.opacity="0",s.style.transition="visibility 0.3s, opacity 0.3s",s.textContent=w.R.broadcastNotificationTooltip;const n=document.createElement("p");n.textContent=w.R.broadcastNotificationImageHint1,n.style.font="12px 'UbuntuBold', Arial, Helvetica, sans-serif",n.style.marginBottom="0";const o=document.createElement("p");o.textContent=w.R.broadcastNotificationImageHint2,o.style.font="12px 'UbuntuRegular', Arial, Helvetica, sans-serif",o.style.margin="3px 0 0 0";const a=document.createElement("p");return a.textContent=w.R.broadcastNotificationImageHint3,a.style.font="12px 'UbuntuRegular', Arial, Helvetica, sans-serif",a.style.margin="3px 0 0 0",(0,b.wu)("mouseover",i,()=>{s.style.visibility="visible",s.style.opacity="1"}),(0,b.wu)("mouseleave",i,()=>{s.style.visibility="hidden",s.style.opacity="0"}),(0,b.wu)("click",t,e=>{this.onUploadPrompt(e)}),e.appendChild(t),e.appendChild(i),i.appendChild(s),e.appendChild(n),e.appendChild(o),e.appendChild(a),t}createTintOverlay(){const e=document.createElement("div");return e.style.opacity="0",e.style.visibility="hidden",e.style.transition="visibility 0.3s, opacity 0.3s",e.style.backgroundColor="#000000",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.cursor="wait",e}createLoadingSpinner(){return(0,y.N)({extraStyle:{position:"absolute",top:"90px",left:"120px",display:"none"}})}showLoadingSpinner(){this.loadingSpinner.style.display=""}hideLoadingSpinner(){this.loadingSpinner.style.display="none"}disable(){(this.isShown()||"none"!==this.toolbarElement.style.display)&&(this.hideElement(),this.toolbarElement.style.display="none",Z.panelVisibilityChange.fire(this))}showElement(){this.isShown()||(super.showElement(),this.element.style.margin="6px 0 3px 0",this.element.style.display="block",this.element.style.height="auto",this.openBodyLink.style.cursor="default",this.openBodyLink.style.font="12px 'UbuntuBold', Arial, Helvetica, sans-serif",this.openBodyLink.style.textDecoration="none",this.addPageAction("open"),this.updateToolbarState(),Z.panelVisibilityChange.fire(this))}hideElement(){this.isShown()&&(super.hideElement(),this.openBodyLink.style.cursor="pointer",this.openBodyLink.style.font="12px 'UbuntuMedium', Arial, Helvetica, sans-serif",this.openBodyLink.style.textDecoration="",this.addPageAction("close"),this.updateToolbarState(),Z.panelVisibilityChange.fire(this))}onUploadPrompt(e){e.stopPropagation(),e.preventDefault(),this.badBrowserMode?(0,a.Q$)(w.R.broadcastNotificationBadBrowserNotice):this.inputFile.click()}onFileInputChange(e){this.showLoadingSpinner(),this.imageReader.readImageFile(e).then(e=>{this.hideAllImages(),this.newImageContainer.style.width="240px",this.newImageContainer.style.height="135px",this.newImageContainer.style.backgroundImage=`url(${e.src})`,this.newImageContainer.style.transform="none",this.newImageContainer.style.position="static";const t=document.getElementById("bn_ie_hack");if(null!==t&&t.remove(),void 0!==this.exifOrientation&&this.shouldApplyExifTransformation()){this.newImageContainer.style.transform=S[this.exifOrientation],this.exifOrientation>=5&&(this.newImageContainer.style.width="135px",this.newImageContainer.style.height="240px",this.newImageContainer.style.position="absolute",this.newImageContainer.style.left="63px",this.newImageContainer.style.top="-13px");const e=`<style id="bn_ie_hack">#newImageContainer { -ms-transform:  ${S[this.exifOrientation]}}</style>`;this.newImageContainer.insertAdjacentHTML("afterend",e)}this.showImage(this.newImageContainer),this.uploadImageLink.textContent=w.R.broadcastNotificationUploadLinkReplace,this.addPageAction("showNewImage"),this.element.classList.add("dragDropped")}).catch(e=>{let t=w.R.broadcastNotificationErrorProcessing;e instanceof R&&(e.hasDefinedMessage()&&(t=e.message),this.addPageAction("imageUploadFail",e.attributes),this.newImage=void 0,this.inputFile.value=""),(0,a.Q$)(t)}).finally(()=>{this.hideLoadingSpinner()})}shouldApplyExifTransformation(){return 0!==this.exifOrientation&&!(0,p.UQ)()}doSubmit(e){this.addPageAction("doSubmitStart"),(0,f.KF)("photo_videos/notification_photo/upload/",e).then(e=>{const t=JSON.parse(e.responseText);if(!0===t.success)this.hideElement(),this.addPageAction("doSubmitSuccess"),this.refreshNotificationState().then(()=>{this.updateToolbarState(),this.setIsSubmitting(!1)}).catch(v.yZ);else{let e=w.R.broadcastNotificationErrorAfterSubmit,i=!0;"formInvalid"===t.reason?(i=!1,void 0!==t.error&&t.error in T&&(e=T[t.error])):("sendAttemptedTooSoon"===t.reason&&(e=w.R.broadcastNotificationAlreadySent),this.hideElement()),(0,a.Q$)(e),this.refreshNotificationState().then(()=>{this.setIsSubmitting(!1),i&&this.updateToolbarState()}).catch(v.yZ),this.addPageAction("doSubmitFail",{reason:t.reason,isImageError:void 0!==t.error&&t.erorr in T})}this.revertImageContainerAfterTransition()}).catch(e=>{error("Submit error",e),(0,a.Q$)(w.R.broadcastNotificationErrorDuringSubmit),this.addPageAction("doSubmitError",{error:JSON.stringify(e)}),this.refreshNotificationState().then(()=>{this.setIsSubmitting(!1)}).catch(v.yZ),this.revertImageContainerAfterTransition()})}setIsSubmitting(e){e?(this.element.style.cursor="wait",this.cancelLink.style.cursor="wait",this.submitButton.style.cursor="wait",this.submitButton.textContent=w.R.broadcastNotificationButtonSendNotificationInProgress,this.submitButton.style.background=g.mG.signupBgColor,this.submitButton.style.backgroundImage="none",this.tintOverlay.style.opacity="0.3",this.tintOverlay.style.visibility="visible"):(this.element.style.cursor="default",this.cancelLink.style.cursor="pointer",this.submitButton.style.cursor="pointer",this.submitButton.textContent=this.getSubmitButtonText(),this.submitButton.style.background=`${g.mG.signupBgColor} url(${STATIC_URL}arrow-white-v2.gif) no-repeat right 50%`,this.tintOverlay.style.opacity="0",this.tintOverlay.style.visibility="hidden"),this.state.isSubmitting=e}onSubmit(){const e=this.createFormData();if(void 0!==this.newImage)e.append("image",this.newImage);else if(""===this.state.newestApprovedNotificationImageUrl)return void(0,a.mf)(w.R.broadcastNotificationConfirmSendWithoutImage,()=>{this.addPageAction("clickedSendNotificationWithoutImage"),this.doSubmit(e)},()=>{this.setIsSubmitting(!1)});this.doSubmit(e),this.addPageAction("clickedSendNotification")}onDeleteImage(){this.setIsSubmitting(!0),this.addPageAction("doDeleteAllImagesStart"),(0,f.KF)("photo_videos/notification_photo/deleteall/",this.createFormData()).then(e=>{const t=JSON.parse(e.responseText);!0===t.success?(this.addPageAction("doDeleteAllImagesSuccess"),this.newImage=void 0,this.updateApprovedImage(0,""),this.refreshNotificationState().then(()=>{this.setIsSubmitting(!1)}).catch(v.yZ)):("deleteWithPendingRequest"===t.reason&&(0,a.Q$)(w.R.broadcastNotificationRemoveWhileInProgress),this.refreshNotificationState().then(()=>{this.hideElement(),this.setIsSubmitting(!1)}).catch(v.yZ))}).catch(e=>{error("Submit error",e),(0,a.Q$)(w.R.broadcastNotificationErrorDuringSubmit),this.addPageAction("doDeleteAllImagesError",{error:e.toString()}),this.refreshNotificationState().then(()=>{this.setIsSubmitting(!1)}).catch(v.yZ)})}initializeNotificationState(){this.refreshNotificationState().then(()=>{this.updateToolbarState()}).catch(e=>{this.openBodyLink.style.display="none",error("Error querying notification state"),this.addPageAction("loadNotificationStateError",{error:e.toString()})})}refreshNotificationState(){return new Promise((e,t)=>{new Promise((e,t)=>{(0,f.Aw)("follow/notification_dialog_update/").then(i=>{try{200!==i.status&&t(new f.fr(i));const s=function(e){const t=new r.N6(e.responseText),i={isAnonymous:t.getBoolean("isAnonymous"),secondsRemaining:t.getNumber("notificationCooldownSecondsLeft"),nextRefreshSeconds:t.getNumber("nextRefreshSeconds"),numFollowers:t.getNumber("numFollowers"),maxWaitSeconds:t.getNumber("maxWaitSeconds"),newestApprovedNotificationImageUrl:t.getString("newestApprovedNotificationImageUrl"),newestApprovedNotificationImageId:t.getNumber("newestApprovedNotificationImageId")};return t.logUnusedDebugging("parseFollowerNotifyState"),i}(i);e(s)}catch(e){error("Error parsing follower notification state",e),t(e)}}).catch(t)}).then(t=>{this.state.isAnonymous=t.isAnonymous,this.state.numFollowers=t.numFollowers,this.state.secondsRemaining=t.secondsRemaining,this.state.nextRefreshSeconds=t.nextRefreshSeconds,this.updateApprovedImage(t.newestApprovedNotificationImageId,t.newestApprovedNotificationImageUrl),e(t)}).catch(e=>{if(this.disable(),void 0!==e.xhr&&void 0!==e.xhr.responseText&&""!==e.xhr.responseText){if("application/json"!==e.xhr.getResponseHeader("Content-Type"))return void error("Error reading follower notification state",{error:e.xhr.responseText})}else error("Error occurred while processing follower notification state");t()})})}updateApprovedImage(e,t){e!==this.state.newestApprovedNotificationImageId&&(this.state.newestApprovedNotificationImageId=e,this.state.newestApprovedNotificationImageUrl=t,"none"===this.newImageContainer.style.display?""===this.state.newestApprovedNotificationImageUrl?(this.uploadImageLink.textContent=w.R.broadcastNotificationUploadLink,this.showImage(this.noImageContainer)):(this.imageContainer.style.backgroundImage=`url(${this.state.newestApprovedNotificationImageUrl})`,this.uploadImageLink.textContent=w.R.broadcastNotificationUploadLinkReplace,this.showImage(this.imageContainer)):""!==this.state.newestApprovedNotificationImageUrl&&(this.imageContainer.style.backgroundImage=`url(${this.state.newestApprovedNotificationImageUrl})`))}getNotificationStatusText(){return this.state.secondsRemaining>0?`${w.R.broadcastNotificationTopBarCooldownText}\n                ${(0,r._O)(this.state.secondsRemaining,!1)}`:`${w.R.broadcastNotificationTopBarCooldownText}\n                 ${(0,r._O)(30,!1)}`}updateToolbarStatusElement(e){e?(this.openBodyLink.style.display="none",this.toolbarStatusElement.style.display="inline-block",this.toolbarStatusElement.textContent=this.getNotificationStatusText()):(this.toolbarStatusElement.style.display="none",this.openBodyLink.style.display="inline-block"),this.toolbarFollowerText.textContent=this.getToolbarFollowerText()}updateToolbarState(){if(this.state.isAnonymous)return this.disable(),void Z.panelVisibilityChange.fire(this);if(this.state.numFollowers<=0)return this.disable(),Z.panelVisibilityChange.fire(this),void window.setTimeout(()=>{this.refreshNotificationState().then(()=>{this.updateToolbarState()}).catch(v.yZ)},3e4);const e=0!==this.state.secondsRemaining;this.updateToolbarStatusElement(e),e&&window.setTimeout(()=>{this.refreshNotificationState().then(()=>{this.updateToolbarState()}).catch(()=>{this.updateToolbarState()})},1e3*Math.max(5,this.state.nextRefreshSeconds)),this.toolbarElement.style.display="inline-block",Z.panelVisibilityChange.fire(this)}showImage(e){this.hideAllImages(),this.setImageHeadline(w.R.broadcastNotificationImageContainerHeadline),e.style.display="table-cell"}setImageHeadline(e){this.headlineElement.textContent=e}hideAllImages(){this.imageContainer.style.display="none",this.noImageContainer.style.display="none",this.newImageContainer.style.display="none"}revertImageContainer(){""!==this.state.newestApprovedNotificationImageUrl?(this.showImage(this.imageContainer),this.uploadImageLink.textContent=w.R.broadcastNotificationUploadLinkReplace):(this.showImage(this.noImageContainer),this.uploadImageLink.textContent=w.R.broadcastNotificationUploadLink)}revertImageContainerAfterTransition(){window.setTimeout(()=>{this.revertImageContainer()},this.TRANSITION_DELAY)}addPageAction(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this.state.numFollowers>=0&&(t.numFollowers=this.state.numFollowers),(0,x.bT)(`NotifyFollowersRequest_${e}`,t,i)}render(){return this.element}}var k=i(5559),P=i(1474),B=i(1673),A=i(2748),L=i(2650),D=i(9461),N=i(1679),U=i(6844),O=i(9332),_=i(2939);class H extends l.u{constructor(){super("div"),this.boundListeners=new h.gt,this.eligibility="",this.tokenPriceTimeRemaining=0,this.endTime=0,this.tokenPrice=0,this.openLinkStyle={display:"inline-block",cursor:"pointer",margin:"0 0 8px 8px",transition:"background-color 0.2s linear",position:"relative",font:"12px 'UbuntuMedium', Arial, Helvetica, sans-serif"},this.submitButtonStyle={display:"inline-block",margin:"10px 10px 10px 0",width:"auto",height:"auto",font:"1.16em/1.0em 'UbuntuMedium',Arial,Helvetica,sans-serif",background:`${g.mG.signupBgColor} url(${STATIC_URL}arrow-white-v2.gif) no-repeat right 50%`,padding:"8px 30px 8px 8px",borderWidth:"1px",borderStyle:"solid",borderRadius:"4px",cursor:"pointer"},this.cancelButtonStyle={cursor:"pointer",padding:"10px 16px",display:"inline-block"},this.headingStyle={font:"12px UbuntuBold, Arial, Helvetica, sans-serif",margin:"0.5em 0px"},this.descriptionStyle={font:"12px UbuntuRegular, Arial, Helvetica, sans-serif",padding:"0px",margin:"0px"},this.detailsStyle={font:"12px UbuntuMedium, Arial, Helvetica, sans-serif"},this.currentPriceStyle={font:"12px UbuntuMedium, Arial, Helvetica, sans-serif",padding:"0px",margin:"0px"},this.panelStyle={height:"auto",width:"100%",boxSizing:"border-box",overflow:"visible",borderWidth:"1px",borderStyle:"solid",borderRadius:"4px",padding:"0px 10px",margin:"6px 0px 3px"},this.moreTokensStyle={font:"12px 'UbuntuMedium', Arial, Helvetica, sans-serif",padding:"0.75em 0",display:"none"},this.element=(0,c.tT)("div",{colorClass:"BroadcasterPromotionPanel",style:this.panelStyle},(0,c.tT)("p",{colorClass:"headlineElement",style:this.headingStyle},w.R.userPromotionBodyHeadline),(0,c.tT)("div",{style:this.descriptionStyle},w.R.userPromotionBodyDescription," ",(0,c.tT)("a",{colorClass:u.aG.hrefColor,href:"/promoted-spot-details",style:this.detailsStyle,target:"_blank"},"(",w.R.userPromotionDetails,")")),(0,c.tT)("p",{style:this.currentPriceStyle,ref:e=>this.currentPriceElement=e},w.R.loadingText),(0,c.tT)("div",null,(0,c.tT)("button",{"data-testid":"confirm-promotion-btn",colorClass:"button",ref:e=>this.submitButton=e,style:this.submitButtonStyle,onClick:()=>{this.onSubmit()}},w.R.userPromotionSubmit),(0,c.tT)("a",{colorClass:u.aG.hrefColor,style:this.cancelButtonStyle,onClick:()=>{this.hideElement(),(0,x.bT)("BroadcasterPromotionPanel_clickedCancel")}},w.R.cancelText)),(0,c.tT)("p",{style:this.moreTokensStyle,ref:e=>this.getMoreTokensElement=e},w.R.userPromotionNotEnoughTokensText,"  ",(0,c.tT)("a",{"data-purchase-event-source":D.Bm.current.PurchaseEventSources.TOKEN_SOURCE_BROADCASTER_PROMOTION_PANEL,href:`/tipping/purchase_tokens/?source=${D.Bm.current.PurchaseEventSources.TOKEN_SOURCE_BROADCASTER_PROMOTION_PANEL}`,ref:e=>{(0,N.HH)(e)}},w.R.userPromotionPurchaseTokensText))),this.openLink=this.constructOpenLink(),(0,b.wu)("click",this.openLink,()=>{this.eligibility===k.So.ELIGIBLE&&this.toggleShowHide()}),this.refreshPromotionState(),B.WK.listen(()=>{this.refreshPromotionState()}),_.X0.listen(e=>{this.chatConnection=e.chatConnection}),A.J.listen(()=>{this.updatePromotionPanelState(k.So.PENDING_START)}),this.boundListeners.add(P.D.listen(e=>{this.showHidePurchaseToken(e.tokens)})),this.hideElement()}constructOpenLink(){return(0,c.tT)("a",{colorClass:u.aG.hrefColor,style:this.openLinkStyle,href:"#"},w.R.userPromotionToolbarOpenBodyButton)}getOpenLink(){return this.openLink}updateStatusText(){this.eligibility===k.So.PENDING_START?(this.openLink.title=w.R.userPromotionSettingUp,this.openLink.textContent=w.R.userPromotionSettingUp):this.eligibility===k.So.PENDING_FINISH?(this.openLink.title=w.R.userPromotionEnding,this.openLink.textContent=w.R.userPromotionEnding):this.eligibility===k.So.ELIGIBLE?(this.openLink.title=w.R.userPromotionToolbarOpenBodyButton,this.openLink.textContent=w.R.userPromotionToolbarOpenBodyButton,this.openLink.dataset.testid="promote-stream-btn",this.openLink.style.display="inline-block",this.openLink.style.cursor="pointer",this.openLink.style.textDecoration=""):(this.openLink.title="",this.openLink.textContent=w.R.userPromotionToolbarInProgressText((0,r._O)(this.secondsRemaining)))}updatePromotionPanelState(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.eligibility!==e){const i=this.isInProgress();this.eligibility=e,(0,U.ok)()?this.showErrorAndHide(w.R.userPromotionMustBeLoggedInAlert,t):this.eligibility===k.So.ACCOUNT_INELIGIBLE?this.showErrorAndHide(w.R.userPromotionIneligibleText,t):this.eligibility===k.So.PURCHASER_INELIGIBLE?this.showErrorAndHide(w.R.userPromotionPurchaserIneligibleText,t):this.eligibility===k.So.ROOM_STATUS_OFFLINE?this.showErrorAndHide(w.R.userPromotionMustBeOnlineAlert,t):this.isInProgress()?this.updateInProgressPanel():this.eligibility===k.So.ELIGIBLE?(this.updateStatusText(),Z.panelVisibilityChange.fire(this)):this.showErrorAndHide(w.R.userPromotionBadSettingsText,t),!i||(0,U.ok)()||this.isInProgress()||this.displayPromotionReport()}this.setRefreshPromotionStateTimeout()}showErrorAndHide(e,t){t&&(0,a.Q$)(e),this.hideElement(),this.openLink.style.display="none",Z.panelVisibilityChange.fire(this)}updateInProgressPanel(){this.hideElement(),this.openLink.style.cursor="default",this.openLink.style.textDecoration="none",this.secondsRemaining>0&&void 0===this.updateStatusIntervalId&&this.setUpdateIntervalForCountingRemainingSeconds(),this.updateStatusText()}isInProgress(){return this.eligibility===k.So.ACTIVE||this.eligibility===k.So.PENDING_START||this.eligibility===k.So.PENDING_FINISH}setRefreshPromotionStateTimeout(){void 0===this.updateStatusIntervalId&&(void 0!==this.refreshStatusTimeoutId&&clearTimeout(this.refreshStatusTimeoutId),this.refreshStatusTimeoutId=window.setTimeout(()=>{this.refreshStatusTimeoutId=void 0,this.refreshPromotionState()},1e3*this.nextRefreshSeconds))}setUpdateIntervalForCountingRemainingSeconds(){this.endTime=Date.now()+1e3*this.secondsRemaining,this.updateStatusIntervalId=window.setInterval(()=>{const e=Math.floor((this.endTime-Date.now())/1e3);e<=0?(clearInterval(this.updateStatusIntervalId),this.updateStatusIntervalId=void 0,this.refreshPromotionState()):this.secondsRemaining=e,this.updateStatusText()},1e3)}onSubmit(){if(D.Bm.current.isNoninteractiveUser)return void(0,a.Q$)(w.R.internalStaffPromotion);(0,x.bT)("BroadcasterPromotionPanel_doSubmitStart");const e=new FormData;e.append("csrfmiddlewaretoken",(0,m.I7)("csrftoken")),e.append("token_price",`${this.tokenPrice}`),L._.submitPromotion(e).then(e=>{const t=new r.N6(e.responseText);P.D.fire({tokens:t.getNumber("token_balance")}),this.hideElement(),(0,x.bT)("BroadcasterPromotionPanel_doSubmitSuccess")}).catch(e=>{const t=new r.N6(e.xhr.responseText),i=t.getString("code"),s=t.getString("detail");(0,x.bT)("BroadcasterPromotionPanel_userPromotionSubmitError",{status:(0,r.zm)(i,e.xhr.statusText),response:(0,r.zm)(s,e.xhr.responseText)}),(0,a.Q$)((0,r.zm)(s,w.R.userPromotionSubmitUnknownException))})}refreshPromotionState(){L._.promotionState().then(e=>{const t=new r.N6(e.responseText);this.nextRefreshSeconds=t.getNumber("next_refresh_seconds"),this.secondsRemaining=t.getNumber("seconds_remaining"),this.updatePromotionPanelState(t.getString("eligibility"))}).catch(e=>{this.nextRefreshSeconds=30,this.setRefreshPromotionStateTimeout(),(0,x.bT)("BroadcasterPromotionPanel_refreshPromotionStateError",{error:e.toString(),source:"loadPromotionState"})})}loadPromotionPrice(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.currentPriceElement.style.font="12px 'UbuntuMedium', Arial, Helvetica, sans-serif",this.currentPriceElement.textContent=w.R.userPromotionLoadingNewPriceText,this.disableSubmitButton(),L._.promotionPrice().then(t=>{const i=new r.N6(t.responseText);this.tokenPriceTimeRemaining=1e3*i.getNumber("seconds_remaining",!1),this.tokenPrice=i.getNumber("token_price");const s=i.getNumber("token_balance");this.currentPriceElement.style.font="12px 'UbuntuRegular', Arial, Helvetica, sans-serif",this.currentPriceElement.textContent=w.R.userPromotionCurrentPriceText(this.tokenPrice),this.showHidePurchaseToken(s),this.tokenPriceTimeoutId=window.setTimeout(()=>{this.loadPromotionPrice()},this.tokenPriceTimeRemaining+1e3),this.updatePromotionPanelState(i.getString("eligibility"),e)}).catch(t=>{e&&(0,a.Q$)(w.R.userPromotionPriceUnknownException),(0,x.bT)("BroadcasterPromotionPanel_loadPromotionPriceError",{error:t.toString()})})}displayPromotionReport(){L._.promotionReport().then(e=>{const t=new r.N6(e.responseText).getNumber("view_count");this.chatConnection.event.roomNotice.fire({messages:[[(0,O.H5)(w.R.userPromotionReportText(t))]],showInPrivateMessage:!0})}).catch(e=>{(0,x.bT)("BroadcasterPromotionPanel_loadPromotionReport",{error:e.toString()}),void 0!==e.xhr&&401===e.xhr.status&&this.showErrorAndHide("",!1)})}showHidePurchaseToken(e){e>=this.tokenPrice?(this.getMoreTokensElement.style.display="none",this.enableSubmitButton()):(this.getMoreTokensElement.style.display="block",this.disableSubmitButton())}disableSubmitButton(){(0,d.ZM)(this.submitButton,{opacity:".5",cursor:"default"}),this.submitButton.disabled=!0}enableSubmitButton(){(0,d.ZM)(this.submitButton,{opacity:"1",cursor:"pointer"}),this.submitButton.disabled=!1}showElement(){this.isShown()||(super.showElement(),this.loadPromotionPrice(),this.openLink.style.font="12px UbuntuBold, Arial, Helvetica, sans-serif",this.openLink.style.textDecoration="none",(0,x.bT)("BroadcasterPromotionPanel_open"),Z.panelVisibilityChange.fire(this))}hideElement(){this.isShown()&&(super.hideElement(),void 0!==this.tokenPriceTimeoutId&&clearTimeout(this.tokenPriceTimeoutId),this.refreshPromotionState(),this.openLink.style.font="12px UbuntuMedium, Arial, Helvetica, sans-serif",this.openLink.style.textDecoration="",(0,x.bT)("BroadcasterPromotionPanel_close"),Z.panelVisibilityChange.fire(this))}render(){return this.element}}class M extends l.u{constructor(e,t){super(),this.enableNotify=e,this.enablePromoted=t,this.element=(0,c.tT)("div",{style:{fontSize:"12px"},"data-testid":"broadcaster-tools-panel"},(0,c.tT)("div",{ref:e=>this.toolbar=e}),this.enableNotify?(0,c.tT)(E,{classRef:e=>{this.notifyPanel=e}}):"",this.enablePromoted?(0,c.tT)(H,{classRef:e=>{this.promotionPanel=e}}):""),void 0!==this.notifyPanel&&(this.toolbar.appendChild(this.notifyPanel.getOpenLink()),Z.panelVisibilityChange.fire(this.notifyPanel)),this.toolbar.appendChild((new F).element),void 0!==this.promotionPanel&&(this.toolbar.appendChild(this.promotionPanel.getOpenLink()),Z.panelVisibilityChange.fire(this.promotionPanel)),Z.panelVisibilityChange.listen(e=>{void 0!==this.promotionPanel&&void 0!==this.notifyPanel&&this.promotionPanel.isShown()&&this.notifyPanel.isShown()&&(this.promotionPanel===e?this.notifyPanel.hideElement():this.promotionPanel.hideElement())})}}class F extends l.u{constructor(){super("span"),this.element.innerText="|",(0,d.ZM)(this,{display:"none",paddingLeft:"10px",width:"",height:"",position:"relative",overflow:"visible"}),Z.panelVisibilityChange.listen(()=>{null!==this.element.nextElementSibling&&this.element.nextElementSibling instanceof HTMLElement&&"none"!==this.element.nextElementSibling.style.display&&null!==this.element.previousElementSibling&&this.element.previousElementSibling instanceof HTMLElement&&"none"!==this.element.previousElementSibling.style.display?this.showElement():this.hideElement()})}showElement(){super.showElement(),this.element.style.display="inline-block"}}class Z{}Z.panelVisibilityChange=new h.c_("panelVisibilityChange");var W=i(9757),G=i(5901),j=i(768),$=i(7809),V=i(1131),z=i(1519),Y=i(9060),K=i(1779),q=i(4793),Q=i(74),X=i(7250),J=i(8638),ee=i(6662),te=i(1244),ie=i(5020),se=i(5173);class ne extends se.Q{constructor(e){super(),this.titleInput=e,this.element.style.display="none",this.element.style.position="absolute",this.element.style.width="auto",this.element.style.height="auto",this.element.style.borderWidth="2px",this.element.style.borderStyle="solid",this.element.style.overflow="visible",this.element.style.maxWidth="320px",this.element.style.borderRadius="5px",(0,u.fZ)(this.element,"HashtagWarning");const t=(0,ie.Uv)("","","50%",2);(0,u.fZ)(t,"divotBottom"),this.element.appendChild(t);const i=document.createElement("div");i.innerText=w.R.hashtagWarning,i.style.position="relative",i.style.paddingTop="10px",i.style.paddingBottom="10px",i.style.paddingLeft="15px",i.style.paddingRight="15px",i.style.fontSize="14px",this.element.appendChild(i),(0,b.wu)("input",this.titleInput,e=>{this.checkTagLimit(e)}),(0,b.wu)("focus",this.titleInput,e=>{this.checkTagLimit(e)}),(0,b.wu)("blur",this.titleInput,e=>{this.hide()})}checkTagLimit(e){var t;const i=null!==(t=e.target.value.match(/#[a-z0-9\-_]{1,50}/gi))&&void 0!==t?t:[],s=new Set(i.map(e=>e.toLowerCase())).size;s>5?this.show():this.hide()}updatePosition(){const e=this.element.offsetHeight,t=this.element.offsetWidth,i=this.titleInput.getBoundingClientRect(),s=i.top+window.pageYOffset,n=i.left+window.pageXOffset+.85*this.titleInput.offsetWidth-.5*t;this.element.style.top=s-e-20+"px",this.element.style.left=`${n}px`}show(){this.element.style.display="block",this.updatePosition(),this.repositionChildrenRecursive()}hide(){this.element.style.display="none",this.repositionChildrenRecursive()}}var oe=i(6669),ae=i(4092),re=i(2196),le=i(5091),de=i(2846),he=i(4110),ce=i(7882),pe=i(8529);class me extends pe.s{constructor(){super()}welcomeWarning(){return w.R.broadcasterWelcomeWarning}welcomeMessage(){const e=me.camVisibileTo.map(ue),t=ue("t");if(-1!==e.indexOf(t)&&(e.splice(e.indexOf(t),1),e.push(t)),e.length>1){const t=e[e.length-1];e[e.length-1]=`${w.R.and} ${t}`}const i=e.length>2?", ":" ";return w.R.broadcasterWelcomeMessage(e.join(i))}}function ue(e){switch(e){case ce.YT.Male:return w.R.menLower;case ce.YT.Female:return w.R.womenLower;case ce.YT.Trans:case ce.YT.OldTrans:return w.R.transViewers;case ce.YT.Couple:return w.R.couplesLower;default:return error(`Cannot convert abbreviation to plural ${e}`),""}}var ge=i(6561);class ye extends ge.n{constructor(){super(!0),this.element.style.position="relative",this.element.style.display="block",this.element.style.margin="0 0 0 508px",this.element.style.height="100%",this.element.style.width="auto",this.element.style.lineHeight="normal",(0,Y.Dn)()&&(this.element.style.overflow="initial")}createChatTab(){return new me}}var be=i(4941),fe=i(9741),xe=i(34),ve=i(3741),we=i(9523);class Ce extends l.u{constructor(e,t){super(),this.context=e,this.isInPMTab=t,this.panels=[],this.appPanel=be.bt?new be.yc:new be.Y6,(0,u.fZ)(this.element,"BroadcasterPanel"),this.element.style.position="relative",this.element.style.width="498px",this.element.style.height="75px",this.element.style.overflow="",(0,Y.RA)()&&(0,d.ZM)(this.element,{width:"543px",height:"78px",position:"absolute",bottom:"16px"}),ve.qH.setUCMContainer(this.element),this.appPanel.element.style.padding="0",this.appPanel.element.style.height="69px",this.awayPanel=this.createAwayPanel(),this.showRequestedPanel=this.createShowRequestedPanel(),this.goalConfigurationPanel=this.createGoalConfigurationPanel(),this.goalDisplayPanel=this.createGoalDisplayPanel(),this.privateShowPanel=this.createPrivateShowPanel(),this.defaultPanel=this.createDefaultPanel(),this.showPanel(5),_.X0.listen(e=>{e.chatConnection.event.statusChange.listen(e=>{switch(e.currentStatus){case r.Ad.Away:this.showPanel(0);break;case r.Ad.PrivateWatching:this.showPanel(4);break;case r.Ad.Public:this.showPanel(5);break;case r.Ad.Offline:e.previousStatus!==r.Ad.PrivateWatching&&this.showPanel(5)}})})}updateViewForOBS(){this.externalBroadcastLink&&(this.externalBroadcastLink.style.display="none")}hidePanels(){for(const e of this.panels)e.style.display="none"}showPanel(e){switch(this.showElement(),e){case 0:this._showPanel(this.awayPanel,0);break;case 1:this._showPanel(this.showRequestedPanel,1);break;case 2:this._showPanel(this.goalConfigurationPanel,2);break;case 3:this._showPanel(this.goalDisplayPanel,3);break;case 4:this._showPanel(this.privateShowPanel,4);break;case 5:this.appPanel.hasContent?this._showPanel(this.goalDisplayPanel,3):this._showPanel(this.defaultPanel,5)}}_showPanel(e,t){this.hidePanels(),this.activePanel=t,e.style.display="block"}createAwayPanel(){const e=this.createPanel(!0);e.style.padding="9px";const t=this.createLine(!0),i=this.createLine(),s=this.createLink(w.R.returnToPublicChat,!0,!0);return s.onclick=e=>{e.preventDefault(),(0,xe.vZ)()},t.innerText=w.R.privateShowEnded,i.innerText=w.R.cameraRemainHidden,e.appendChild(t),e.appendChild(i),e.appendChild(s),e}createShowRequestedPanel(){const e=this.createPanel(!0);e.style.overflowY="auto",e.style.height="63px",e.style.padding="13px 13px 0px 13px";const t=this.createLine(!0),i=document.createElement("span");let s="";t.appendChild(i);const n=this.createLink(w.R.accept,!0),o=this.createLink(w.R.decline,!0);n.onclick=e=>{e.preventDefault(),(0,xe.sT)(),(0,Y.BP)()&&this.isInPMTab()&&he.E3.fire({username:s,focus:!0,showSupporterAlert:!1})},o.onclick=e=>{e.preventDefault(),(0,a.mf)(w.R.areYouSure,()=>{(0,xe.BO)()})};const r=document.createElement("span");r.style.whiteSpace="nowrap",r.appendChild(document.createTextNode(" ( ")),r.appendChild(n),r.appendChild(document.createTextNode(` ${w.R.orSimple} `)),r.appendChild(o),r.appendChild(document.createTextNode(" )")),t.appendChild(r);const l=this.createLine();return e.appendChild(t),e.appendChild(l),_.X0.listen(e=>{e.chatConnection.event.privateShowRequest.listen(t=>{e.chatConnection.event.playSound.fire("PrivateShow"),l.innerText=w.R.privateShowEarningsMessage(t.tokensPerMinute);let n=w.R.privateShowRequestNotice(t.userRequesting);s=t.userRequesting,!0===t.isF2F?n=J.i._({id:"cSp0g5",message:"{requestingUser} wants to start a Two Way Video Call private show. This is a one on one show and will prevent spying.",values:{requestingUser:s}}):!0===t.isPremium&&(n=w.R.premiumPrivateShowRequestNotice(t.userRequesting)),i.innerText=n,this.showPanel(1),e.chatConnection.event.roomNotice.fire({messages:[[(0,O.H5)(n),(0,O.H5)(" ("),{partType:k.OA.acceptPrivateShow},(0,O.H5)(")")]],foreground:"#222",background:"#ff8b45",weight:"bold",showInPrivateMessage:!0,toUser:s})})}),e}createGoalConfigurationPanel(){return this.createPanel()}createGoalDisplayPanel(){const e=this.createPanel();return e.innerText="",e.appendChild(this.appPanel.element),this.context.isAgeVerified&&e.appendChild(this.createBroadcasterTokenOptionsDefault()),this.appPanel.panelUpdated.listen(()=>{this.appPanel.hasContent&&5===this.activePanel?this.showPanel(3):this.appPanel.hasContent||3!==this.activePanel||this.showPanel(5)}),e}createPrivateShowPanel(){const e=this.createPanel();let t,i=0,s=0;const n=()=>{const e=(0,fe.a)({name:"",template:"3_rows_11_22_32",firstRowLabel:"",secondRowLabel:`${w.R.tokenBalanceText} :`,thirdRowLabel:`${w.R.userTokenRate} :`,firstRowValue:w.R.privateShowStats,secondRowValue:`${s}`,thirdRowValue:w.R.tokensPerMinute(i)});return e.style.width=be.bt?"320px":"270px",e.style.height="70px",e.style.margin="0",e},o=()=>{const i=t;t=n(),e.replaceChild(t,i)};t=n(),e.appendChild(t);const r=this.createTokenOptionsContainer(),l=this.createLink(w.R.exitPrivateShow);return l.onclick=e=>{e.preventDefault(),(0,a.mf)(w.R.areYouSure,()=>{(0,xe.BO)()})},r.appendChild(l),e.appendChild(r),_.X0.listen(e=>{s=e.dossier.tokenBalance,o(),e.chatConnection.event.privateShowRequest.listen(e=>{i=e.tokensPerMinute,o()}),e.chatConnection.event.tokenBalanceUpdate.listen(e=>{s=e.tokens,o()})}),e}createDefaultPanel(){const e=this.createPanel();if(this.context.isAgeVerified){const t=document.createElement("div");(0,u.fZ)(t,"panelIntro"),e.appendChild(t),t.innerText=w.R.useAppsAndBots,t.style.position="relative",(0,Y.RA)()?((0,u.fZ)(t,"NewTagPromoPeriodActive"),(0,d.ZM)(t,{boxSizing:"border-box",width:"259px",borderRadius:"4px",height:"78px",padding:"8px"})):(0,d.ZM)(t,{marginTop:"5px",marginLeft:"5px",width:"240px",height:"45px",padding:"7px"}),t.dataset.testid="default-app-panel",e.appendChild(this.createBroadcasterTokenOptionsDefault())}return _.X0.listen(e=>{e.chatConnection.event.statusChange.listen(e=>{(e.currentStatus===r.Ad.Public||e.currentStatus===r.Ad.Offline&&e.previousStatus!==r.Ad.PrivateWatching)&&this.showPanel(5)})}),e}createPanel(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=document.createElement("div");return(0,u.fZ)(t,"broadcasterPanel"),this.panels.push(t),this.element.appendChild(t),t.style.display="none",t.style.position="relative",e&&((0,u.fZ)(t,"broadcasterPanelBackground"),t.style.padding="13px",t.style.margin="0",t.style.textAlign="center"),t}createLine(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=document.createElement("div");return t.style.margin="4px",e&&((0,u.fZ)(t,"lineBold"),t.style.font="14px 'UbuntuBold', Arial, Helvetica, sans-serif",t.style.fontWeight="bold"),t}createLink(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=document.createElement("a");return(0,u.fZ)(s,u.aG.hrefColor),s.innerText=e,s.href="#",t&&(0,u.fZ)(s,"linkOrange"),i&&(s.style.font="14px 'UbuntuBold', Arial, Helvetica, sans-serif",s.style.fontWeight="bold"),s}createBroadcasterTokenOptionsDefault(){const e=this.createTokenOptionsContainer(),t=document.createElement("div");t.innerText=`${w.R.privates}: `;const i=document.createElement("a");return(0,u.fZ)(i,u.aG.hrefColor),i.href="#",i.innerText=this.context.allowPrivateShows?w.R.allowed:w.R.disabled,i.onclick=e=>{e.preventDefault(),we.eN.fire(void 0)},we.Go.listen(e=>{e.allowPrivateShows?i.innerText=w.R.allowed:i.innerText=w.R.disabled}),t.appendChild(i),e.appendChild(t),(0,Y.RA)()&&!this.usingExternalEncoder()&&(this.externalBroadcastLink=document.createElement("a"),(0,u.fZ)(this.externalBroadcastLink,u.aG.hrefColor),this.externalBroadcastLink.innerText=w.R.useExternalEncoder,(0,d.ZM)(this.externalBroadcastLink,{cursor:"pointer",lineHeight:"22px"}),this.externalBroadcastLink.onclick=()=>{const e=new URLSearchParams([["useExternalSoftware","true"]]);window.location.search=`?${e.toString()}`},e.appendChild(this.externalBroadcastLink)),e}usingExternalEncoder(){return"true"===new URLSearchParams(window.location.search).get("useExternalSoftware")}createTokenOptionsContainer(){const e=document.createElement("div");return e.style.position="absolute",e.style.top="0px",e.style.left=be.bt?"330px":"280px",e.style.width="195px",e.style.fontSize="11px",(0,Y.RA)()&&(0,d.ZM)(e,{display:"flex",flexDirection:"column",gap:"4px",width:"268px",fontSize:"14px"}),e}}var Te=i(3192),Se=i(2890),Re=i(6657),Ie=i(4693);class Ee extends Re.c{constructor(){super(...arguments),this.cacheTTL=3e5,this.maxSearchSlugLength=50,this.filterAfterSize=1,this.maxOptionLength=30}initData(){super.initData(),this.disableCache=!0,this.isPrefixSearch=!1}initUI(){super.initUI(),this.list.style.width="264px",(0,Y.RA)()&&(0,d.ZM)(this.list,{width:"100%",maxWidth:"100%"}),(0,u.fZ)(this.element,"broadcasterTags"),(0,d.ZM)(this.element,{position:"relative",top:"4px",left:"0",borderRadius:"5px"}),(0,Y.RA)()&&(0,d.ZM)(this.element,{position:"absolute",top:"42px",left:"0",maxWidth:"100%",width:"100%",zIndex:2}),(0,b.wu)("mouseleave",this.element,()=>{void 0===this.ignoreMouseTimeout&&(this.clearSelectionStyle(),this.replacePreCaratInputText(this.searchSlug,!1))})}promptRegex(){return"#"}searchSlugRegex(){return"[\\w-]+"}getCache(){return void 0===this.cache&&(this.cache=new Ie.wT(this.filterAfterSize,this.cacheTTL)),this.cache}getDataEndpoint(){return`tags/autocomplete/?slug=${this.searchSlug}`}parseResponse(e){var t;const i=new r.N6(e),s=null!==(t=i.getList("tags"))&&void 0!==t?t:[],n=[];for(const e of s){const t=e.getString("hashtag");if(""===t)continue;let i=e.getNumberOrUndefined("tag_score");void 0===i&&(error("hashtag autocomplete NaN tag score"),i=0),n.push({slug:t,tagScore:i,element:ke})}return i.logUnusedDebugging("parseHashtagAutocompleteResponse"),n}updateListDOM(){super.updateListDOM(),this.list.scrollTop=0,this.preventTriggeringMouseEvents(),this.repositionChildren()}appendItem(e,t){const i=super.appendItem(e,t);i.style.display="flex",i.style.justifyContent="space-between",i.style.whiteSpace="nowrap",i.style.padding="4px 16px",i.style.boxSizing="border-box",i.style.fontFamily="UbuntuRegular",i.style.display="block",i.style.height="26px";const s=i.querySelector(".tag-text");return null!==s&&(s.style.height="18px",""===this.searchSlug?s.textContent=`#${s.textContent}`:this.boldPrefixInTag(s)),i.onclick=e=>{e.preventDefault(),this.selectedIndex!==t&&this.pickItem(t,!1),this.finalizeSelection(),this.hide()},i.onmouseenter=e=>{e.preventDefault(),void 0===this.ignoreMouseTimeout&&this.pickItem(t,!1)},i}boldPrefixInTag(e){const t=e.textContent;if(null===t)return;const i=this.searchSlug.toLowerCase();if(t.includes(i)){e.textContent="";const s=t.split(i),n=document.createElement("span");n.textContent=`#${s[0]}`;const o=document.createElement("span");o.style.fontFamily="UbuntuBold",o.textContent=i;const a=document.createElement("span"),r=t.indexOf(i)+i.length;a.textContent=t.slice(r),e.appendChild(n),e.appendChild(o),e.appendChild(a)}else e.textContent=`#${e.textContent}`}handleArrowUpDown(e){const t=()=>{e.preventDefault(),e.stopImmediatePropagation(),this.preventTriggeringMouseEvents()};"ArrowUp"===e.code&&(t(),this.scrollList(!0)),"ArrowDown"===e.code&&(t(),this.scrollList(!1))}preventTriggeringMouseEvents(){void 0!==this.ignoreMouseTimeout&&window.clearTimeout(this.ignoreMouseTimeout),this.ignoreMouseTimeout=window.setTimeout(()=>{this.ignoreMouseTimeout=void 0},100)}scrollToIndex(e){const t=this.list.clientHeight,i=this.list.firstChild.clientHeight,s=this.list.scrollTop,n=(e+1)*i-t,o=e*i;s<n?this.list.scrollTop=n:s>o&&(this.list.scrollTop=o)}repositionChildren(){}}const ke=document.createElement("div");var Pe=i(2861),Be=i(415);const Ae=(0,Y.RA)();class Le extends l.u{constructor(e){super(),this.context=e,this.obsOverlay=new Pe.p(this.context.broadcastDossier.originWSEndpoint),this.videoAndChatSection=document.createElement("div"),this.movieHolder=document.createElement("div"),this.obsSection=document.createElement("div"),this.webRTCStart=document.createElement("div"),this.videoBox=document.createElement("div"),this.broadcasterIntro=document.createElement("div"),this.titleHeader=document.createElement("h2"),this.titleInput=document.createElement("input"),this.showObsInfoOverlay=new h.c_("ShowOBSInfoOverlay"),(0,u.fZ)(this.element,"BroadcastContent"),this.element.style.height="auto",this.element.style.width="auto",this.element.style.position="static",this.element.style.borderRadius="4px",this.element.style.padding="4px",this.element.style.overflow="hidden",this.element.appendChild(this.videoAndChatSection),this.videoAndChatSection.style.margin="0 0 5px",this.resizeVideoAndChatSection(),this.createVideoBox(),this.videoAndChatSection.appendChild(this.videoBox),this.videoAndChatSection.appendChild(this.createChat()),this.element.appendChild(new ee.c(!0).element),this.initializeNewTagTimer(),this.addChild(new re.N),this.addChild(new Te.t3(this.context.broadcastDossier.room,this.context.initialBroadcasterDossier,this.context.roomDossier)),this.obsOverlay.obsStarted.listen(()=>{var e;this.context.checkIsWebRTCBroadcasting()||(this.hideBroadcasterShowOBS(),null===(e=this.broadcasterPanel)||void 0===e||e.updateViewForOBS())}),_.X0.listen(e=>{e.chatConnection.event.titleChange.listen(e=>{Ae?this.titleInputReact.update({subject:e,isLoading:!1}):(this.titleHeader.innerText=e,this.titleHeader.title=e,this.titleInput.value=e)}),this.obsOverlay.monitorRoomStatus()}),Pe._.listen(()=>{this.hideBroadcasterShowOBS()}),te.F.selectionChange.listen(e=>{null==e&&this.hideGameInfo()},!1)}resizeVideoAndChatSection(){var e;this.videoAndChatSection.style.height=Ae?654-(!0===(null===(e=this.context.broadcastDossier.newTagInfo)||void 0===e?void 0:e.isNew)?0:62)+"px":"614px"}isOBSOverlayOffline(){return this.obsOverlay.isOffline()}createVideoBox(){var e;(0,u.fZ)(this.videoBox,"BroadcastVideoPanel"),this.videoBox.style.height="100%",this.videoBox.style.cssFloat="left",this.videoBox.style.borderRadius="2px",this.videoBox.style.position="relative",Ae?(0,d.ZM)(this.videoBox,{width:"575px",padding:"16px",boxSizing:"border-box",marginRight:"4px"}):this.videoBox.style.width="498px",this.createRoomTitleSection(),Ae&&!0===(null===(e=this.context.broadcastDossier.newTagInfo)||void 0===e?void 0:e.isNew)&&this.videoBox.appendChild(this.createNewTagBanner()),this.createPlayerSection(),this.context.initialBroadcasterDossier.isAgeVerified&&(this.broadcasterPanel=new Ce(this.context.initialBroadcasterDossier,()=>this.chatTabContainer.getCurrentTab()instanceof de.T),this.videoBox.appendChild(this.broadcasterPanel.element))}createRoomTitleSection(){(0,u.fZ)(this.titleInput,"titleInput"),this.titleInput.maxLength=200,this.titleInput.value="",this.customInput=new oe.op(this.titleInput),this.hashtagAutocompleteModal=new Ee({inputElement:this.customInput,leftOffset:0,rightOffset:0}),this.hashtagAutocompleteModal.afterDOMConstructedIncludingChildren();const e=new ne(this.titleInput);if(this.element.appendChild(e.element),Ae)this.videoBox.appendChild(this.createRoomSubject());else{this.titleInput.style.width="300px",this.titleInput.style.height="auto",this.titleInput.style.lineHeight="normal",this.titleInput.style.marginTop="auto",this.titleInput.style.border="none",this.titleInput.style.padding="0px 1px",this.titleInput.style.borderStyle="solid",this.titleInput.style.borderWidth="1px",this.titleInput.style.borderRadius="4px";const e=document.createElement("div");(0,u.fZ)(e,"roomTitle"),e.style.overflow="hidden",e.style.height="17px",e.style.padding="6px 6px 9px 9px",e.appendChild(this.titleHeader),this.titleHeader.dataset.testid="room-title",this.titleHeader.innerText="",this.titleHeader.title="",this.titleHeader.style.height="19px",this.titleHeader.style.lineHeight="19px",this.titleHeader.style.fontSize="12px",this.titleHeader.style.overflow="hidden",this.titleHeader.style.margin="0",this.titleHeader.style.fontWeight="400",this.titleHeader.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",this.titleHeader.style.cursor="pointer",this.titleHeader.style.textOverflow="ellipsis",this.titleHeader.style.whiteSpace="nowrap";const t=document.createElement("form"),i=document.createElement("button"),s=document.createElement("button"),n=document.createElement("div");e.appendChild(t),t.appendChild(this.titleInput),t.appendChild(s),t.appendChild(i),e.appendChild(n),t.style.display="none",t.style.position="absolute",t.style.margin="0",t.style.padding="0",t.style.borderStyle="none",(0,u.fZ)(i,"titleBtn"),i.style.font="100% Arial, Helvetica, sans-serif",i.style.verticalAlign="middle",i.style.marginLeft="3px",i.style.borderStyle="solid",i.style.borderWidth="1px",i.style.borderRadius="4px",i.style.fontFamily="'UbuntuRegular', Arial, Helvetica, sans-serif",i.style.cursor="pointer",i.dataset.testid="cancel-title-button",(0,u.fZ)(s,"titleBtn"),s.style.font="100% Arial, Helvetica, sans-serif",s.style.verticalAlign="middle",s.style.marginLeft="3px",s.style.borderStyle="solid",s.style.borderWidth="1px",s.style.borderRadius="4px",s.style.fontFamily="'UbuntuRegular', Arial, Helvetica, sans-serif",s.style.cursor="pointer",s.dataset.testid="submit-title-button",i.type="button",i.innerText=w.R.cancelText,s.type="submit",s.innerText=w.R.submitText,(0,u.fZ)(n,"tooltip"),n.style.display="none",n.style.position="absolute",n.style.top="32px",n.style.left="0px",n.style.width="475px",n.style.borderRadius="4px",n.style.borderWidth="1px",n.style.borderStyle="solid",n.style.padding="10px",n.style.height="auto",n.style.zIndex="999",n.innerText=w.R.tryAddingHashtags;let o="";this.titleHeader.onclick=()=>{o=this.titleInput.value,this.titleHeader.style.display="none",t.style.display="block",n.style.display="block",this.titleInput.focus()},t.onsubmit=e=>{e.preventDefault();const i=this.titleHeader.innerText;this.titleHeader.innerText=this.titleInput.value,this.titleHeader.title=this.titleInput.value,this.titleHeader.style.display="block",t.style.display="none",n.style.display="none",(0,f.KF)("api/ts/chat/change-title/",{room_slug:this.context.broadcastDossier.room,subject:this.titleInput.value}).catch(e=>{this.titleHeader.innerText=i,this.titleHeader.title=i,error("Error changing room title",e)})},i.onclick=e=>{e.preventDefault(),this.titleHeader.style.display="block",t.style.display="none",n.style.display="none",this.titleInput.value=o},this.videoBox.appendChild(e),t.appendChild(this.hashtagAutocompleteModal.element)}}createPlayerSection(){const e=document.createElement("div");e.id="player",e.style.height=Ae?"404px":"507px",this.videoBox.appendChild(e);const t=!this.context.initialBroadcasterDossier.isAgeVerified;if(t){const t=document.createElement("span");t.innerHTML=w.R.enableAgeVerificationToReceiveTokens(),t.style.padding=Ae?"16px 0px 8px":"4px 8px 8px",t.style.display="block";const i=t.querySelector("a");null!==i&&(i.onclick=()=>(0,x.bT)("BroadcastAVPromptClicked")),e.appendChild(t)}this.movieHolder.style.display="none",this.movieHolder.style.paddingTop=t?"0px":Ae?"16px":"20px",e.appendChild(this.movieHolder);const i=document.createElement("div");i.id="movie",this.movieHolder.appendChild(i),this.createExternalBroadcastSection(),this.createBroadcasterIntro(e)}createBroadcasterIntro(e){const t=!this.context.initialBroadcasterDossier.isAgeVerified;(0,u.fZ)(this.broadcasterIntro,"broadcasterIntro"),this.broadcasterIntro.style.textAlign="center",this.broadcasterIntro.style.width="100%",this.broadcasterIntro.style.paddingTop=t?"20px":"28px",Ae?((0,u.fZ)(this.broadcasterIntro,"NewTagPromoPeriodActive"),(0,d.ZM)(this.broadcasterIntro,{height:"100%",padding:"12px",boxSizing:"border-box",borderRadius:"4px",borderWidth:"1px",borderStyle:"solid"})):this.broadcasterIntro.style.height="507px",e.appendChild(this.broadcasterIntro),e.appendChild(this.obsOverlay.element),this.obsOverlay.getOBSInfoLink().onclick=()=>{this.showObsInfoOverlay.fire(void 0)},this.webRTCStart.style.display="",this.fillObsSection(),this.fillWebRTCStart(),this.broadcasterIntro.appendChild(this.webRTCStart),this.broadcasterIntro.appendChild(this.obsSection)}createExternalBroadcastSection(){if(!(this.usingExternalEncoder()||Ae&&this.context.initialBroadcasterDossier.isAgeVerified)){const e=document.createElement("div");e.style.textAlign="center",e.style.padding="33px",e.style.fontSize="1.2em";const t=this.createLink();t.innerText=w.R.useExternalEncoder,t.style.textDecoration="",t.onclick=()=>{const e=new URLSearchParams([["useExternalSoftware","true"]]);window.location.search=`?${e.toString()}`},this.movieHolder.appendChild(e),e.appendChild(t)}}createNewTagBanner(){const e=W.c.get("NewTagBanner"),t=document.createElement("div");return t.id="new-tag-banner",new e({eventRouters:{newTagTimerInit:ae.t.newTagTimerInit,newTagTimerUpdate:ae.t.newTagTimerUpdate,roomStatusUpdate:this.obsOverlay.getRoomStatusUpdateEventRouter()}},t),t}initializeNewTagTimer(){var e,t,i;Ae&&!0===(null===(e=this.context.broadcastDossier.newTagInfo)||void 0===e?void 0:e.isNew)&&(ae.t.initializeTimer({remainingStreamTime:null===(t=this.context.broadcastDossier.newTagInfo)||void 0===t?void 0:t.remainingStreamTime,newTagExpiry:null===(i=this.context.broadcastDossier.newTagInfo)||void 0===i?void 0:i.newTagExpiry},!1),ae.t.setupRoomStatusListener(this.obsOverlay.getRoomStatusUpdateEventRouter()),ae.t.setupRoomStatusListener(Be.Ay))}createRoomSubject(){const e=W.c.get("RoomSubjectForm"),t=document.createElement("div");return this.titleInputReact=new e({subject:"",isLoading:!0,hashtagAutocompleteModal:this.hashtagAutocompleteModal.element,inputRef:this.customInput,roomStatusUpdate:this.obsOverlay.getRoomStatusUpdateEventRouter(),onSubjectChange:e=>{(0,f.KF)("api/ts/chat/change-title/",{room_slug:this.context.broadcastDossier.room,subject:e}).catch(e=>{error("Error changing room title",e)})}},t),t}fillObsSection(){const e=document.createElement("div");e.innerText=w.R.broadcastWithOBS,(0,u.fZ)(e,"obsIntro"),Ae&&(0,u.fZ)(e,"newTag"),this.obsSection.appendChild(e);const t=document.createElement("div"),i=document.createElement("a"),s=document.createElement("span"),n=document.createElement("div"),o=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),l=document.createElement("p"),d=document.createElement("img");(0,u.fZ)(t,"obsHeader"),(0,u.fZ)(n,"obsSupport"),(0,u.fZ)(o,"otherEncoders"),(0,u.fZ)(a,"otherEncoderSupport"),(0,u.fZ)(r,"obsInfoContainer"),Ae&&((0,u.fZ)(t,"newTag"),(0,u.fZ)(n,"newTag"),(0,u.fZ)(o,"newTag"),(0,u.fZ)(a,"newTag"),(0,u.fZ)(r,"newTag")),n.dataset.testid="obs-support-link",a.dataset.testid="other-encoder-support-link",d.style.height="20px",d.style.width="auto",d.style.opacity="0.5",d.style.margin="0 auto",this.obsSection.appendChild(t),t.appendChild(i),t.appendChild(s),this.obsSection.appendChild(n),this.obsSection.appendChild(o),this.obsSection.appendChild(a),this.obsSection.appendChild(r),this.obsSection.appendChild(l),this.obsSection.appendChild(d),(0,u.fZ)(i,u.aG.hrefColor),i.href=(0,f._Y)("https://obsproject.com/"),i.target="_blank",i.textContent="Open Broadcaster Software",i.dataset.testid="download-obs-link",s.textContent=w.R.obsDescription,n.innerHTML=w.R.obsSupport(g.mG.sanitizedSiteName),o.textContent=w.R.alsoSupportOtherEncoders,a.innerHTML=w.R.otherEncoderSupport;const h=this.createLink();(0,u.fZ)(h,"button"),h.innerText=w.R.viewRTMPInfo,h.id="obs_info",h.style.textDecoration="",h.style.display="inline-block",h.style.fontSize="14px",h.style.borderWidth="1px",h.style.borderStyle="solid",h.style.borderRadius="4px",Ae?(h.style.padding="4px 16px",h.style.lineHeight="22px"):h.style.padding="10px 15px",h.dataset.testid="obs-info-link",r.appendChild(h),h.onclick=()=>{this.showObsInfoOverlay.fire(void 0)},(0,u.fZ)(l,"waitingText"),Ae&&(0,u.fZ)(l,"newTag"),l.innerText=w.R.waitingForStream,d.src=`${STATIC_URL}ellipsis.svg`,d.style.display="block"}fillWebRTCStart(){const e=document.createElement("div");if((0,p.YU)()&&Be.Y9.canUseWebRTC()){const t=this.createLink();if((0,u.fZ)(t,"button"),t.innerText=w.R.startInBrowserBroadcaster,t.style.textDecoration="",t.style.display="inline-block",t.style.fontSize="14px",t.style.borderWidth="1px",t.style.borderStyle="solid",t.style.borderRadius="4px",Ae){const i=document.createElement("div");(0,u.fZ)(i,"newTagBroadcasterText"),i.innerText=J.i._({id:"/8B61r",message:"Broadcast yourself using the in-browser broadcaster "}),e.appendChild(i),t.style.padding="4px 16px",t.style.lineHeight="22px",e.style.margin=""}else e.style.margin="10px auto 8px",t.style.padding="10px 15px";t.dataset.testid="web-rtc-link",t.onclick=()=>{window.location.search=""},e.appendChild(t)}else{const t=document.createElement("div");(0,u.fZ)(t,"outdatedFeedbackBox"),t.style.borderWidth="1px",t.style.borderStyle="solid",t.style.margin="10px",t.style.padding="5px",t.innerText=w.R.outdatedBrowser,e.appendChild(t)}this.webRTCStart.appendChild(e),this.webRTCStart.appendChild(this.createOr(!0))}createOr(e){const t=document.createElement("div");return t.innerText=` - ${w.R.orLower} - `,Ae?((0,u.fZ)(t,"newTagOr"),t.style.margin="8px 0"):(t.style.margin=!0===e?"35px":"5px",t.style.fontWeight="bold"),t}createChat(){me.camVisibileTo=this.context.initialBroadcasterDossier.camVisibleTo,this.chatTabContainer=new ye,(0,Y.Dn)()&&this.chatTabContainer.element.classList.add("withShortcuts"),(0,Se.R)(this.chatTabContainer);const e=new le.I(()=>this.chatTabContainer.getCurrentTab().getChatInputField());return he.n2.listen(t=>{e.show(t)}),this.chatTabContainer.element}createLink(){const e=document.createElement("a");return(0,u.fZ)(e,u.aG.hrefColor),e.style.textDecoration="none",e.style.cursor="pointer",e}hideIntroShowWebRTC(){this.movieHolder.style.display="",this.broadcasterIntro.style.display="none"}hideBroadcasterShowOBS(){this.movieHolder.style.display="none",this.broadcasterIntro.style.display="none",this.resizeVideoAndChatSection(),this.obsOverlay.show()}hideGameInfo(){this.usingExternalEncoder()&&(this.obsSection.style.display="",this.obsOverlay.isOffline()&&(this.broadcasterIntro.style.display="",this.movieHolder.style.display="",this.webRTCStart.style.display="",this.obsOverlay.hide()))}usingExternalEncoder(){return"true"===new URLSearchParams(window.location.search).get("useExternalSoftware")}repositionChildren(){this.chatTabContainer.repositionChildrenRecursive()}}var De=i(2543);class Ne extends l.u{constructor(e){super(),this.chatBox=document.createElement("div"),this.userCount=document.createElement("span"),this.chatList=document.createElement("div"),this.tipContent=document.createElement("div"),this.broadcasterUsername=document.createElement("span"),this.element.style.display="none",this.chatBox.className="chat-box",this.userCount.className="usercount",this.chatList.className="chat-list",this.tipContent.id="tip_content",this.tipContent.setAttribute("data-modelname",e.broadcasterUsername),this.broadcasterUsername.className="user_information_header_username",this.element.appendChild(this.broadcasterUsername),this.element.appendChild(this.chatBox),this.element.appendChild(this.tipContent),this.chatBox.appendChild(this.userCount),this.chatBox.appendChild(this.chatList),this.broadcasterUsername.innerText=e.broadcasterUsername,De._g.listen("userCountUpdate",e=>{let{count:t}=e;this.userCount.innerText=`${t}`}),_.X0.listen(e=>{window.TSHandler={message_outbound:{send_room_message:t=>{e.chatConnection.sendRoomMessage(t)}}},e.chatConnection.event.tipAlert.listen(e=>{const t=document.createElement("div");t.className="text",t.style.display="none";const i=document.createElement("p"),s=document.createElement("span");s.className="tipalert",s.innerText=`"${e.fromUser.username} tipped ${e.amount} ${e.amount>1?"tokens":"token"}"`,i.appendChild(s),t.appendChild(i),this.appendMessage(t);const n=document.createElement("div");n.className="tip_item",n.setAttribute("data-username",e.fromUser.username),n.setAttribute("data-amount",String(e.amount)),e.isAnonymousTip&&n.setAttribute("data-anonymous","true"),n.innerText=`${e.fromUser.username} tipped ${e.amount} tokens`,this.tipContent.appendChild(n)}),e.chatConnection.event.roomNotice.listen(e=>{const t=document.createElement("div");t.className="text";for(const i of e.messages){i.length>=3&&" has joined the room"===i[2].message&&i.shift();for(const e of i)switch(e.partType){case k.OA.message:t.appendChild(document.createTextNode(e.message));break;case k.OA.user:const i=e.user;t.appendChild(document.createTextNode(i.username))}}this.appendMessage(t)})})}appendMessage(e){this.chatList.appendChild(e);const t=this.chatList.childElementCount-100;for(let e=0;e<=t;e+=1){const e=this.chatList.firstElementChild;null!==e&&this.chatList.removeChild(e)}}}var Ue=i(8130),Oe=i(2758),_e=i(2690);class He extends _e.zf{constructor(e,t,i){super(),this.cacheKey=`valid_ids_${null!=e?e:""}`,this.overlay.style.background="",this.overlay.style.zIndex="1090",(0,u.fZ)(this.overlay,"transparentOverlay"),this.overlayClickStayOpen=!0,this.element.style.position="fixed",this.element.style.overflow="hidden",this.element.style.height="auto",this.element.style.fontFamily="UbuntuMedium, Arial, Helvetica, sans-serif",this.element.style.width="500px",this.element.style.top="50%",this.element.style.left="50%",this.element.style.transform="translate(-50%, -56%)",this.element.style.borderRadius="6px",this.element.style.padding="10px",this.element.style.textAlign="center",this.element.style.zIndex="1091",this.element.dataset.testid="valid-id-modal",(0,u.fZ)(this.element,"broadcastTermsModal");const s=document.createElement("div");s.style.textAlign="center",(0,u.fZ)(s,"header");const n=document.createElement("h3");n.style.textAlign="center",n.innerText=w.R.ageVerifiedHeader,s.appendChild(n),this.element.appendChild(s);const o=document.createElement("div");(0,u.fZ)(o,"body"),o.style.padding="15px",o.style.border="1px solid #d6e9c6",o.style.backgroundColor="#dff0d8",o.style.color="#3c763d",o.style.textAlign="center",o.style.borderRadius="4px";const a=document.createElement("h2");a.style.textAlign="center",a.innerText=w.R.ageVerifiedBodyHeader,o.appendChild(a);const r=document.createElement("p");r.style.textAlign="center",r.innerText=w.R.ageVerifiedBody,o.appendChild(r);const l=document.createElement("div");l.style.textAlign="center",l.style.padding="10px";for(const e of t){const t=document.createElement("img");t.src=e,t.alt="Face",t.style.maxWidth="125px",t.style.maxHeight="100px",t.style.marginRight="5px",t.style.display="inline-block",t.style.border="1px solid #d6e9c6",l.appendChild(t)}if(o.appendChild(l),void 0!==i&&i.length>0){const e=document.createElement("div");e.style.textAlign="center",e.style.padding="10px",e.innerText=w.R.ageVerifiedGuests;for(const t of i){const i=document.createElement("a");i.innerText=t,i.href=(0,f._Y)(`/${t}`),i.target="blank",i.style.display="block",e.appendChild(i)}o.appendChild(e)}const d=document.createElement("p");d.style.textAlign="center",d.innerHTML=w.R.ageVerifiedBody2(),o.appendChild(d),this.element.appendChild(o);const h=document.createElement("span");(0,u.fZ)(h,"acceptLink"),h.innerText=w.R.dismissCapitalized,h.style.display="inline-block",h.style.fontFamily="UbuntuMedium, Helvetica, Arial, sans-serif",h.style.fontSize="14px",h.style.padding="5px 15px 5px 15px",h.style.margin="15px auto",h.style.borderRadius="4px",h.style.cursor="pointer",h.onclick=()=>{this.hide(),(0,Oe.nw)(this.cacheKey,"1",{hours:6})},this.element.appendChild(h)}validIdsViewed(){return"1"===(0,Oe.TS)(this.cacheKey)}}class Me extends l.u{constructor(e){super(),this.context=e,this.c1=document.createElement("div"),D.Aw.setState(this.context.roomDossier),(0,u.fZ)(this.element,"BroadcastRoot"),this.obsBroadcastInfo=new Ue.e(this.context.obsToken,this.context.obsHost),this.broadcastContent=new Le(this.context),this.audioHolder=new j.T,this.addChild(this.obsBroadcastInfo),this.element.style.position="static",this.element.style.font="1.2em/1.4em 'UbuntuRegular', Arial, Helvetica, sans-serif",this.element.style.fontSize="12px",this.element.style.paddingBottom="17px",this.context.initialBroadcasterDossier.hasGuestAccountsInvalid&&this.addChild(new q.o(w.R.inactiveGuestNotice(),{noticeType:2,ajaxUrl:"dismiss_inactive_guest/"})),this.context.initialBroadcasterDossier.pidsAboutToExpireDates.forEach(e=>{const t=new Date(e).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",timeZone:"UTC"});this.addChild(new q.o(w.R.idAboutToExpire(t),{noticeType:1}))}),this.context.initialBroadcasterDossier.guestPidsAboutToExpireUsernames.forEach(e=>{this.addChild(new q.o(w.R.guestIdAboutToExpire(e),{noticeType:1}))}),this.context.showPaxumNotice&&this.addChild(new q.o(w.R.paxumTempNotice(),{noticeType:1})),void 0!==this.context.initialBroadcasterDossier.showPersonNotice&&this.addChild(new q.o(this.context.initialBroadcasterDossier.showPersonNotice,{noticeType:1})),_.X0.listen(e=>{e.dossier.tokenBalance>0&&!e.dossier.tfaEnabled&&this.addChildBeforeIndex(new q.o(w.R.addTFANotification(),{cacheKey:`tfa-msg-${e.dossier.userName}`}),0),(0,p.hl)()||this.addChildBeforeIndex(new q.o(w.R.ieSupportNotification(),{cacheKey:"ie-support-notice"}),0)}),this.element.appendChild(this.createTopNavBar());const t=document.createElement("div");if(t.style.padding="11px 17px 17px 0",this.element.appendChild(t),(0,u.fZ)(this.c1,"c1"),this.c1.style.margin="0 0 0 32px",t.appendChild(this.c1),this.c1.appendChild(this.createPasswordWarning()),this.c1.appendChild(new M(this.context.initialBroadcasterDossier.enableNotify,this.context.initialBroadcasterDossier.enablePromoted).element),this.context.isTestbed){const e=document.createElement("h1");e.innerText="Running in TESTBED Mode. Broadcasting is intended for testing purposes only.",this.c1.appendChild(e)}this.c1.appendChild(this.broadcastContent.element),$.i.areTermsAccepted()||(new $.i).show(),this.showValidIdsModalIfNeeded();const i=()=>{(0,b.Pf)("DOMContentLoaded",document,i),(0,b.Pf)("load",window,i),this.pickPlayerToShow()};(0,b.wu)("DOMContentLoaded",document,i),(0,b.wu)("load",window,i),this.audioHolder.loadTipSounds(),this.audioHolder.loadPrivateShowSounds(),X.L.setFireVideoMode("split",{fire:!0}),this.addChild(new Ne(this.context.initialBroadcasterDossier));const s=new z.a(()=>{this.repositionChildrenRecursive()},{bounceLimitMS:20,debounceType:2});window.onresize=()=>{s.callFunc()},this.broadcastContent.showObsInfoOverlay.listen(()=>{this.obsBroadcastInfo.show()}),(0,G.Yc)().then(e=>{""!==e?((0,a.Q$)(w.R.showMyCamCurrentlySharing(e)),(0,G.Rz)(()=>{this.connect()})):this.connect()}).catch(v.yZ),this.repositionChildrenRecursive()}showValidIdsModalIfNeeded(){if(this.context.initialBroadcasterDossier.isAgeVerified&&void 0!==this.context.initialBroadcasterDossier.validIds&&this.context.initialBroadcasterDossier.validIds.length>0)if((0,Y.RA)())this.showReactValidIdsModal();else{var e;const t=new He(null===(e=this.context.loggedInUser)||void 0===e?void 0:e.username,this.context.initialBroadcasterDossier.validIds,this.context.initialBroadcasterDossier.activeGuests);t.validIdsViewed()||t.show()}}showReactValidIdsModal(){var e,t;const i=W.c.get("BroadcasterModalManager"),s=document.createElement("div");new i({avPersonImages:this.context.initialBroadcasterDossier.validIds,activeGuests:this.context.initialBroadcasterDossier.activeGuests,isNew:null!==(e=null===(t=this.context.broadcastDossier.newTagInfo)||void 0===t?void 0:t.isNew)&&void 0!==e&&e},s);const n=(0,K.Gy)();(0,K.aS)()&&void 0!==n?n.appendChild(s):document.body.appendChild(s)}connect(){const e=new V.Z(this.context.roomDossier,!0),t={dossier:this.context.roomDossier,chatConnection:e};let i;t.chatConnection.event.playSound.listen(e=>{this.audioHolder.playSound(e,t.dossier.userChatSettings.tipVolume)}),_.X0.fire(t),Q.EZ.listen(t=>{e.updateEnterLeaveSettings(t.roomEntryFor,t.roomLeaveFor)}),e.event.statusChange.listen(t=>{const s=[r.Ad.PrivateWatching,r.Ad.PrivateSpying],n=s.includes(t.currentStatus),o=s.includes(t.previousStatus);(t.previousStatus===r.Ad.NotConnected||n||o)&&(clearInterval(i),i=window.setInterval(()=>{e.updateRoomCount(n)},1e3*(n?5:90)),window.setTimeout(()=>{e.updateRoomCount(n||o)},2e3))})}createBroadcastGuide(){const e=document.createElement("div"),t=document.createElement("a");return(0,u.fZ)(t,u.aG.hrefColor),t.target="_blank",t.href=(0,f._Y)("https://support.chaturbate.com/hc/en-us/categories/360003966731-Broadcaster-Guide"),t.style.position="relative",t.style.left="16px",t.style.top="5px",t.style.fontSize="12px",t.style.fontWeight="normal",t.style.lineHeight="16.8px",t.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",t.textContent=w.R.broadcastGuideTitle,t.dataset.testid="broadcast-guide-link",(0,b.wu)("click",t,()=>{(0,x.bT)("BroadcastGuideClicked")}),e.appendChild(t),e}createTopNavBar(){const e=document.createElement("div"),t=document.createElement("ul"),i=document.createElement("li"),s=document.createElement("a");return(0,u.fZ)(e,u.aG.navigationAlt2BgImage),(0,u.fZ)(e,u.aG.navigationAlt2BgColor),(0,u.fZ)(e,u.aG.tabSectionBorder),(0,d.ZM)(e,{backgroundPosition:"bottom",font:"1.25em/1.133em 'UbuntuMedium', Arial, Helvetica, sans-serif",position:"relative",overflow:"visible",padding:"0 10px 0 32px",boxSizing:"border-box",height:"27px",marginTop:"11px",borderBottomWidth:"1px",borderBottomStyle:"solid",display:"flex",justifyContent:"flex-start"}),t.style.display="inline-block",t.style.position="relative",t.style.listStyle="none",t.style.margin="0",t.style.padding="0",t.style.font=".8666em/16px 'UbuntuMedium', Arial, Helvetica, sans-serif",i.style.fontSize="1.153em",i.style.lineHeight="16px",i.style.cssFloat="left",i.style.margin="0 2px 0 0",i.style.height="27px",i.style.overflow="hidden",(0,u.fZ)(s,u.aG.tabActiveBgColor),(0,u.fZ)(s,u.aG.tabActiveColor),(0,u.fZ)(s,u.aG.tabBorder),(0,u.fZ)(s,u.aG.tabActiveBorder),s.style.textDecoration="none",s.style.cursor="default",s.style.cssFloat="left",s.style.boxSizing="border-box",s.style.height="27px",s.style.borderWidth="1px",s.style.borderStyle="solid",s.style.borderRadius=" 4px 4px 0 0",s.style.padding="5px 11px 4px",s.innerText=w.R.myBroadcast,s.dataset.testid="my-broadcast-tab",e.appendChild(t),t.appendChild(i),i.appendChild(s),e.appendChild(this.createBroadcastGuide()),e}pickPlayerToShow(){this.broadcastContent.isOBSOverlayOffline()&&(this.context.startOBS?this.broadcastContent.hideBroadcasterShowOBS():(0,p.YU)()&&Be.Y9.canUseWebRTC()&&"true"!==new URLSearchParams(window.location.search).get("useExternalSoftware")&&this.broadcastContent.hideIntroShowWebRTC())}createPasswordWarning(){const e=document.createElement("div");return(0,u.fZ)(e,u.aG.textColor),e.innerText=w.R.passwordProtectedWarning,e.style.display="none",this.context.initialBroadcasterDossier.hasRoomPassword?e.style.display="":e.style.display="none",we.Go.listen(t=>{t.hasRoomPassword?e.style.display="":e.style.display="none"}),e}repositionChildren(){this.broadcastContent.repositionChildrenRecursive()}}var Fe=i(4356),Ze=i(2119),We=i(819),Ge=i(2789),je=i(3957),$e=i(559);(0,$e.hM)(class e extends $e.yL{parseContext(t){super.parseContext(t),this.context.isBroadcast=!0,this.context.checkIsWebRTCBroadcasting=e.isWebRTCBroadcasting,this.context.obsToken=t.obsToken,this.context.obsHost=t.obsHost,this.context.startOBS=t.startOBS,this.context.appDirectoryV3Url=t.appDirectoryV3Url,this.context.appDirectoryAuthToken=t.appDirectoryAuthToken,this.context.appDirectoryV3Enabled=t.appDirectoryV3Enabled,this.context.initialBroadcasterDossier={broadcasterUsername:t.initialBroadcasterDossier.broadcasterUsername,upVotes:t.initialBroadcasterDossier.upVotes,downVotes:t.initialBroadcasterDossier.downVotes,votePercent:t.initialBroadcasterDossier.votePercent,camVisibleTo:t.initialBroadcasterDossier.camVisibleTo,isAgeVerified:t.initialBroadcasterDossier.ageVerified,canUploadContent:t.initialBroadcasterDossier.canUploadContent,isSupporter:t.initialBroadcasterDossier.isSupporter,hasStudio:t.initialBroadcasterDossier.hasStudio,hasRoomPassword:t.initialBroadcasterDossier.hasRoomPassword,allowPrivateShows:t.initialBroadcasterDossier.allowPrivateShows,enableNotify:t.broadcastDossier.enableNotifyFollowers,enablePromoted:t.broadcastDossier.enablePromotedBroadcasters,hasGuestAccountsInvalid:t.initialBroadcasterDossier.hasGuestAccountsInvalid,pidsAboutToExpireDates:t.initialBroadcasterDossier.pidsAboutToExpireDates,guestPidsAboutToExpireUsernames:t.initialBroadcasterDossier.guestPidsAboutToExpireUsernames,isTestbed:t.initialBroadcasterDossier.isTestbed,statsDashboardEnabled:t.initialBroadcasterDossier.broadcaster_stats_dashboard_enabled,showPersonNotice:t.initialBroadcasterDossier.person_notice,validIds:t.initialBroadcasterDossier.valid_ids,activeGuests:t.initialBroadcasterDossier.active_guests,country:t.initialBroadcasterDossier.country,optInFlagDisplay:t.initialBroadcasterDossier.opt_in_flag_display},this.context.roomDossier=(0,Ge.Ec)(new r.N6(t.roomDossier)),this.context.pageLocation="chatroom",(0,Fe.I)(this.context,t),this.enablePromoted="true"===t.broadcastDossier.enablePromotedBroadcasters.toString(),this.enableNotify="true"===t.broadcastDossier.enableNotifyFollowers.toString()}init(){super.init(),super.initRoom(),Ze.M.getOrCreateInstance(),this.bindSpokenLanguageNotice();const t=document.querySelector("a#edit-spoken-language");null!==t&&(t.onclick=e=>{we.ww.fire(),e.stopPropagation()}),document.getElementById("base").style.minWidth="1173px";const i=document.getElementById("main"),o=new Me(this.context);if(i.appendChild(o.element),o.repositionChildrenRecursive(),!this.context.startOBS&&(0,p.YU)()&&Be.Y9.canUseWebRTC()&&"true"!==new URLSearchParams(window.location.search).get("useExternalSoftware"))try{e.broadcast=new n.CO(this.context.broadcastDossier,{onOBSClick:()=>{const e=new URLSearchParams(window.location.search);e.set("useExternalSoftware","true"),window.location.search=`?${e.toString()}`}},this.context.loggedInUser),document.getElementById("movie").appendChild(e.broadcast.element),(0,x.bT)("EnterWebRTCDesktopBroadcast")}catch(e){(0,x.bT)("EnterWebRTCDesktopBroadcast",{webRTCBroadcastError:e}),(0,a.Q$)(`Error loading: ${e}`),error("Error loading broadcast",{error:e})}(0,je.TR)(),!this.context.isMobile&&this.context.showBroadcasterAppSurvey&&(0,je.Nt)(!1,je.aw.BroadcasterApp),_.X0.listen(e=>{gtag("event","page_view",{page_title:e.dossier.room}),(0,x.RN)(e.dossier.room),(0,We.p$)(e.chatConnection,e.dossier.exploringHashTag);const t=s.p.getOrCreateInstance(e.chatConnection);document.body.appendChild(t.element)}),we.ek.listen(e=>{this.context.loggedInUser&&(this.context.loggedInUser.gender=e.gender,this.context.loggedInUser.subgender=e.subgender)})}static isWebRTCBroadcasting(){return void 0!==e.broadcast&&e.broadcast.isBroadcasting()}setupBroadcasterToolsPanel(){const e=document.querySelector("#broadcaster_tools_root");if(null!==e){const t=new M(this.enableNotify,this.enablePromoted);e.appendChild(t.element)}}bindSpokenLanguageNotice(){const e=`spoken-languages-msg-${this.context.initialBroadcasterDossier.broadcasterUsername}`,t=document.querySelector(`div.dismissible_notice[data-cache-key="${e}"]`);null!==t&&(0,o.gY)(t)}})},4356:(e,t,i)=>{i.d(t,{I:()=>u});var s=i(8377),n=i(1673),o=i(394),a=i(213),r=i(5216),l=i(3955),d=i(9060),h=i(7882),c=i(7407),p=i(1452),m=i(4947);function u(e,t){const i=t.broadcastDossier,u=i.room;if(e.broadcastDossier={room:u,originHost:i.originHost,originPassword:i.originPassword,originWSEndpoint:i.originWSEndpoint},(0,d.RA)()){const t=i.newTagInfo.new_tag_expiry,s=i.newTagInfo.is_new,n=i.newTagInfo.remaining_stream_time;e.broadcastDossier.newTagInfo={isNew:s,remainingStreamTime:n,newTagExpiry:null!=t?new Date(t):void 0}}e.lastWarningTime=0,n.WK.listen(t=>{const i=Date.now();if(t&&i>e.lastWarningTime+864e5&&(0,r.Aw)("api/ts/chat/check-homepage-bio-violation/").then(t=>{JSON.parse(t.responseText).has_banned_homepage_word_in_bio&&((0,c.bT)("Banned_Homepage_Word_Violation",{username:u}),(0,a.Q$)(m.R.homepageInBioViolation),e.lastWarningTime=i)}).catch(()=>{}),void 0!==e.checkIsWebRTCBroadcasting&&t&&!0!==e.checkIsWebRTCBroadcasting()&&e.loggedInUser&&e.loggedInUser.gender===h.YT.OldTrans&&void 0===e.loggedInUser.subgender){const t={acceptText:m.R.subgenderSelectionConfirm,separator:!1,allowDecline:!1,orange:!0},i=new o.k;(0,a.SI)(i.element,()=>{(0,s.n)(new FormData(i.element)).then(t=>{e.loggedInUser&&(e.loggedInUser.subgender=t)}).catch(p.yZ)},void 0,void 0,t,!0);const n=document.getElementsByClassName("decline")[0];(0,l.ZM)(n,{display:"none"})}})}},4793:(e,t,i)=>{i.d(t,{o:()=>c});var s=i(2758),n=i(9447),o=i(1224),a=i(6784),r=i(5216),l=i(2709),d=i(8423),h=i(4947);class c extends l.u{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.messageRemoved=new d.c_("messageRemoved"),(0,n.fZ)(this.element,"siteNotice"),this.element.style.display="none",this.element.style.position="static",this.options={noticeType:0,cacheKey:"",ajaxUrl:"",cacheDurationDays:10,...t},0===this.options.noticeType&&""===this.options.cacheKey&&error("SiteNotice: Must provide a CacheKey when used in Persist mode."),2===this.options.noticeType&&""===this.options.ajaxUrl&&error("SiteNotice: Must provide an AjaxUrl when used in Ajax mode."),this.render(e)}render(e){if(""!==this.options.cacheKey&&"1"===(0,s.y1)(this.options.cacheKey))return;this.element.style.display="block",this.element.style.height="auto",this.element.style.position="static",this.element.style.padding="5px 0px",this.element.style.textAlign="center",this.element.style.boxSizing="border-box",this.element.style.fontSize="14px",this.element.style.fontWeight="400",this.element.style.fontFamily="UbuntuMedium, Helvetica, Arial, sans-serif",this.element.style.color=o.mG.dismissibleMessageColor;const t=document.createElement("div");(0,n.fZ)(t,"wrapper"),t.style.padding="15px",t.style.borderWidth="1px",t.style.borderStyle="solid";const i=document.createElement("div");i.innerHTML=e,this.dismissLink=document.createElement("a"),(0,n.fZ)(this.dismissLink,n.aG.hrefColor),this.dismissLink.textContent=h.R.dismissLower,this.dismissLink.style.cursor="pointer";const l=document.createElement("span");l.textContent=" (";const d=document.createElement("span");d.textContent=")",i.appendChild(l),i.appendChild(this.dismissLink),i.appendChild(d),t.appendChild(i),this.element.appendChild(t);const c=i.getElementsByTagName("a");for(const e of c)(0,n.fZ)(e,n.aG.hrefColor),e.onmouseenter=()=>{e.style.textDecoration="underline"},e.onmouseleave=()=>{e.style.textDecoration=""};(0,a.wu)("click",this.dismissLink,()=>{switch(this.element.style.display="none",this.element.removeChild(t),this.options.noticeType){case 0:(0,s.aR)(this.options.cacheKey,"1",{days:this.options.cacheDurationDays});break;case 1:break;case 2:(0,r.KF)(this.options.ajaxUrl,{})}this.messageRemoved.fire(void 0)})}}},5091:(e,t,i)=>{i.d(t,{I:()=>T,P:()=>x});var s=i(7623),n=i(5276),o=i(9447),a=i(1372),r=i(6784),l=i(1519),d=i(5020),h=i(3955),c=i(9605),p=i(8423),m=i(1779),u=i(5412),g=i(7407),y=i(5173),b=i(4947),f=i(5389);const x=new p.c_("emojiAdded"),v=["🏻","🏼","🏽","🏾","🏿",""],w=new p.c_("toneChange",{listenersWarningThreshold:500}),C="emojiTone";class T extends y.Q{constructor(e){super(),this.getCurrentChatInput=e,this.currentTone="",this.recentEmojisToneListeners=new p.gt,this.searchResultsToneListeners=new p.gt,this.isVisible=!1,this.addAllSections(),this.overlayClick.listen(()=>{this.hide()}),(0,r.wu)("keydown",document,e=>{((0,u.x)(e.which)||27===e.keyCode||13===e.keyCode)&&this.hide()}),(0,r.wu)("keydown",this.searchBar,e=>{e.stopPropagation()}),(0,r.wu)("click",this.element,e=>{e.stopPropagation(),window.setTimeout(()=>{""!==this.searchBar.value&&this.searchBar.focus()},0)}),(0,r.wu)("resize",window,()=>{this.hide()})}initUI(){super.initUI(),this.overlay.className="emojiSelectionModalOverlay";const e={position:"relative",padding:"8px 0px",height:"219px",boxSizing:"border-box",overflowY:"scroll"},t=new l.a(()=>{this.handleSearchChange()},{bounceLimitMS:200,debounceType:1});let i;this.bottomDivot=(0,d.Uv)("","","",1),(0,o.fZ)(this.bottomDivot,"divot"),this.bottomDivot.style.bottom="-37px",this.element=(0,a.tT)("div",{style:{position:"absolute",visibility:"hidden",width:"284px",height:"261px",borderWidth:"1px",borderStyle:"solid",borderRadius:"4px",boxSizing:"border-box",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif",fontSize:"12px",zIndex:1001},colorClass:"emojiSelectionModal","data-testid":"emoji-picker-modal"},(0,a.tT)("div",{style:{position:"static",width:"calc(100% - 8px)",height:"28px",boxSizing:"border-box",margin:"4px",borderWidth:"1px",borderStyle:"solid",borderRadius:"4px"},colorClass:"searchBar"},(0,a.tT)("div",{style:{position:"relative",width:"15px",height:"15px",top:"50%",transform:"translateY(-50%)",cssFloat:"left",left:"7px"},colorClass:"searchIcon"}),(0,a.tT)("div",{style:{marginLeft:"22px",height:"100%"}},(0,a.tT)("input",{style:{position:"static",width:"calc(100% - 10px)",height:"calc(100% - 2px)",padding:"0px",borderWidth:"0px",marginLeft:"4px",outline:"none"},ref:e=>{this.searchBar=e},onInput:()=>{t.callFunc()},"data-testid":"emoji-search-bar"}))),(0,a.tT)("div",{style:e,ref:e=>{this.emojiSections=e},"data-testid":"all-emojis"},(0,a.tT)("a",{style:{position:"absolute",lineHeight:"14px",right:"22px",top:"9px",cursor:"pointer"},ref:e=>{i=e},onMouseEnter:()=>{(0,h.ZM)(i,{textDecoration:"underline"})},onMouseLeave:()=>{(0,h.ZM)(i,{textDecoration:""})},colorClass:"uploadLink",onClick:()=>this.onClickUploadLink(),"data-testid":"upload-emoticon-button"},b.R.uploadEmoticonsText)),(0,a.tT)("div",{"data-testid":"search-result-emojis",style:Object.assign({display:"none"},e),ref:e=>{this.searchResults=e}}),!(0,s.AD)()&&this.createToneSelect(),!(0,s.AD)()&&this.bottomDivot)}addAllSections(){(0,c.FH)(),this.addSection(b.R.recentlyUsedEmojis,"recent",e=>{this.recentEmojisContent=e}),this.addSection(b.R.smileysPeopleEmojis,"smileys-people"),this.addSection(b.R.animalsNatureEmojis,"animals-nature"),this.addSection(b.R.foodDrinkEmojis,"food-drink"),this.addSection(b.R.activitiesEmojis,"activities"),this.addSection(b.R.travelPlacesEmojis,"travel-places"),this.addSection(b.R.objectsEmojis,"objects"),this.addSection(b.R.symbolsEmojis,"symbols"),this.addSection(b.R.flagsEmojis,"flags")}addSection(e,t){let i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e=>{};const n=(0,a.tT)("div",{"data-testid":`${t}-emojis`},(0,a.tT)("div",{style:{lineHeight:"16px"},colorClass:"sectionTitle"},e),(0,a.tT)("div",{ref:e=>{i=e,s(e)}}));this.emojiSections.appendChild(n),(0,c.I_)(t).then(e=>{this.populateSectionContent(i,e)}).catch(()=>{})}populateSectionContent(e,t,i){for(const n of t){const t={position:"relative",display:"inline-block",width:"29px",height:"32px",cursor:"pointer",borderRadius:"2px",fontSize:"22px"},o={position:"relative",display:"inline-block",width:"28px",height:"28px",cursor:"pointer",borderRadius:"2px",fontSize:"22px",textAlign:"center",lineHeight:"28px",paddingLeft:"1px"},r=(0,a.tT)("div",{"data-testid":"emoji-item",style:(0,s.AD)()?o:t,colorClass:"emojiDiv",onClick:()=>{this.addEmojiToInput(n,e===this.recentEmojisContent)}});if(this.setElementContentToEmoji(r,n.value),this.getTonedEmoji(n,"🏽")!==n.value){const e=w.listen(e=>{this.setElementContentToEmoji(r,this.getTonedEmoji(n,e))});null==i||i.add(e)}e.appendChild(r)}}repopulateRecentEmojisContent(e){if(null!==this.recentEmojisContent.parentNode){const t=this.recentEmojisContent.cloneNode(!1);this.recentEmojisToneListeners.removeAll(),this.populateSectionContent(t,e,this.recentEmojisToneListeners),this.recentEmojisContent.parentNode.replaceChild(t,this.recentEmojisContent),this.recentEmojisContent=t}}createToneSelect(){const e={height:"24px",width:"24px",fontSize:"24px",position:"relative",top:"50%",transform:"translateY(-50%)",cssFloat:"left",marginRight:"8px",cursor:"pointer"};window.setTimeout(()=>{w.listen(e=>{this.currentTone=e,this.currentToneSpan.textContent=`👋${e}`,n.A.parse(this.currentToneSpan,{className:"emojiToneChoice"})}),w.fire(this.getSavedTone())},0);const t=(0,a.tT)("div",{style:{position:"relative",left:"-1px",borderWidth:"1px",borderStyle:"solid",borderRadius:"0px 0px 3px 3px",width:"100%",height:"40px"},colorClass:"toneSelect"},(0,a.tT)("div",{style:{position:"relative",cssFloat:"right",height:"100%",right:"17px"}},(0,a.tT)("div",{style:{position:"relative",top:"50%",transform:"translateY(-50%)",cssFloat:"left",marginRight:"8px"},colorClass:"sectionTitle"},`${b.R.tone}: `),(0,a.tT)("div",{style:{position:"relative",width:"32px",height:"32px",top:"50%",transform:"translateY(-50%)",borderRadius:"2px",cssFloat:"left",cursor:"pointer"},colorClass:"currentToneContainer",ref:e=>{this.currentToneContainer=e},onClick:()=>{this.showToneOptions()}},(0,a.tT)("div",{style:{height:"24px",width:"24px",fontSize:"24px",position:"relative",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},ref:e=>{this.currentToneSpan=e}})),(0,a.tT)("div",{style:{fontSize:"24px",display:"none",height:"100%"},ref:e=>{this.toneOptions=e}})));for(const[t,i]of v.entries()){const s=t===v.length-1?Object.assign(e,{marginRight:"4px"}):e,o=`👋${i}`,r=(0,a.tT)("div",{style:s,onClick:()=>{this.saveTone(i),this.hideToneOptions()}},o);n.A.parse(r,{className:"emojiToneChoice"}),this.toneOptions.appendChild(r)}return t}showToneOptions(){this.currentToneContainer.style.display="none",this.toneOptions.style.display="inline-block"}hideToneOptions(){(0,s.AD)()||(this.currentToneContainer.style.display="inline-block",this.toneOptions.style.display="none")}saveTone(e){window.localStorage.setItem(C,e),w.fire(e)}getSavedTone(){var e;const t=null!==(e=window.localStorage.getItem(C))&&void 0!==e?e:"";return-1===v.indexOf(t)?(error(`Bad ${C} value`,t),""):t}getTonedEmoji(e,t){const i=(0,c.GH)(e.value)[0],s=e.value.split(i);s.length>1&&s[1][0]===n.A.convert.fromCodePoint("fe0f")&&(s[1]=s[1].slice(1,s[1].length));const o=s.join(i+t);return(0,c.IC)(n.A.parse(o))?o:e.value}handleSearchChange(){const e=this.searchBar.value;e.length<=1?((0,h.ZM)(this.emojiSections,{display:"block"}),(0,h.ZM)(this.searchResults,{display:"none"})):((0,h.ZM)(this.emojiSections,{display:"none"}),(0,h.ZM)(this.searchResults,{display:"block"}),(0,c.mj)(e).then(e=>{if(null!==this.searchResults.parentNode){const e=this.searchResults.cloneNode(!1);this.searchResults.parentNode.replaceChild(e,this.searchResults),this.searchResults=e}this.searchResultsToneListeners.removeAll(),this.populateSectionContent(this.searchResults,e,this.searchResultsToneListeners)}).catch(()=>{}))}setElementContentToEmoji(e,t){if((0,s.AD)())e.innerText=t;else{let i=n.A.parse(t),s=i.match(/<img/g);if(null!==s&&s.length>1){const e=new RegExp(n.A.convert.fromCodePoint("fe0f"),"g");if(t=t.replace(e,""),i=n.A.parse(t),s=i.match(/<img/g),null!==s&&s.length>1)return}const o=new RegExp(`src="${n.A.base}72x72/(.*?).png"`),r=i.match(o);if(null!==r){const t={position:"relative",display:"block",top:"50%",left:"50%"},i=r[1],s=(0,a.tT)("span",{style:t});for(s.classList.add(`sprite-twemoji-${i}`),s.classList.add("sprite-twemoji");null!==e.firstChild;)e.removeChild(e.firstChild);e.appendChild(s)}else{const i={lineHeight:e.style.height,width:"inherit",position:"absolute",display:"flex",justifyContent:"center"};e.appendChild((0,a.tT)("span",{style:i},t))}}}addEmojiToInput(e,t){const i=this.getTonedEmoji(e,this.currentTone),n=this.getCurrentChatInput();if(void 0!==n){(0,s.AD)()?n.insertText(e.value):n.insertText(i),x.fire(void 0),(0,g.bT)("emojiAdded",{name:e.name,value:e.value});const o=(0,c.jS)(e);t?this.recentEmojisRebuildData=o:this.repopulateRecentEmojisContent(o)}}onClickUploadLink(){return window.use_uploaded_emoticon=e=>{const t=this.getCurrentChatInput();if(void 0!==t){const i=t.getText();""===i||/\s/.test(i[i.length-1])?t.insertText(e,!0):t.insertText(` ${e}`,!0)}},(0,f.gr)("/emoticons/","_blank","height=615, width=850"),this.hide(),!1}show(e){const t=(0,m.Gy)();(0,m.aS)()&&void 0!==t?(t.appendChild(this.overlay),t.appendChild(this.element)):(document.body.appendChild(this.overlay),document.body.appendChild(this.element)),this.reposition(e),this.showOverlay(),this.element.style.visibility="",this.isVisible=!0,(0,g.bT)("emojiSelectorOpened")}hide(){if("hidden"===this.element.style.visibility)return;null!==this.element.parentElement&&this.element.parentElement.removeChild(this.element),null!==this.overlay.parentElement&&this.overlay.parentElement.removeChild(this.overlay),this.hideOverlay(),this.hideToneOptions(),this.element.style.visibility="hidden",this.isVisible=!1,this.searchBar.value="",this.handleSearchChange();const e=this.getCurrentChatInput();void 0!==e&&e.focus(!0),void 0!==this.recentEmojisRebuildData&&(this.repopulateRecentEmojisContent(this.recentEmojisRebuildData),this.recentEmojisRebuildData=void 0)}reposition(e){const t=e.getBoundingClientRect();let i=window.pageXOffset,n=window.pageYOffset;(0,m.aS)()&&(i=0,n=0);let o=t.left+i-this.element.offsetWidth+35,a=this.element.offsetWidth-37;o<0&&(o=t.left+i-25,a=23),this.element.style.top=t.top+n-this.element.offsetHeight-45+"px",(0,s.AD)()&&(this.element.style.top=t.top+n-this.element.offsetHeight-8+"px"),this.element.style.left=`${o}px`,this.bottomDivot.style.left=`${a}px`}isShown(){return this.isVisible}}},6662:(e,t,i)=>{i.d(t,{c:()=>p});var s=i(2939),n=i(2709),o=i(3955),a=i(9060),r=i(4947),l=i(1372),d=i(9461),h=i(1224),c=i(1244);class p extends n.u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super(),this.isBroadcaster=e,this.playerUsername="User",this.element.id="gameInfoBar",(0,o.ZM)(this.element,{display:"none",borderRadius:"3px",boxSizing:"border-box",marginBottom:"6px",overflow:"visible",position:"static"}),this.element.appendChild(this.displayElement=(0,l.tT)("div",null)),c.F.selectionChange.listen(e=>{this.render(e)},!1),s.X0.listen(e=>{this.playerUsername=e.dossier.room,this.getAndSetCurrentGameSelection(e.chatConnection.room())})}render(e){if(null!=e){const t=this.renderDisplayContent(e);this.element.replaceChild(t,this.displayElement),this.displayElement=t,this.show()}else this.hide()}renderDisplayContent(e){var t,i,s,n;const o=(0,a.om)()&&d.Bm.current.isAgeGated;return(0,l.tT)("div",{style:{borderRadius:"3px",overflow:"hidden",padding:"6px",position:"relative",display:"flex"},className:"GameInfoBar"},!o&&(0,l.tT)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"},className:"gameImage"},(0,l.tT)("img",{src:null!==(t=null==e?void 0:e.image)&&void 0!==t?t:`${STATIC_URL}images/obs_icon_small.png`,alt:null!==(i=null==e?void 0:e.name)&&void 0!==i?i:"",width:"48",height:"48",style:{borderRadius:"5px",marginRight:"8px",objectFit:"cover",overflow:"hidden"}})),(0,l.tT)("div",{style:{height:"100%",verticalAlign:"center",paddingLeft:"8px",width:"100%"}},(0,l.tT)("div",{style:{fontSize:"14px",lineHeight:"14px",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif",padding:"6px 0"}},this.isBroadcaster?"You are":`${this.playerUsername} is`," playing"," ",(0,l.tT)("a",{href:null==e?void 0:e.gameUrl,target:"_blank",rel:"noopener"},null==e?void 0:e.name)),(0,l.tT)("div",{style:{paddingBottom:"6px",width:"100%"}},(0,l.tT)("p",{style:{fontSize:"12px",lineHeight:"12px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",margin:"0px",width:"100%"}},this.isBroadcaster?(0,l.tT)("span",null,"We added"," ",(0,l.tT)("a",{href:"/tag/gaming/",target:"_blank"},"#gaming")," ","and"," ",(0,l.tT)("a",{href:`/tag/${encodeURI(m(null!==(s=null==e?void 0:e.name)&&void 0!==s?s:""))}`,target:"_blank",rel:"noopener"},"#",m(null!==(n=null==e?void 0:e.name)&&void 0!==n?n:""))," ","to your stream, but did not change your room subject."):null==e?void 0:e.description))),(0,l.tT)("div",{style:{width:"40%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-end"}},this.isBroadcaster?(0,l.tT)("div",{style:{borderRadius:"4px",cursor:"pointer",fontSize:"14px",lineHeight:"16px",marginRight:"6px",padding:"6px",right:"0"},className:"stopStreamingButton",onClick:()=>{c.F.deselectGame()}},r.R.stopStreamingGame):(0,l.tT)("div",{style:{margin:"6px 0",padding:"8px",textAlign:"right",boxSizing:"border-box",width:"100%"}},r.R.areYouAPublisher," ",(0,l.tT)("a",{href:h.mG.cbGamesUrl,target:"_blank",rel:"noopener noreferrer"},r.R.addYourGameLink))))}async getAndSetCurrentGameSelection(e){try{this.render(await c.F.getCurrentGame(e))}catch(e){}}show(){this.element.style.display=""}hide(){this.element.style.display="none"}}function m(e){return e.split(/\s+/).map(e=>e[0].toUpperCase()+e.substring(1)).join("").replace(/[^a-zA-Z\d]/g,"")}},8130:(e,t,i)=>{i.d(t,{e:()=>d});var s=i(9447),n=i(1224),o=i(213),a=i(5216),r=i(2709),l=i(4947);class d extends r.u{constructor(e,t){super(),this.obsToken=e,this.obsHost=t,this.overlay=document.createElement("div"),this.info=document.createElement("div"),this.hide(),(0,s.fZ)(this.element,"OBSBroadcastInfo"),this.element.style.position="",(0,s.fZ)(this.overlay,"infoOverlay"),this.overlay.style.position="fixed",this.overlay.style.width="100%",this.overlay.style.height="100%",this.overlay.style.top="0",this.overlay.style.bottom="0",this.overlay.style.left="0",this.overlay.style.right="0",this.overlay.style.zIndex="1006",this.overlay.style.overflow="scroll",this.element.appendChild(this.overlay),this.overlay.appendChild(this.info);const i=document.createElement("div"),r=document.createElement("div"),d=document.createElement("div");this.info.appendChild(i),this.info.appendChild(r),this.info.appendChild(d),this.info.id="obs_broadcast_info",this.info.className="infoBox",this.info.style.position="absolute",this.info.style.top="120px",this.info.style.left="20%",this.info.style.right="20%",this.info.style.padding="20px",this.info.style.borderWidth="2px",this.info.style.borderStyle="solid",this.info.style.zIndex="1004",this.info.style.minWidth="700px";const h=document.createElement("p"),c=document.createElement("p"),p=document.createElement("strong"),m=document.createElement("strong");i.appendChild(h),i.appendChild(c),h.appendChild(p),c.appendChild(m),p.innerText=l.R.obsShareWarning,m.innerText=l.R.obsBroadcastWarning(n.mG.siteName),(0,s.fZ)(h,"warning"),h.style.textAlign="center",p.style.fontWeight="bold",(0,s.fZ)(c,"warning"),c.style.textAlign="center",m.style.fontWeight="bold",r.className="scroll",r.style.height="350px";const u=document.createElement("div");u.style.textAlign="center";const g=document.createElement("p"),y=document.createElement("input");(0,s.fZ)(y,"tokenValue"),g.style.fontSize="12px",g.innerText=`${l.R.yourBroadcastToken}:`,y.value=this.obsToken,y.id="obs_token",y.type="text",y.readOnly=!0,y.onclick=()=>{y.select()},r.appendChild(u),u.appendChild(g),u.appendChild(y),u.appendChild(document.createElement("hr"));const b=document.createElement("div");r.appendChild(b);const f=document.createElement("p");b.appendChild(f),f.style.textAlign="center",f.style.fontSize="15px",f.innerText=l.R.broadcastingInformation;const x=document.createElement("p");b.appendChild(x),x.style.textAlign="center",x.style.fontSize="15px",x.style.fontWeight="bold",x.style.textDecoration="underline";const v=document.createElement("a");(0,s.fZ)(v,"supportLink"),v.href=(0,a._Y)("https://support.chaturbate.com/hc/en-us/articles/360037971952-How-do-I-set-up-OBS-"),v.target="_blank",v.innerText=l.R.clickToViewOBSSetupGuide,x.appendChild(v);const w=document.createElement("dl");w.className="obs_info",w.style.margin="0 auto",w.style.width="620px",w.style.fontSize="0.9em",w.style.display="flex",w.style.flexFlow="row wrap",b.appendChild(w);const C=document.createElement("strong");(0,s.fZ)(C,"rtmpUrl"),C.innerText=`rtmp://${this.obsHost}/live-origin`,C.style.fontWeight="bold";const T=[{term:"RTMP URL:",detail:"",customElement:C},{term:l.R.obsGuideCodec,detail:l.R.obsGuideCodecBody,customElement:void 0},{term:l.R.obsGuideAspect,detail:l.R.obsGuideAspectBody,customElement:void 0},{term:l.R.obsGuideResolution,detail:l.R.obsGuideResolutionBody,customElement:void 0},{term:l.R.obsGuideFPS,detail:l.R.obsGuideFPSBody,customElement:void 0},{term:l.R.obsGuideBitrate,detail:l.R.obsGuideBitrateBody,customElement:void 0},{term:l.R.obsGuideKeyFrame,detail:l.R.obsGuideKeyFrameBody,customElement:void 0},{term:l.R.obsGuideKeyProfile,detail:l.R.obsGuideKeyProfileBody,customElement:void 0}];for(const e of T)w.appendChild(this.createDataTerm(e.term)),w.appendChild(this.createDataDetail(e.detail,e.customElement));const S=document.createElement("p"),R=document.createElement("ul"),I=document.createElement("li"),E=document.createElement("li"),k=document.createElement("li");b.appendChild(S),b.appendChild(R),R.appendChild(I),R.appendChild(E),R.appendChild(k),S.innerText=`${l.R.importantInformation}:`,S.style.textAlign="center",S.style.fontSize="15px",I.innerText=l.R.doNotUpscale,E.innerText=`${l.R.ensureMinimumBitrate}: `,k.innerText=l.R.copyrightContentWarning;const P=document.createElement("a");(0,s.fZ)(P,"supportLink"),P.innerText=`${l.R.recommendedSettingsTable}.`,P.href="https://support.chaturbate.com/hc/en-us/articles/360037971952-How-do-I-set-up-OBS-#output_settings",P.target="_blank",E.appendChild(P),d.style.textAlign="center";const B=this.createButton(),A=this.createButton();A.id="obs_reset_token",B.innerText=l.R.close,B.dataset.testid="close-btn",A.innerText=l.R.obsGuideGenerate,d.appendChild(B),d.appendChild(A),A.onclick=e=>{e.preventDefault(),(0,o.mf)(l.R.generateNewOBSTokenConfirm,()=>{(0,a.KF)("api/generate_new_auth_token/",{}).then(e=>{"failed"!==e.responseText?y.value=e.responseText:(0,o.Q$)(l.R.obsGuideGenerateFail)}).catch(()=>{})})},B.onclick=()=>{this.hide()}}show(){this.overlay.style.display="block",this.element.style.display="block",this.info.style.display="block",document.body.style.overflow="hidden"}hide(){this.overlay.style.display="none",this.element.style.display="none",this.info.style.display="none",document.body.style.overflow="auto"}createButton(){const e=document.createElement("a");return(0,s.fZ)(e,"button"),e.style.cursor="pointer",e.style.width="200px",e.style.height="30px",e.style.lineHeight="30px",e.style.fontWeight="bold",e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.borderRadius="4px",e.style.margin="10px 5px 0px 5px",e.style.display="inline-block",e.style.textAlign="center",e}createDataTerm(e){const t=document.createElement("dt");return t.innerText=e,t.style.display="block",t.style.cssFloat="left",t.style.textAlign="left",t.style.fontWeight="bold",t.style.flexBasis="30%",t}createDataDetail(e,t){const i=document.createElement("dd");return i.innerText=e,i.style.display="block",i.style.textAlign="left",i.style.margin="0",i.style.padding="0",i.style.flexBasis="70%",void 0!==t&&i.appendChild(t),i}}},9938:(e,t,i)=>{i.d(t,{K:()=>S});var s=i(8638),n=i(2543),o=i(5559),a=i(2939),r=i(8423),l=i(7407),d=i(2331),h=i(9757);const c=0,p=1,m=2,u={[c]:"desktop_pm",[p]:"desktop_pm_inbox",[m]:"desktop_pm_canvas",3:"desktop_pm_canvas_inbox"};var g=i(1710);class y{constructor(e,t,i){var s;this.element=e,this.cssAncestorQuery=t;const n=null===(s=this.element)||void 0===s?void 0:s.closest(t);null!=n&&(this.styleObserver=new MutationObserver(()=>{i()}),this.styleObserver.observe(n,{attributes:!0,attributeFilter:["style"]}))}dispose(){this.styleObserver.disconnect()}checkVisibility(){var e;const t=null===(e=this.element)||void 0===e?void 0:e.closest(this.cssAncestorQuery);return null==t||this.checkVisibilityCore(t)}}class b extends y{constructor(e,t){super(e,"#ChatTabContainer",t)}checkVisibilityCore(e){let t;return t="block"===getComputedStyle(e).display,t}}var f=i(7250);class x extends y{constructor(e,t){super(e,".draggableCanvasWindow",t),this.onVisibilityChangeHandler=t,this.videoModeListener=f.L.changeVideoMode.listen(()=>{this.onVisibilityChangeHandler()})}checkVisibilityCore(e){const t=getComputedStyle(e),i="visible"===t.visibility,s="none"!==t.display;return i&&s}checkVisibility(){var e;const t=null===(e=this.element)||void 0===e?void 0:e.closest(".draggableCanvasWindow");return null!=t&&this.checkVisibilityCore(t)}dispose(){var e;super.dispose(),null===(e=this.videoModeListener)||void 0===e||e.removeListener()}}class v extends y{constructor(e,t){super(e,".PmMessagingTabContents",t)}checkVisibilityCore(e){let t;return t="block"===getComputedStyle(e).display,t}}class w extends y{constructor(e,t){super(e,".topSectionWrapper",t)}checkVisibilityCore(e){let t;const i=getComputedStyle(e).top;return t=parseFloat(i)<1e5,t}}class C{constructor(){this.listeners=[],this.handleVisibilityChanged=()=>{let e=!0;for(const t of this.listeners){const i=t.checkVisibility();e&&(e=i)}e?g.v.getInstance().showInstance(this.instanceId):g.v.getInstance().hideInstance(this.instanceId)}}init(e,t,i){this.instanceId=i;const s=new v(e,this.handleVisibilityChanged);this.listeners.push(s);const n=new w(e,this.handleVisibilityChanged);if(this.listeners.push(n),"desktop_pm_canvas"===t||"desktop_pm_canvas_inbox"===t){const t=new x(e,this.handleVisibilityChanged);this.listeners.push(t)}else{const t=new b(e,this.handleVisibilityChanged);this.listeners.push(t)}}dispose(){this.listeners.forEach(e=>e.dispose())}}const T="merge-pm-dm-onboarding";class S extends d.YI{constructor(e){super(),this.inBroadcast=e,this.otherUserInitiatedPm=new r.c_("otherUserInitiatedPm"),this.numUnread=0,this.isBroadcaster=!1,this.isUserNoteDirty=!1,this.pendingTab=void 0,this.onboardingStatus=void 0,this.element.className="PmMessagingTabContents",this.cbListenerGroup=new n.J9,this.msgPmManager=g.v.getInstance();const t=new C;a.X0.listen(e=>{var i,s,a;this.isBroadcaster=e.dossier.userName===e.dossier.room;const r=e.chatConnection.room(),l=null!==(null===(i=this.element)||void 0===i?void 0:i.closest("#ChatTabContainer")),d=((e,t)=>{let i=0;return e&&(i|=1),t&&(i|=2),u[i]})(this.isBroadcaster,!l);this.messageInstanceId=g.v.generatePmInstanceId(r,!l),t.init(this.element,d,this.messageInstanceId);const h="none"!==(null===(s=this.element)||void 0===s?void 0:s.style.display);this.msgPmManager.initUI(e,this.element,d,this.messageInstanceId,!h);try{const e=localStorage.getItem(T);if(null!==e)this.onboardingStatus=JSON.parse(e);else{const e={timeFirstShown:Date.now(),dismissed:!1};localStorage.setItem(T,JSON.stringify(e)),this.onboardingStatus=e}}catch{this.onboardingStatus={timeFirstShown:Date.now(),dismissed:!1}}l&&this.isBroadcaster&&void 0!==this.inBroadcast&&this.inBroadcast&&!1===(null===(a=this.onboardingStatus)||void 0===a?void 0:a.dismissed)&&this.createV3OnboardingPopup(),n._g.listen("pmMessage",()=>{this.changeToThisTab()}).addTo(this.cbListenerGroup),n._g.listen("userNoteEvent",e=>{if(e.messagingId===this.messageInstanceId)switch(e.type){case o.Is.State:void 0!==e.isDirty&&(this.isUserNoteDirty=e.isDirty,this.isUserNoteDirty||void 0===this.pendingTab||(this.pendingTab.changeToThisTab(),this.pendingTab=void 0));break;case o.Is.KeepEditing:this.pendingTab=void 0}}).addTo(this.cbListenerGroup)}),n._g.listen("messagingTotalNumUnreadChanged",e=>{this.numUnread=e,this.refreshTabs()},{syncHistory:!0}).addTo(this.cbListenerGroup),a.Gr.listen(()=>{this.numUnread=0,this.msgPmManager.onRoomCleanup(),this.cbListenerGroup.removeAll(),t.dispose()})}canUnsetAsCurrentTab(e){return!this.isUserNoteDirty||(this.pendingTab=e,n._g.fire("userNoteEvent",{type:o.Is.AttemptClose,messagingId:this.messageInstanceId}),!1)}getTabId(){return"message-tab-default"}createV3OnboardingPopup(){const e=document.createElement("div");e.id=T;const t=h.c.get("OnboardingModal");return this.onboardingModal=new t({isOpen:!0,onClose:()=>this.beginShowcase(),onSave:()=>{this.beginShowcase()},slides:[{title:s.i._({id:"EYe5Eq",message:"Introducing Messages: Your Unified Inbox"}),description:s.i._({id:"D7kQdi",message:"We’ve merged Private Messages (PMs) and Direct Messages (DMs) into one streamlined Messages inbox so you can see all your conversations and history in one place, both on and off stream. This upgrade makes it easier to find and resume past conversations - fostering more consistent connections and significantly boosting user engagement."}),imgUrl:`${STATIC_URL_ROOT}images/messaging/mergePmDmOnboardingSlide.png`,imgUrlMobile:`${STATIC_URL_ROOT}images/messaging/mergePmDmOnboardingSlide.png`}],lastButtonText:s.i._({id:"aP3N/0",message:"Ok"}),showSkipButton:!1,closeOnOverlayClick:!1,descriptionFontClass:"OnboardingModal__descriptionMergePmDm"},e),e}hideOnboardingPopup(){this.onboardingModal&&this.onboardingModal.dispose()}beginShowcase(){this.hideOnboardingPopup();const e=this.onboardingStatus?{...this.onboardingStatus,dismissed:!0}:{timeFirstShown:Date.now(),dismissed:!0};try{localStorage.setItem(T,JSON.stringify(e))}catch{error("Failed to write MergePmDm onboarding dismissed status to localStorage")}this.onboardingStatus=e}getTabHandleContent(){const e=s.i._({id:"GRTNRB",message:"MESSAGE"});let t;return t=this.numUnread>99?`${e} (99+)`:this.numUnread>0?`${e} (${this.numUnread})`:e,[document.createTextNode(t)]}tabHandleClicked(e){(0,l.bT)("FocusTab",{location:"messages",unread:this.numUnread}),super.tabHandleClicked(e)}setAsCurrentTab(){this.isBroadcaster&&!this.msgPmManager.getIsNavigatingToConversation()&&this.msgPmManager.resetInstanceToInbox(this.messageInstanceId),this.focusCurrentChatInput()}focusCurrentChatInput(){this.msgPmManager.focusInstance(this.messageInstanceId)}isInputFocused(){const e=document.activeElement;return this.element.contains(e)&&(null==e?void 0:e.classList.contains("messaging-input"))}blurCurrentChatInput(){}scrollToBottom(){}getChatInputField(){}showNextPMSession(){}showPrevPMSession(){}resetNextQueue(){}resetPrevQueue(){}showPMList(e){}closeCurrentPMSession(){}closePMSession(e){}possiblyAppendMessageDivForUser(e,t){}possiblyAppendMessageDiv(e){}getSession(e){return{isActive:()=>!0}}}}},e=>{var t=t=>e(e.s=t);e.O(0,[9127,6990,6039,8713,6561],()=>(t(4777),t(2021),t(5132),t(1166))),e.O()}]);
//# sourceMappingURL=broadcast-prod-b87ec97c3b055a69b4be.js.map